# –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è–º–∏ —Ç–∞ –ø–∞—Ä–∞–ª–µ–ª—å–Ω–∏–º –¥–æ—Å—Ç—É–ø–æ–º

## –ü–ª–∞–Ω –ª–µ–∫—Ü—ñ—ó

1. –ö–æ–Ω—Ü–µ–ø—Ü—ñ—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó
2. ACID –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π
3. –†—ñ–≤–Ω—ñ —ñ–∑–æ–ª—è—Ü—ñ—ó —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π
4. –ü—Ä–æ—Ç–æ–∫–æ–ª–∏ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –ø–∞—Ä–∞–ª–µ–ª—å–Ω—ñ—Å—Ç—é
5. –í–∏—è–≤–ª–µ–Ω–Ω—è —Ç–∞ –≤–∏—Ä—ñ—à–µ–Ω–Ω—è –≤–∑–∞—î–º–æ–±–ª–æ–∫—É–≤–∞–Ω—å
6. –ë–∞–≥–∞—Ç–æ–≤–µ—Ä—Å—ñ–π–Ω–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ—Å—Ç—ñ (MVCC)

## üìö **–û—Å–Ω–æ–≤–Ω—ñ –ø–æ–Ω—è—Ç—Ç—è**

**–¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è** ‚Äî –ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü—ñ–π –∑ –±–∞–∑–æ—é –¥–∞–Ω–∏—Ö, —è–∫—ñ –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è —è–∫ —î–¥–∏–Ω–µ —Ü—ñ–ª–µ. –ê–±–æ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –ø–æ–≤–Ω—ñ—Å—Ç—é, –∞–±–æ –ø–æ–≤–Ω—ñ—Å—Ç—é —Å–∫–∞—Å–æ–≤—É—î—Ç—å—Å—è.

**ACID** ‚Äî –Ω–∞–±—ñ—Ä –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç–µ–π, —â–æ –≥–∞—Ä–∞–Ω—Ç—É—é—Ç—å –Ω–∞–¥—ñ–π–Ω—ñ—Å—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π: Atomicity, Consistency, Isolation, Durability.

**–ë–ª–æ–∫—É–≤–∞–Ω–Ω—è** ‚Äî –º–µ—Ö–∞–Ω—ñ–∑–º –∫–æ–Ω—Ç—Ä–æ–ª—é –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø—É, —è–∫–∏–π –∑–∞–ø–æ–±—ñ–≥–∞—î –æ–¥–Ω–æ—á–∞—Å–Ω–æ–º—É –¥–æ—Å—Ç—É–ø—É –¥–æ –æ–¥–Ω–∏—Ö —ñ —Ç–∏—Ö —Å–∞–º–∏—Ö –¥–∞–Ω–∏—Ö.

**MVCC** ‚Äî –±–∞–≥–∞—Ç–æ–≤–µ—Ä—Å—ñ–π–Ω–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ—Å—Ç—ñ, —è–∫–∏–π –∑–±–µ—Ä—ñ–≥–∞—î –∫—ñ–ª—å–∫–∞ –≤–µ—Ä—Å—ñ–π –¥–∞–Ω–∏—Ö –¥–ª—è –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ—Å—Ç—ñ.

## **1. –ö–æ–Ω—Ü–µ–ø—Ü—ñ—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó**

## –©–æ —Ç–∞–∫–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è?

### üí° **–õ–æ–≥—ñ—á–Ω–∞ –æ–¥–∏–Ω–∏—Ü—è —Ä–æ–±–æ—Ç–∏**

–¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è —Å–∫–ª–∞–¥–∞—î—Ç—å—Å—è –∑:
- **BEGIN TRANSACTION** ‚Äî –ø–æ—á–∞—Ç–æ–∫
- –ù–∞–±—ñ—Ä –æ–ø–µ—Ä–∞—Ü—ñ–π **READ** —Ç–∞ **WRITE**
- **COMMIT** ‚Äî —É—Å–ø—ñ—à–Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è
- **ROLLBACK** ‚Äî —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è –≤—Å—ñ—Ö –∑–º—ñ–Ω

### –ü—Ä–∏–∫–ª–∞–¥ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó –ø–µ—Ä–µ–∫–∞–∑—É –∫–æ—à—Ç—ñ–≤

```sql
BEGIN TRANSACTION;

-- –ó–Ω—è—Ç—Ç—è –∑ —Ä–∞—Ö—É–Ω–∫—É –≤—ñ–¥–ø—Ä–∞–≤–Ω–∏–∫–∞
UPDATE accounts
SET balance = balance - 1000
WHERE account_id = 'ACC001';

-- –î–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–∞ —Ä–∞—Ö—É–Ω–æ–∫ –æ—Ç—Ä–∏–º—É–≤–∞—á–∞
UPDATE accounts
SET balance = balance + 1000
WHERE account_id = 'ACC002';

COMMIT;
```

## –ù–∞–≤—ñ—â–æ –ø–æ—Ç—Ä—ñ–±–Ω—ñ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó?

### ‚ö†Ô∏è **–ü—Ä–æ–±–ª–µ–º–∏ –±–µ–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π**

```
–°—Ü–µ–Ω–∞—Ä—ñ–π –±–µ–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—é:

–ö—Ä–æ–∫ 1: –ó–Ω—è—Ç–∏ 1000 –∑ —Ä–∞—Ö—É–Ω–∫—É A ‚úì
–ö—Ä–æ–∫ 2: –ó–ë–Ü–ô –°–ò–°–¢–ï–ú–ò! üí•
–ö—Ä–æ–∫ 3: –î–æ–¥–∞—Ç–∏ 1000 –Ω–∞ —Ä–∞—Ö—É–Ω–æ–∫ B ‚úó

–†–µ–∑—É–ª—å—Ç–∞—Ç: 1000 –≥—Ä–Ω –∑–Ω–∏–∫–ª–∏!
```

### ‚úÖ **–ó —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è–º–∏**

```
BEGIN TRANSACTION;
–ö—Ä–æ–∫ 1: –ó–Ω—è—Ç–∏ 1000 –∑ —Ä–∞—Ö—É–Ω–∫—É A ‚úì
–ö—Ä–æ–∫ 2: –ó–ë–Ü–ô –°–ò–°–¢–ï–ú–ò! üí•
ROLLBACK ‚Äî —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–æ–≤–µ—Ä—Ç–∞—î –≥—Ä–æ—à—ñ!

–†–µ–∑—É–ª—å—Ç–∞—Ç: –î–∞–Ω—ñ –∑–∞–ª–∏—à–∏–ª–∏—Å—å –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–∏–º–∏
```

## –û–ø–µ—Ä–∞—Ü—ñ—ó —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó

### üìñ **–ß–∏—Ç–∞–Ω–Ω—è (READ)**

```sql
SELECT balance FROM accounts WHERE account_id = 'ACC001';
```

–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:
- –û—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö –∑ –ë–î
- –ù–µ –∑–º—ñ–Ω—é—î —Å—Ç–∞–Ω —Å–∏—Å—Ç–µ–º–∏
- –ü–æ–∑–Ω–∞—á–µ–Ω–Ω—è: **read(X)**

### ‚úçÔ∏è **–ó–∞–ø–∏—Å (WRITE)**

```sql
UPDATE accounts SET balance = balance - 100
WHERE account_id = 'ACC001';
```

–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:
- –ó–º—ñ–Ω–∞ –¥–∞–Ω–∏—Ö –≤ –ë–î
- –í–ø–ª–∏–≤–∞—î –Ω–∞ —Å—Ç–∞–Ω —Å–∏—Å—Ç–µ–º–∏
- –ü–æ–∑–Ω–∞—á–µ–Ω–Ω—è: **write(X)**

## **2. ACID –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ**

## ACID: –§—É–Ω–¥–∞–º–µ–Ω—Ç –Ω–∞–¥—ñ–π–Ω–æ—Å—Ç—ñ

```mermaid
graph TB
    A[üîí ACID] --> B[Atomicity<br/>–ê—Ç–æ–º–∞—Ä–Ω—ñ—Å—Ç—å]
    A --> C[Consistency<br/>–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ñ—Å—Ç—å]
    A --> D[Isolation<br/>–Ü–∑–æ–ª—å–æ–≤–∞–Ω—ñ—Å—Ç—å]
    A --> E[Durability<br/>–î–æ–≤–≥–æ–≤—ñ—á–Ω—ñ—Å—Ç—å]

    B --> F[–í—Å–µ –∞–±–æ –Ω—ñ—á–æ–≥–æ]
    C --> G[–¶—ñ–ª—ñ—Å–Ω—ñ—Å—Ç—å –¥–∞–Ω–∏—Ö]
    D --> H[–ù–µ–∑–∞–ª–µ–∂–Ω—ñ—Å—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π]
    E --> I[–ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤]
```

### **–°—Ñ–æ—Ä–º—É–ª—å–æ–≤–∞–Ω—ñ –î–∂–∏–º–æ–º –ì—Ä–µ—î–º —É 1981 —Ä–æ—Ü—ñ**

## –ê—Ç–æ–º–∞—Ä–Ω—ñ—Å—Ç—å (Atomicity)

### üí£ **–ü—Ä–∏–Ω—Ü–∏–ø "–≤—Å–µ –∞–±–æ –Ω—ñ—á–æ–≥–æ"**

```
–¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è –∞–±–æ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –ø–æ–≤–Ω—ñ—Å—Ç—é:
‚úì –í—Å—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó —É—Å–ø—ñ—à–Ω—ñ ‚Üí COMMIT

–ê–±–æ –Ω–µ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –∑–æ–≤—Å—ñ–º:
‚úó –ü–æ–º–∏–ª–∫–∞ –≤ –±—É–¥—å-—è–∫—ñ–π –æ–ø–µ—Ä–∞—Ü—ñ—ó ‚Üí ROLLBACK
```

### –ü—Ä–∏–∫–ª–∞–¥ –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—ñ

```sql
BEGIN TRANSACTION;

UPDATE accounts SET balance = balance - 1000
WHERE account_id = 'ACC001';

-- –Ø–∫—â–æ —Ç—É—Ç –≤–∏–Ω–∏–∫–∞—î –ø–æ–º–∏–ª–∫–∞ –∞–±–æ –∑–±—ñ–π
UPDATE accounts SET balance = balance + 1000
WHERE account_id = 'ACC002';

COMMIT;

-- –ü—Ä–∏ –∑–±–æ—ó: –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π ROLLBACK –≤—Å—ñ—Ö –∑–º—ñ–Ω
```

## –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ñ—Å—Ç—å (Consistency)

### ‚úÖ **–ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ø—Ä–∞–≤–∏–ª —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ**

–¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å –ë–î –∑ –æ–¥–Ω–æ–≥–æ **–∫–æ—Ä–µ–∫—Ç–Ω–æ–≥–æ** —Å—Ç–∞–Ω—É –≤ —ñ–Ω—à–∏–π **–∫–æ—Ä–µ–∫—Ç–Ω–∏–π** —Å—Ç–∞–Ω.

```sql
CREATE TABLE accounts (
    account_id VARCHAR(10) PRIMARY KEY,
    balance DECIMAL(15,2) NOT NULL
        CHECK (balance >= 0),  -- –ü—Ä–∞–≤–∏–ª–æ: –±–∞–ª–∞–Ω—Å >= 0
    customer_id INT NOT NULL,
    FOREIGN KEY (customer_id)
        REFERENCES customers(customer_id)
);
```

### –ü–æ—Ä—É—à–µ–Ω–Ω—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—ñ

```sql
BEGIN TRANSACTION;

UPDATE accounts
SET balance = balance - 5000
WHERE account_id = 'ACC001' AND balance = 3000;

-- ‚ùå ERROR: –ø–æ—Ä—É—à–µ–Ω–æ CHECK (balance >= 0)
-- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π ROLLBACK
```

## –Ü–∑–æ–ª—å–æ–≤–∞–Ω—ñ—Å—Ç—å (Isolation)

### üîí **–ù–µ–∑–∞–ª–µ–∂–Ω—ñ—Å—Ç—å –ø–∞—Ä–∞–ª–µ–ª—å–Ω–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π**

–ö–æ–∂–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è —Ç–∞–∫, –Ω—ñ–±–∏ –≤–æ–Ω–∞ —î–¥–∏–Ω–∞ –≤ —Å–∏—Å—Ç–µ–º—ñ.

```
–ë–µ–∑ —ñ–∑–æ–ª—è—Ü—ñ—ó:
T1: READ(X)=100 ‚Üí X=X+50 ‚Üí WRITE(X)=150
T2: READ(X)=100 ‚Üí X=X+30 ‚Üí WRITE(X)=130

–†–µ–∑—É–ª—å—Ç–∞—Ç: 130 (–≤—Ç—Ä–∞—á–µ–Ω–æ +50!)

–ó —ñ–∑–æ–ª—è—Ü—ñ—î—é:
T1: READ(X)=100 ‚Üí X=X+50 ‚Üí WRITE(X)=150
T2: —á–µ–∫–∞—î –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è T1...
T2: READ(X)=150 ‚Üí X=X+30 ‚Üí WRITE(X)=180

–†–µ–∑—É–ª—å—Ç–∞—Ç: 180 ‚úì
```

## –ü—Ä–æ–±–ª–µ–º–∏ –±–µ–∑ —ñ–∑–æ–ª—è—Ü—ñ—ó

### 1Ô∏è‚É£ **–í—Ç—Ä–∞—Ç–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è (Lost Update)**

| –ß–∞—Å | T1 | T2 | X |
|-----|----|----|---|
| t1 | READ(X)=100 | | 100 |
| t2 | | READ(X)=100 | 100 |
| t3 | X=150 | | 100 |
| t4 | | X=130 | 100 |
| t5 | WRITE(150) | | 150 |
| t6 | | WRITE(130) | 130 |

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –∑–∞–º—ñ—Å—Ç—å 180 –º–∞—î–º–æ 130

### 2Ô∏è‚É£ **–ë—Ä—É–¥–Ω–µ —á–∏—Ç–∞–Ω–Ω—è (Dirty Read)**

```
T1: UPDATE price = 100
T2: READ price = 100  ‚Üê –ß–∏—Ç–∞—î –Ω–µ–∑–∞—Ñ—ñ–∫—Å–æ–≤–∞–Ω–µ!
T1: ROLLBACK
T2: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –Ω–µ—ñ—Å–Ω—É—é—á–µ –∑–Ω–∞—á–µ–Ω–Ω—è 100
```

## –î–æ–≤–≥–æ–≤—ñ—á–Ω—ñ—Å—Ç—å (Durability)

### üíæ **–ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ø—ñ—Å–ª—è COMMIT**

–ü—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó —ó—ó —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –Ω–∞–∑–∞–≤–∂–¥–∏, –Ω–∞–≤—ñ—Ç—å –ø—Ä–∏ –∑–±–æ—è—Ö —Å–∏—Å—Ç–µ–º–∏.

### –ñ—É—Ä–Ω–∞–ª –ø–µ—Ä–µ–¥–∑–∞–ø–∏—Å—É (WAL)

```
–ü—Ä–æ—Ü–µ—Å —Ñ—ñ–∫—Å–∞—Ü—ñ—ó:
1. –ó–∞–ø–∏—Å –≤ –∂—É—Ä–Ω–∞–ª –Ω–∞ –¥–∏—Å–∫ ‚úì
2. –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É "COMMIT —É—Å–ø—ñ—à–Ω–∏–π"
3. –ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –¥–æ –ë–î (–º–æ–∂–µ –±—É—Ç–∏ –ø—ñ–∑–Ω—ñ—à–µ)

–ü—Ä–∏ –∑–±–æ—ó:
- REDO: –ø–æ–≤—Ç–æ—Ä–∏—Ç–∏ –∑–∞—Ñ—ñ–∫—Å–æ–≤–∞–Ω—ñ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó
- UNDO: –≤—ñ–¥–∫–æ—Ç–∏—Ç–∏ –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω—ñ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó
```

### –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ñ —Ç–æ—á–∫–∏ (Checkpoints)

```
[CP] CHECKPOINT
[101] BEGIN T1
[102] T1: UPDATE...
[103] COMMIT T1
[104] BEGIN T2
[–ó–ë–Ü–ô]

–í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è –∑ –æ—Å—Ç–∞–Ω–Ω—å–æ—ó CP
```

## **3. –†—ñ–≤–Ω—ñ —ñ–∑–æ–ª—è—Ü—ñ—ó**

## –ß–æ—Ç–∏—Ä–∏ —Ä—ñ–≤–Ω—ñ —ñ–∑–æ–ª—è—Ü—ñ—ó SQL

### üìä **–ö–æ–º–ø—Ä–æ–º—ñ—Å: –∫–æ—Ä–µ–∫—Ç–Ω—ñ—Å—Ç—å ‚ü∑ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å**

| –†—ñ–≤–µ–Ω—å | –ë—Ä—É–¥–Ω–µ —á–∏—Ç–∞–Ω–Ω—è | –ù–µ–ø–æ–≤—Ç–æ—Ä—é–≤–∞–Ω–µ | –§–∞–Ω—Ç–æ–º–∏ |
|--------|----------------|---------------|---------|
| **READ UNCOMMITTED** | ‚ùå –ú–æ–∂–ª–∏–≤–æ | ‚ùå –ú–æ–∂–ª–∏–≤–æ | ‚ùå –ú–æ–∂–ª–∏–≤–æ |
| **READ COMMITTED** | ‚úÖ –ù–µ–º–æ–∂–ª–∏–≤–æ | ‚ùå –ú–æ–∂–ª–∏–≤–æ | ‚ùå –ú–æ–∂–ª–∏–≤–æ |
| **REPEATABLE READ** | ‚úÖ –ù–µ–º–æ–∂–ª–∏–≤–æ | ‚úÖ –ù–µ–º–æ–∂–ª–∏–≤–æ | ‚ùå –ú–æ–∂–ª–∏–≤–æ |
| **SERIALIZABLE** | ‚úÖ –ù–µ–º–æ–∂–ª–∏–≤–æ | ‚úÖ –ù–µ–º–æ–∂–ª–∏–≤–æ | ‚úÖ –ù–µ–º–æ–∂–ª–∏–≤–æ |

**‚Üë –ë—ñ–ª—å—à–µ –≥–∞—Ä–∞–Ω—Ç—ñ–π = –Ω–∏–∂—á–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å**

## READ UNCOMMITTED

### ‚ö° **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ —à–≤–∏–¥–∫—ñ—Å—Ç—å, –º—ñ–Ω—ñ–º–∞–ª—å–Ω—ñ –≥–∞—Ä–∞–Ω—Ç—ñ—ó**

```sql
SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;

BEGIN TRANSACTION;
SELECT balance FROM accounts WHERE account_id = 'ACC001';
-- –ú–æ–∂–µ –ø—Ä–æ—á–∏—Ç–∞—Ç–∏ –Ω–µ–∑–∞—Ñ—ñ–∫—Å–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ!
COMMIT;
```

**–ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è:**
- –ó–≤—ñ—Ç–∏, –¥–µ —Ç–æ—á–Ω—ñ—Å—Ç—å –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–∞
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º–∏
- –ê–Ω–∞–ª—ñ—Ç–∏–∫–∞ –Ω–∞ –∫–æ–ø—ñ—è—Ö –ë–î

**‚ö†Ô∏è –£–≤–∞–≥–∞:** –º–æ–∂–ª–∏–≤–µ –±—Ä—É–¥–Ω–µ —á–∏—Ç–∞–Ω–Ω—è!

## READ COMMITTED

### ‚≠ê **–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π –≤–∏–±—ñ—Ä (PostgreSQL, Oracle, SQL Server)**

```sql
SET TRANSACTION ISOLATION LEVEL READ COMMITTED;

BEGIN TRANSACTION;

SELECT balance FROM accounts WHERE account_id = 'ACC001';
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: 5000

-- –Ü–Ω—à–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è –∑–º—ñ–Ω—é—î –±–∞–ª–∞–Ω—Å –Ω–∞ 6000

SELECT balance FROM accounts WHERE account_id = 'ACC001';
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: 6000 (–Ω–µ–ø–æ–≤—Ç–æ—Ä—é–≤–∞–Ω–µ —á–∏—Ç–∞–Ω–Ω—è)

COMMIT;
```

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
- ‚úÖ –ó–∞–ø–æ–±—ñ–≥–∞—î –±—Ä—É–¥–Ω–æ–º—É —á–∏—Ç–∞–Ω–Ω—é
- ‚ùå –î–æ–∑–≤–æ–ª—è—î –Ω–µ–ø–æ–≤—Ç–æ—Ä—é–≤–∞–Ω–µ —á–∏—Ç–∞–Ω–Ω—è
- –ü—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è –±—ñ–ª—å—à–æ—Å—Ç—ñ –≤–µ–±–∑–∞—Å—Ç–æ—Å—É–Ω–∫—ñ–≤

## REPEATABLE READ

### üîí **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–µ —á–∏—Ç–∞–Ω–Ω—è –ø—Ä–æ—Ç—è–≥–æ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó**

```sql
SET TRANSACTION ISOLATION LEVEL REPEATABLE READ;

BEGIN TRANSACTION;

SELECT balance FROM accounts WHERE account_id = 'ACC001';
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: 5000

-- –Ü–Ω—à–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è –∑–º—ñ–Ω—é—î –±–∞–ª–∞–Ω—Å ‚Üí –ë–õ–û–ö–£–Ñ–¢–¨–°–Ø

SELECT balance FROM accounts WHERE account_id = 'ACC001';
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: 5000 (—Å—Ç–∞–±—ñ–ª—å–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è!)

COMMIT;
```

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:**
- –§—ñ–Ω–∞–Ω—Å–æ–≤—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó
- –ö—Ä–∏—Ç–∏—á–Ω—ñ –±—ñ–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å–∏
- –ö–æ–ª–∏ –ø–æ—Ç—Ä—ñ–±–Ω–∞ —Å—Ç–∞–±—ñ–ª—å–Ω—ñ—Å—Ç—å –¥–∞–Ω–∏—Ö

## SERIALIZABLE

### üõ°Ô∏è **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ñ –≥–∞—Ä–∞–Ω—Ç—ñ—ó –∫–æ—Ä–µ–∫—Ç–Ω–æ—Å—Ç—ñ**

```sql
SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

BEGIN TRANSACTION;

SELECT COUNT(*) FROM products WHERE category = 'Electronics';
-- 50 —Ç–æ–≤–∞—Ä—ñ–≤

-- –°–ø—Ä–æ–±–∞ –≤—Å—Ç–∞–≤–∏—Ç–∏ –Ω–æ–≤–∏–π —Ç–æ–≤–∞—Ä —ñ–Ω—à–æ—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—î—é
-- ‚Üí –ë–õ–û–ö–£–Ñ–¢–¨–°–Ø –∞–±–æ –ø–æ–º–∏–ª–∫–∞ —Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó

SELECT COUNT(*) FROM products WHERE category = 'Electronics';
-- 50 —Ç–æ–≤–∞—Ä—ñ–≤ (—Ñ–∞–Ω—Ç–æ–º–∏ –Ω–µ–º–æ–∂–ª–∏–≤—ñ)

COMMIT;
```

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
- –¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è —è–∫ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ
- –ù–∞–π–≤–∏—â—ñ –≥–∞—Ä–∞–Ω—Ç—ñ—ó
- –ù–∞–π–Ω–∏–∂—á–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å

## **4. –ü—Ä–æ—Ç–æ–∫–æ–ª–∏ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –ø–∞—Ä–∞–ª–µ–ª—å–Ω—ñ—Å—Ç—é**

## –¢—Ä–∏ –æ—Å–Ω–æ–≤–Ω—ñ –ø—ñ–¥—Ö–æ–¥–∏

```mermaid
graph TB
    A[–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –ø–∞—Ä–∞–ª–µ–ª—å–Ω—ñ—Å—Ç—é] --> B[–ë–ª–æ–∫—É–≤–∞–Ω–Ω—è<br/>Locking]
    A --> C[–ü–æ–∑–Ω–∞—á–∫–∏ —á–∞—Å—É<br/>Timestamps]
    A --> D[–û–ø—Ç–∏–º—ñ—Å—Ç–∏—á–Ω–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è<br/>Validation]

    B --> E[2PL Protocol]
    C --> F[TO Protocol]
    D --> G[OCC Protocol]
```

**–†—ñ–∑–Ω—ñ –ø—ñ–¥—Ö–æ–¥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤!**

## –ü—Ä–æ—Ç–æ–∫–æ–ª –±–ª–æ–∫—É–≤–∞–Ω–Ω—è

### üîê **–¢–∏–ø–∏ –±–ª–æ–∫—É–≤–∞–Ω—å**

**–°–ø—ñ–ª—å–Ω–µ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è (S-lock):**
- –î–ª—è –æ–ø–µ—Ä–∞—Ü—ñ–π —á–∏—Ç–∞–Ω–Ω—è
- –ö—ñ–ª—å–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π –º–æ–∂—É—Ç—å —É—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –æ–¥–Ω–æ—á–∞—Å–Ω–æ
- –ë–ª–æ–∫—É—î –≤–∏–∫–ª—é—á–Ω—ñ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è

**–í–∏–∫–ª—é—á–Ω–µ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è (X-lock):**
- –î–ª—è –æ–ø–µ—Ä–∞—Ü—ñ–π –∑–∞–ø–∏—Å—É
- –õ–∏—à–µ –æ–¥–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è
- –ë–ª–æ–∫—É—î –≤—Å—ñ —ñ–Ω—à—ñ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è

### –ú–∞—Ç—Ä–∏—Ü—è —Å—É–º—ñ—Å–Ω–æ—Å—Ç—ñ

|  | S-lock | X-lock |
|--|--------|--------|
| **S-lock** | ‚úÖ –¢–∞–∫ | ‚ùå –ù—ñ |
| **X-lock** | ‚ùå –ù—ñ | ‚ùå –ù—ñ |

## –î–≤–æ—Ñ–∞–∑–Ω–∏–π –ø—Ä–æ—Ç–æ–∫–æ–ª (2PL)

### üìàüìâ **–î–≤—ñ —Ñ–∞–∑–∏ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è**

```
–§–∞–∑–∞ –∑—Ä–æ—Å—Ç–∞–Ω–Ω—è (Growing):
‚Üó –û—Ç—Ä–∏–º–∞–Ω–Ω—è –Ω–æ–≤–∏—Ö –±–ª–æ–∫—É–≤–∞–Ω—å
‚úó –ó–∞–±–æ—Ä–æ–Ω–∞ –∑–≤—ñ–ª—å–Ω–µ–Ω–Ω—è

–§–∞–∑–∞ —Å–∫–æ—Ä–æ—á–µ–Ω–Ω—è (Shrinking):
‚Üò –ó–≤—ñ–ª—å–Ω–µ–Ω–Ω—è –±–ª–æ–∫—É–≤–∞–Ω—å
‚úó –ó–∞–±–æ—Ä–æ–Ω–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –Ω–æ–≤–∏—Ö
```

### –ü—Ä–∏–∫–ª–∞–¥ 2PL

```
BEGIN
  LOCK-S(A)      ‚Üê –§–∞–∑–∞ –∑—Ä–æ—Å—Ç–∞–Ω–Ω—è
  READ(A)
  LOCK-X(B)      ‚Üê –§–∞–∑–∞ –∑—Ä–æ—Å—Ç–∞–Ω–Ω—è
  WRITE(B)
  UNLOCK(A)      ‚Üê –§–∞–∑–∞ —Å–∫–æ—Ä–æ—á–µ–Ω–Ω—è
  UNLOCK(B)      ‚Üê –§–∞–∑–∞ —Å–∫–æ—Ä–æ—á–µ–Ω–Ω—è
COMMIT
```

## –°—Ç—Ä–æ–≥–∏–π 2PL (Strict 2PL)

### üîí **–£—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ COMMIT**

```
BEGIN
  LOCK-S(A)
  READ(A)
  LOCK-X(B)
  WRITE(B)
  // –ë–ª–æ–∫—É–≤–∞–Ω–Ω—è –ù–ï –∑–≤—ñ–ª—å–Ω—è—é—Ç—å—Å—è!
COMMIT ‚Üê –¢—É—Ç –∑–≤—ñ–ª—å–Ω—è—é—Ç—å—Å—è –í–°–Ü –±–ª–æ–∫—É–≤–∞–Ω–Ω—è
```

**–ü–µ—Ä–µ–≤–∞–≥–∏:**
- –ó–∞–ø–æ–±—ñ–≥–∞—î –∫–∞—Å–∫–∞–¥–Ω–∏–º –≤—ñ–¥–∫–∞—Ç–∞–º
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –≤ –±—ñ–ª—å—à–æ—Å—Ç—ñ –°–£–ë–î
- –ì–∞—Ä–∞–Ω—Ç—É—î —Å–µ—Ä—ñ–∞–ª—ñ–∑–æ–≤–Ω—ñ—Å—Ç—å

## –ì—Ä–∞–Ω—É–ª—è—Ä–Ω—ñ—Å—Ç—å –±–ª–æ–∫—É–≤–∞–Ω–Ω—è

### üéØ **–†—ñ–∑–Ω—ñ —Ä—ñ–≤–Ω—ñ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è**

```
üìä –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö
  ‚îú‚îÄ üìã –¢–∞–±–ª–∏—Ü—è
  ‚îÇ   ‚îú‚îÄ üìÑ –°—Ç–æ—Ä—ñ–Ω–∫–∞
  ‚îÇ   ‚îÇ   ‚îî‚îÄ üìù –†—è–¥–æ–∫ (–Ω–∞–π–¥—Ä—ñ–±–Ω—ñ—à–µ)
  ‚îÇ   ‚îî‚îÄ üîç –Ü–Ω–¥–µ–∫—Å
```

### –í–∏–±—ñ—Ä –≥—Ä–∞–Ω—É–ª—è—Ä–Ω–æ—Å—Ç—ñ

**–ë–ª–æ–∫—É–≤–∞–Ω–Ω—è —Ä—è–¥–∫–∞:**
```sql
SELECT * FROM accounts
WHERE account_id = 'ACC001' FOR UPDATE;
-- –ë–ª–æ–∫—É—î—Ç—å—Å—è –õ–ò–®–ï –æ–¥–∏–Ω —Ä—è–¥–æ–∫
```

**–ë–ª–æ–∫—É–≤–∞–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—ñ:**
```sql
LOCK TABLE accounts IN EXCLUSIVE MODE;
-- –ë–ª–æ–∫—É—î—Ç—å—Å—è –í–°–Ø —Ç–∞–±–ª–∏—Ü—è
```

## –ü—Ä–æ—Ç–æ–∫–æ–ª –ø–æ–∑–Ω–∞—á–æ–∫ —á–∞—Å—É

### ‚è∞ **–ë–µ–∑ –±–ª–æ–∫—É–≤–∞–Ω—å!**

–ö–æ–∂–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è T –æ—Ç—Ä–∏–º—É—î —É–Ω—ñ–∫–∞–ª—å–Ω—É –ø–æ–∑–Ω–∞—á–∫—É **TS(T)**

```
–î–ª—è –∫–æ–∂–Ω–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞ X –∑–±–µ—Ä—ñ–≥–∞—î–º–æ:
- read_TS(X): –æ—Å—Ç–∞–Ω–Ω—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è, —â–æ —á–∏—Ç–∞–ª–∞
- write_TS(X): –æ—Å—Ç–∞–Ω–Ω—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è, —â–æ –ø–∏—Å–∞–ª–∞
```

### –ü—Ä–∞–≤–∏–ª–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª—É

**READ(X) –≤—ñ–¥ T:**
```
–Ø–∫—â–æ TS(T) < write_TS(X):
  ROLLBACK T  // –ó–∞—Å—Ç–∞—Ä—ñ–ª–µ —á–∏—Ç–∞–Ω–Ω—è
–Ü–Ω–∞–∫—à–µ:
  –í–∏–∫–æ–Ω–∞—Ç–∏ READ(X)
  read_TS(X) = max(read_TS(X), TS(T))
```

**WRITE(X) –≤—ñ–¥ T:**
```
–Ø–∫—â–æ TS(T) < read_TS(X):
  ROLLBACK T  // –ü—ñ–∑–Ω—ñ–π –∑–∞–ø–∏—Å
–Ü–Ω–∞–∫—à–µ:
  –í–∏–∫–æ–Ω–∞—Ç–∏ WRITE(X)
  write_TS(X) = TS(T)
```

## –û–ø—Ç–∏–º—ñ—Å—Ç–∏—á–Ω–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è (OCC)

### üòä **–ü—Ä–∏–ø—É—Å–∫–∞—î–º–æ, —â–æ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—ñ–≤ –Ω–µ–º–∞—î**

```mermaid
graph LR
    A[–§–∞–∑–∞ —á–∏—Ç–∞–Ω–Ω—è<br/>Read Phase] --> B[–§–∞–∑–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó<br/>Validation Phase]
    B --> C[–§–∞–∑–∞ –∑–∞–ø–∏—Å—É<br/>Write Phase]

    B --> D[ROLLBACK<br/>–ø—Ä–∏ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—ñ]
```

### –¢—Ä–∏ —Ñ–∞–∑–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è

**1. –§–∞–∑–∞ —á–∏—Ç–∞–Ω–Ω—è:**
- –ß–∏—Ç–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö –∑ –ë–î
- –ó–º—ñ–Ω–∏ —É –ª–æ–∫–∞–ª—å–Ω–æ–º—É –±—É—Ñ–µ—Ä—ñ
- –§–æ—Ä–º—É–≤–∞–Ω–Ω—è read_set —Ç–∞ write_set

**2. –§–∞–∑–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó:**
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—ñ–≤
- –Ø–∫—â–æ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç ‚Üí ROLLBACK
- –Ø–∫—â–æ OK ‚Üí –ø–µ—Ä–µ—Ö—ñ–¥ –¥–æ –∑–∞–ø–∏—Å—É

**3. –§–∞–∑–∞ –∑–∞–ø–∏—Å—É:**
- –ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –∑–º—ñ–Ω –¥–æ –ë–î
- COMMIT

## –ü—Ä–∏–∫–ª–∞–¥ OCC

### üìù **–†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –ø—Ä–æ—Ñ—ñ–ª—é –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞**

```sql
BEGIN TRANSACTION;

-- –§–∞–∑–∞ —á–∏—Ç–∞–Ω–Ω—è
SELECT name, email, version FROM users WHERE user_id = 123;
-- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑–∞–ø–æ–≤–Ω—é—î —Ñ–æ—Ä–º—É (–º–æ–∂–ª–∏–≤–æ, —Ö–≤–∏–ª–∏–Ω–∏)

-- –§–∞–∑–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó + –∑–∞–ø–∏—Å—É
IF (SELECT version FROM users WHERE user_id = 123) = original_version THEN
    -- –í–µ—Ä—Å—ñ—è –Ω–µ –∑–º—ñ–Ω–∏–ª–∞—Å—å ‚Üí OK
    UPDATE users SET name = '–ù–æ–≤–µ —ñ–º''—è', version = version + 1
    WHERE user_id = 123;
    COMMIT;
ELSE
    -- –•—Ç–æ—Å—å —ñ–Ω—à–∏–π –∑–º—ñ–Ω–∏–≤ –¥–∞–Ω—ñ
    ROLLBACK;
END IF;
```

**–ï—Ñ–µ–∫—Ç–∏–≤–Ω–æ –ø—Ä–∏ —Ä—ñ–¥–∫—ñ—Å–Ω–∏—Ö –∫–æ–Ω—Ñ–ª—ñ–∫—Ç–∞—Ö!**

## **5. –í–∑–∞—î–º–æ–±–ª–æ–∫—É–≤–∞–Ω–Ω—è (Deadlock)**

## –©–æ —Ç–∞–∫–µ Deadlock?

### üîÑ **–¶–∏–∫–ª—ñ—á–Ω–µ –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è**

```
–¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è T1:          –¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è T2:
LOCK-X(A) ‚úì             LOCK-X(B) ‚úì
READ(A)                 READ(B)

LOCK-X(B) ‚è≥            LOCK-X(A) ‚è≥
—á–µ–∫–∞—î –Ω–∞ T2...          —á–µ–∫–∞—î –Ω–∞ T1...

–ì—Ä–∞—Ñ –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è:
T1 ‚Üí T2 ‚Üí T1  (–¶–ò–ö–õ!)
```

**–ñ–æ–¥–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è –Ω–µ –º–æ–∂–µ –ø—Ä–æ–¥–æ–≤–∂–∏—Ç–∏!**

## –î–µ—Ç–∞–ª—å–Ω–∏–π –ø—Ä–∏–∫–ª–∞–¥ Deadlock

```sql
-- –ß–∞—Å t1: T1
BEGIN TRANSACTION;
UPDATE accounts SET balance = balance - 100
WHERE account_id = 'ACC001';
-- T1 —Ç—Ä–∏–º–∞—î X-lock –Ω–∞ ACC001

-- –ß–∞—Å t2: T2
BEGIN TRANSACTION;
UPDATE accounts SET balance = balance - 200
WHERE account_id = 'ACC002';
-- T2 —Ç—Ä–∏–º–∞—î X-lock –Ω–∞ ACC002

-- –ß–∞—Å t3: T1 –ø–æ—Ç—Ä–µ–±—É—î ACC002
UPDATE accounts SET balance = balance + 100
WHERE account_id = 'ACC002';
-- ‚è≥ –ß–µ–∫–∞—î –Ω–∞ T2

-- –ß–∞—Å t4: T2 –ø–æ—Ç—Ä–µ–±—É—î ACC001
UPDATE accounts SET balance = balance + 200
WHERE account_id = 'ACC001';
-- ‚è≥ –ß–µ–∫–∞—î –Ω–∞ T1

-- üí• DEADLOCK!
```

## –ó–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è Deadlock

### 1Ô∏è‚É£ **–£–ø–æ—Ä—è–¥–∫—É–≤–∞–Ω–Ω—è —Ä–µ—Å—É—Ä—Å—ñ–≤**

```sql
-- ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –∑–∞–≤–∂–¥–∏ –±–ª–æ–∫—É–≤–∞—Ç–∏ –≤ –ø–æ—Ä—è–¥–∫—É –∑—Ä–æ—Å—Ç–∞–Ω–Ω—è ID
CREATE PROCEDURE transfer_money(from_acc, to_acc, amount)
BEGIN
    -- –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è –ø–æ—Ä—è–¥–∫—É –±–ª–æ–∫—É–≤–∞–Ω–Ω—è
    IF from_acc < to_acc THEN
        first = from_acc; second = to_acc;
    ELSE
        first = to_acc; second = from_acc;
    END IF;

    BEGIN TRANSACTION;
    SELECT balance FROM accounts WHERE account_id = first FOR UPDATE;
    SELECT balance FROM accounts WHERE account_id = second FOR UPDATE;
    -- –í–∏–∫–æ–Ω–∞—Ç–∏ –ø–µ—Ä–µ–∫–∞–∑
    COMMIT;
END;
```

### 2Ô∏è‚É£ **–¢–∞–π–º-–∞—É—Ç–∏**

```sql
SET lock_timeout = '5s';

BEGIN TRANSACTION;
UPDATE accounts...  -- –Ø–∫—â–æ –Ω–µ –æ—Ç—Ä–∏–º–∞–Ω–æ lock –∑–∞ 5—Å ‚Üí ERROR
COMMIT;
```

## –í–∏—è–≤–ª–µ–Ω–Ω—è Deadlock

### üîç **–ì—Ä–∞—Ñ –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è (Wait-For Graph)**

```
–°—Ç–∞–Ω –±–ª–æ–∫—É–≤–∞–Ω—å:
T1 —Ç—Ä–∏–º–∞—î X-lock(A), —á–µ–∫–∞—î X-lock(B)
T2 —Ç—Ä–∏–º–∞—î X-lock(B), —á–µ–∫–∞—î X-lock(C)
T3 —Ç—Ä–∏–º–∞—î X-lock(C), —á–µ–∫–∞—î X-lock(A)

–ì—Ä–∞—Ñ –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è:
T1 ‚Üí T2 ‚Üí T3 ‚Üí T1

–í–∏—è–≤–ª–µ–Ω–æ –¶–ò–ö–õ = DEADLOCK!
```

### –í–∏–±—ñ—Ä –∂–µ—Ä—Ç–≤–∏

**–ö—Ä–∏—Ç–µ—Ä—ñ—ó –≤–∏–±–æ—Ä—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó –¥–ª—è –≤—ñ–¥–∫–∞—Ç—É:**
- –í—ñ–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó (–≤—ñ–¥–∫–æ—Ç–∏—Ç–∏ –º–æ–ª–æ–¥—à—É)
- –ö—ñ–ª—å–∫—ñ—Å—Ç—å –≤–∏–∫–æ–Ω–∞–Ω–æ—ó —Ä–æ–±–æ—Ç–∏ (–º–µ–Ω—à–µ —Ä–æ–±–æ—Ç–∏)
- –ö—ñ–ª—å–∫—ñ—Å—Ç—å –±–ª–æ–∫—É–≤–∞–Ω—å
- –ü–æ–ø–µ—Ä–µ–¥–Ω—ñ –≤—ñ–¥–∫–∞—Ç–∏ (—É–Ω–∏–∫–∞—Ç–∏ –≥–æ–ª–æ–¥—É–≤–∞–Ω–Ω—è)

## –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ Deadlock

### üìä **PostgreSQL**

```sql
-- –ü–µ—Ä–µ–≥–ª—è–¥ –±–ª–æ–∫—É–≤–∞–Ω—å
SELECT
    blocked_locks.pid AS blocked_pid,
    blocking_locks.pid AS blocking_pid,
    blocked_activity.query AS blocked_statement,
    blocking_activity.query AS blocking_statement
FROM pg_locks blocked_locks
JOIN pg_locks blocking_locks ON ...
WHERE NOT blocked_locks.granted;

-- –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –¥–µ—Ç–µ–∫—Ç–æ—Ä–∞
SHOW deadlock_timeout;  -- –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º 1s
SET log_lock_waits = on;
```

## **6. MVCC**

## –ë–∞–≥–∞—Ç–æ–≤–µ—Ä—Å—ñ–π–Ω–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ—Å—Ç—ñ

### üîÑ **–ö—ñ–ª—å–∫–∞ –≤–µ—Ä—Å—ñ–π –∫–æ–∂–Ω–æ–≥–æ –æ–±'—î–∫—Ç–∞**

```
–¢—Ä–∞–¥–∏—Ü—ñ–π–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥:
T1: WRITE(X) ‚Üí X –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ
T2: READ(X) ‚Üí —á–µ–∫–∞—î –Ω–∞ T1 ‚è≥

MVCC –ø—ñ–¥—Ö—ñ–¥:
T1: WRITE(X) ‚Üí —Å—Ç–≤–æ—Ä—é—î –≤–µ—Ä—Å—ñ—é X‚ÇÇ
T2: READ(X) ‚Üí —á–∏—Ç–∞—î –≤–µ—Ä—Å—ñ—é X‚ÇÅ  ‚úì –ë–µ–∑ –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è!
```

### –û—Å–Ω–æ–≤–Ω–∞ —ñ–¥–µ—è

**–ß–∏—Ç–∞–Ω–Ω—è –Ω–µ –±–ª–æ–∫—É—î –∑–∞–ø–∏—Å**
**–ó–∞–ø–∏—Å –Ω–µ –±–ª–æ–∫—É—î —á–∏—Ç–∞–Ω–Ω—è**

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤–µ—Ä—Å—ñ–π

### üì¶ **–õ–∞–Ω—Ü—é–≥ –≤–µ—Ä—Å—ñ–π –æ–±'—î–∫—Ç–∞**

```
X‚ÇÅ: value=100, created=T1, deleted=T3 ‚Üí X‚ÇÇ
X‚ÇÇ: value=150, created=T3, deleted=T5 ‚Üí X‚ÇÉ
X‚ÇÉ: value=200, created=T5, deleted=NULL (–∞–∫—Ç–∏–≤–Ω–∞)
```

### –ü—Ä–∞–≤–∏–ª–∞ —á–∏—Ç–∞–Ω–Ω—è –≤–µ—Ä—Å—ñ—ó

–¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è T –º–æ–∂–µ –ø—Ä–æ—á–∏—Ç–∞—Ç–∏ –≤–µ—Ä—Å—ñ—é X·µ¢, —è–∫—â–æ:

```
1. created(X·µ¢) ‚â§ TS(T)
   ‚úì –í–µ—Ä—Å—ñ—è —Å—Ç–≤–æ—Ä–µ–Ω–∞ –¥–æ –∞–±–æ –≤ –º–æ–º–µ–Ω—Ç –ø–æ—á–∞—Ç–∫—É T

2. deleted(X·µ¢) > TS(T) –ê–ë–û deleted(X·µ¢) = NULL
   ‚úì –í–µ—Ä—Å—ñ—è –Ω–µ –≤–∏–¥–∞–ª–µ–Ω–∞ –∞–±–æ –≤–∏–¥–∞–ª–µ–Ω–∞ –ø—ñ—Å–ª—è T
```

## –°–Ω–∞–ø—à–æ—Ç —ñ–∑–æ–ª—è—Ü—ñ—è

### üì∏ **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–∏–π –∑–Ω—ñ–º–æ–∫ –¥–∞–Ω–∏—Ö**

```sql
-- T1 —Ä–æ–∑–ø–æ—á–∞—Ç–∞ –≤ –º–æ–º–µ–Ω—Ç —á–∞—Å—É 10
BEGIN TRANSACTION ISOLATION LEVEL REPEATABLE READ;

SELECT balance FROM accounts WHERE account_id = 'ACC001';
-- –ë–∞–ª–∞–Ω—Å: 1000 (—Å–Ω–∞–ø—à–æ—Ç –Ω–∞ –º–æ–º–µ–Ω—Ç 10)

-- T2 –∑–º—ñ–Ω—é—î –±–∞–ª–∞–Ω—Å –Ω–∞ 2000 —ñ —Ñ—ñ–∫—Å—É—î (–º–æ–º–µ–Ω—Ç 20)

-- T1 –ø—Ä–æ–¥–æ–≤–∂—É—î
SELECT balance FROM accounts WHERE account_id = 'ACC001';
-- –ë–∞–ª–∞–Ω—Å: 1000 (–≤—Å–µ —â–µ –±–∞—á–∏—Ç—å —Å–Ω–∞–ø—à–æ—Ç –Ω–∞ –º–æ–º–µ–Ω—Ç 10!)

COMMIT;
```

**–¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è –±–∞—á–∏—Ç—å –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–∏–π —Å—Ç–∞–Ω –Ω–∞ –º–æ–º–µ–Ω—Ç –ø–æ—á–∞—Ç–∫—É**

## –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –≤ PostgreSQL

### üêò **XID —Ç–∞ ctid**

```
–ö–æ—Ä—Ç–µ–∂ –≤ PostgreSQL:

account_id = 'ACC001'
balance = 1000
xmin = 100  ‚Üê —Å—Ç–≤–æ—Ä–µ–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—î—é 100
xmax = 150  ‚Üê –≤–∏–¥–∞–ª–µ–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—î—é 150
ctid = (0,1) ‚Üí –≤–∫–∞–∑—É—î –Ω–∞ –Ω–∞—Å—Ç—É–ø–Ω—É –≤–µ—Ä—Å—ñ—é

–¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è –∑ XID = 140:
‚úì –ë–∞—á–∏—Ç—å —Ü–µ–π –∫–æ—Ä—Ç–µ–∂ (xmin < 140, xmax > 140)

–¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è –∑ XID = 160:
‚úó –ù–µ –±–∞—á–∏—Ç—å (xmax = 150 < 160)
```

## –û—á–∏—â–µ–Ω–Ω—è —Å—Ç–∞—Ä–∏—Ö –≤–µ—Ä—Å—ñ–π

### üßπ **VACUUM**

```sql
-- –†—É—á–Ω–µ –æ—á–∏—â–µ–Ω–Ω—è
VACUUM accounts;

-- –ó –∞–Ω–∞–ª—ñ–∑–æ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
VACUUM ANALYZE accounts;

-- –ü–æ–≤–Ω–µ –æ—á–∏—â–µ–Ω–Ω—è (–±–ª–æ–∫—É—î —Ç–∞–±–ª–∏—Ü—é!)
VACUUM FULL accounts;
```

### –ö–æ–ª–∏ –ø–æ—Ç—Ä—ñ–±–µ–Ω VACUUM?

```
–ö—Ä–∏—Ç–µ—Ä—ñ—ó –≤–∏–¥–∞–ª–µ–Ω–Ω—è –≤–µ—Ä—Å—ñ—ó X·µ¢:
1. deleted(X·µ¢) ‚â† NULL
2. deleted(X·µ¢) < min(TS –≤—Å—ñ—Ö –∞–∫—Ç–∏–≤–Ω–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π)
3. –¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∑–∞—Ñ—ñ–∫—Å–æ–≤–∞–Ω–∞

‚Üí –ñ–æ–¥–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è –Ω–µ –º–æ–∂–µ –ø–æ–±–∞—á–∏—Ç–∏ —Ü—é –≤–µ—Ä—Å—ñ—é
```

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ—á–∏—â–µ–Ω–Ω—è

### ‚öôÔ∏è **Autovacuum**

```sql
-- –ê–≥—Ä–µ—Å–∏–≤–Ω–µ –æ—á–∏—â–µ–Ω–Ω—è –¥–ª—è —á–∞—Å—Ç–∏—Ö –æ–Ω–æ–≤–ª–µ–Ω—å
ALTER TABLE accounts SET (
    autovacuum_vacuum_scale_factor = 0.05,
    autovacuum_vacuum_threshold = 50
);

-- –í—ñ–¥–∫–ª–∞–¥–µ–Ω–µ –¥–ª—è —Ä—ñ–¥–∫–∏—Ö –æ–Ω–æ–≤–ª–µ–Ω—å
ALTER TABLE audit_log SET (
    autovacuum_vacuum_scale_factor = 0.4
);
```

### –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Ä–æ–∑–¥—É–≤–∞–Ω–Ω—è

```sql
SELECT
    tablename,
    n_live_tup,
    n_dead_tup,
    ROUND(n_dead_tup * 100.0 /
          NULLIF(n_live_tup + n_dead_tup, 0), 2) AS dead_ratio
FROM pg_stat_user_tables
WHERE n_dead_tup > 1000
ORDER BY dead_ratio DESC;
```

## –ü–µ—Ä–µ–≤–∞–≥–∏ MVCC

### ‚úÖ **–í–∏—Å–æ–∫–∞ –ø–∞—Ä–∞–ª–µ–ª—å–Ω—ñ—Å—Ç—å**

**–¢—Ä–∞–¥–∏—Ü—ñ–π–Ω–µ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è:**
```
T1: UPDATE accounts ‚Üí –±–ª–æ–∫—É—î –≤—Å—é —Ç–∞–±–ª–∏—Ü—é
T2: SELECT * ‚Üí —á–µ–∫–∞—î... ‚è≥
```

**MVCC:**
```
T1: UPDATE accounts ‚Üí —Å—Ç–≤–æ—Ä—é—î –Ω–æ–≤—É –≤–µ—Ä—Å—ñ—é
T2: SELECT * ‚Üí —á–∏—Ç–∞—î —Å—Ç–∞—Ä—É –≤–µ—Ä—Å—ñ—é ‚úì –ë–µ–∑ –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è!
```

### ‚úÖ **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–µ —á–∏—Ç–∞–Ω–Ω—è**

```sql
BEGIN TRANSACTION;
SELECT COUNT(*) FROM products;  -- 100

-- –Ü–Ω—à–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è –¥–æ–¥–∞—î 10 –ø—Ä–æ–¥—É–∫—Ç—ñ–≤

SELECT COUNT(*) FROM products;  -- –í—Å–µ –æ–¥–Ω–æ 100!
COMMIT;
```

## –ù–µ–¥–æ–ª—ñ–∫–∏ MVCC

### ‚ùå **–†–æ–∑–¥—É–≤–∞–Ω–Ω—è –ë–î**

```
–ü–æ—á–∞—Ç–∫–æ–≤–∏–π —Ä–æ–∑–º—ñ—Ä: 1 GB (1 –º–ª–Ω —Ä—è–¥–∫—ñ–≤)

–ü—ñ—Å–ª—è 1000 –æ–Ω–æ–≤–ª–µ–Ω—å –∫–æ–∂–Ω–æ–≥–æ —Ä—è–¥–∫–∞:
- –§—ñ–∑–∏—á–Ω–∏–π —Ä–æ–∑–º—ñ—Ä: ~1000 GB
- –ê–∫—Ç–∏–≤–Ω—ñ –¥–∞–Ω—ñ: 1 GB
- "–ú–µ—Ä—Ç–≤—ñ" –≤–µ—Ä—Å—ñ—ó: 999 GB

–ù–µ–æ–±—Ö—ñ–¥–Ω–µ —Ä–µ–≥—É–ª—è—Ä–Ω–µ VACUUM!
```

### ‚ùå **–í–∞—Ä—Ç—ñ—Å—Ç—å –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è**

- –†–µ–≥—É–ª—è—Ä–Ω–∏–π VACUUM —Å–ø–æ–∂–∏–≤–∞—î —Ä–µ—Å—É—Ä—Å–∏
- –†–æ–∑–¥—É–≤–∞–Ω–Ω—è —ñ–Ω–¥–µ–∫—Å—ñ–≤ –ø–æ—Ç—Ä–µ–±—É—î REINDEX
- –î–æ–≤–≥—ñ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó –±–ª–æ–∫—É—é—Ç—å –æ—á–∏—â–µ–Ω–Ω—è
- –ù–µ–æ–±—Ö—ñ–¥–Ω–∏–π –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Ç–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

## **7. –ü—Ä–∞–∫—Ç–∏—á–Ω—ñ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó**

## –í–∏–±—ñ—Ä —Ä—ñ–≤–Ω—è —ñ–∑–æ–ª—è—Ü—ñ—ó

### üéØ **–ó–∞ —Ç–∏–ø–æ–º –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É**

**–í–µ–±–∑–∞—Å—Ç–æ—Å—É–Ω–∫–∏:**
```sql
SET TRANSACTION ISOLATION LEVEL READ COMMITTED;
```
‚úì –ë–∞–ª–∞–Ω—Å –∫–æ—Ä–µ–∫—Ç–Ω–æ—Å—Ç—ñ —Ç–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
‚úì –ü—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è –±—ñ–ª—å—à–æ—Å—Ç—ñ CRUD

**–§—ñ–Ω–∞–Ω—Å–æ–≤—ñ —Å–∏—Å—Ç–µ–º–∏:**
```sql
SET TRANSACTION ISOLATION LEVEL REPEATABLE READ;
```
‚úì –ö—Ä–∏—Ç–∏—á–Ω–∞ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ñ—Å—Ç—å
‚úì –ó–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è –Ω–µ–ø–æ–≤—Ç–æ—Ä—é–≤–∞–Ω–æ–º—É —á–∏—Ç–∞–Ω–Ω—é

**–ê–Ω–∞–ª—ñ—Ç–∏–∫–∞/–∑–≤—ñ—Ç–∏:**
```sql
SET TRANSACTION ISOLATION LEVEL READ COMMITTED;
```
‚úì –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –≤–∞–∂–ª–∏–≤—ñ—à–∞ –∑–∞ —Ç–æ—á–Ω—ñ—Å—Ç—å
‚úì –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π –≤–ø–ª–∏–≤ –Ω–∞ –æ–ø–µ—Ä–∞—Ü—ñ–π–Ω—ñ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó

## –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π

### 1Ô∏è‚É£ **–ú—ñ–Ω—ñ–º—ñ–∑–∞—Ü—ñ—è —Ä–æ–∑–º—ñ—Ä—É**

```sql
-- ‚ùå –ü–û–ì–ê–ù–û: –¥–æ–≤–≥–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è
BEGIN TRANSACTION;
FOR each IN (1..1000000) LOOP
    UPDATE processed SET status = 'done' WHERE id = each;
END LOOP;
COMMIT;  -- –£—Ç—Ä–∏–º—É—î –±–ª–æ–∫—É–≤–∞–Ω–Ω—è –¥—É–∂–µ –¥–æ–≤–≥–æ!

-- ‚úÖ –î–û–ë–†–ï: –ø–∞–∫–µ—Ç–Ω–∞ –æ–±—Ä–æ–±–∫–∞
FOR batch IN 1..1000 LOOP
    BEGIN TRANSACTION;
    UPDATE processed SET status = 'done'
    WHERE id BETWEEN batch*1000 AND (batch+1)*1000;
    COMMIT;  -- –®–≤–∏–¥–∫–µ –∑–≤—ñ–ª—å–Ω–µ–Ω–Ω—è!
END LOOP;
```

### 2Ô∏è‚É£ **–ü—Ä–∞–≤–∏–ª—å–Ω–∏–π –ø–æ—Ä—è–¥–æ–∫ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è**

```sql
-- ‚ùå –ü–û–ì–ê–ù–û: –Ω–µ—É–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–µ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è
BEGIN TRANSACTION;
UPDATE accounts SET balance = balance - 100 WHERE account_id = 'ACC002';
UPDATE accounts SET balance = balance + 100 WHERE account_id = 'ACC001';
COMMIT;  -- –†–∏–∑–∏–∫ deadlock!

-- ‚úÖ –î–û–ë–†–ï: –∑–∞–≤–∂–¥–∏ –≤ –ø–æ—Ä—è–¥–∫—É –∑—Ä–æ—Å—Ç–∞–Ω–Ω—è ID
BEGIN TRANSACTION;
UPDATE accounts SET balance = balance + 100 WHERE account_id = 'ACC001';
UPDATE accounts SET balance = balance - 100 WHERE account_id = 'ACC002';
COMMIT;  -- –ë–µ–∑ deadlock!
```

## –û–ø—Ç–∏–º—ñ—Å—Ç–∏—á–Ω–µ vs –ü–µ—Å–∏–º—ñ—Å—Ç–∏—á–Ω–µ

### üòä **–û–ø—Ç–∏–º—ñ—Å—Ç–∏—á–Ω–µ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è**

**–ö–æ–ª–∏:** —Ä—ñ–¥–∫—ñ—Å–Ω—ñ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç–∏

```sql
BEGIN TRANSACTION;
SELECT balance, version FROM accounts WHERE account_id = 'ACC001';

-- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –ø—Ä–∞—Ü—é—î –∑ –¥–∞–Ω–∏–º–∏...

UPDATE accounts
SET balance = new_balance, version = version + 1
WHERE account_id = 'ACC001' AND version = old_version;

IF ROW_COUNT = 0 THEN
    ROLLBACK;  -- –î–∞–Ω—ñ –∑–º—ñ–Ω–∏–ª–∏—Å—å
ELSE
    COMMIT;
END IF;
```

### üòê **–ü–µ—Å–∏–º—ñ—Å—Ç–∏—á–Ω–µ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è**

**–ö–æ–ª–∏:** —á–∞—Å—Ç—ñ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç–∏

```sql
BEGIN TRANSACTION;

SELECT balance FROM accounts
WHERE account_id = 'ACC001' FOR UPDATE;
-- –ù–µ–≥–∞–π–Ω–æ –æ—Ç—Ä–∏–º–∞—Ç–∏ X-lock

UPDATE accounts SET balance = new_balance
WHERE account_id = 'ACC001';

COMMIT;
```

## –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π

### üìä **–ü–æ—Ç–æ—á–Ω—ñ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è**

```sql
-- PostgreSQL
SELECT
    l.pid,
    l.locktype,
    l.mode,
    l.granted,
    a.query,
    a.wait_event
FROM pg_locks l
JOIN pg_stat_activity a ON l.pid = a.pid
WHERE NOT l.granted;
```

### üìä **–î–æ–≤–≥—ñ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó**

```sql
SELECT
    pid,
    now() - xact_start AS duration,
    state,
    query
FROM pg_stat_activity
WHERE xact_start IS NOT NULL
  AND now() - xact_start > interval '5 minutes'
ORDER BY duration DESC;
```

## –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ MVCC

### üîç **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–∞–±–ª–∏—Ü—å**

```sql
SELECT
    tablename,
    n_tup_ins AS inserts,
    n_tup_upd AS updates,
    n_tup_del AS deletes,
    n_live_tup AS live,
    n_dead_tup AS dead,
    last_vacuum,
    last_autovacuum
FROM pg_stat_user_tables
ORDER BY n_dead_tup DESC;
```

### üîç **–†–æ–∑–¥—É–≤–∞–Ω–Ω—è (Bloat)**

```sql
SELECT
    schemaname,
    tablename,
    pg_size_pretty(pg_total_relation_size(
        schemaname||'.'||tablename)) AS size,
    ROUND(n_dead_tup * 100.0 /
          NULLIF(n_live_tup + n_dead_tup, 0), 2) AS dead_ratio
FROM pg_stat_user_tables
WHERE n_live_tup > 0
ORDER BY dead_ratio DESC;
```

## –°—Ç—Ä–∞—Ç–µ–≥—ñ—ó –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è

### üóìÔ∏è **–†–µ–≥—É–ª—è—Ä–Ω–µ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è**

```sql
-- –©–æ–¥–µ–Ω–Ω–æ: –∫—Ä–∏—Ç–∏—á–Ω—ñ —Ç–∞–±–ª–∏—Ü—ñ
VACUUM ANALYZE accounts;
VACUUM ANALYZE transactions;

-- –©–æ—Ç–∏–∂–Ω–µ–≤–æ: –ø–µ—Ä–µ–±—É–¥–æ–≤–∞ —ñ–Ω–¥–µ–∫—Å—ñ–≤
REINDEX TABLE CONCURRENTLY accounts;

-- –©–æ–º—ñ—Å—è—á–Ω–æ: –ø–æ–≤–Ω–µ –æ—á–∏—â–µ–Ω–Ω—è (—É –≤—ñ–∫–Ω–æ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è)
VACUUM FULL accounts;  -- –ë–ª–æ–∫—É—î —Ç–∞–±–ª–∏—Ü—é!
```

### ‚öôÔ∏è **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—è**

```bash
# Cron job –¥–ª—è –Ω—ñ—á–Ω–æ–≥–æ VACUUM
0 2 * * * psql -d mydb -c "VACUUM ANALYZE accounts;"

# –ê–±–æ pg_cron extension
SELECT cron.schedule('nightly-vacuum',
    '0 2 * * *',
    'VACUUM ANALYZE accounts');
```

## –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤

### üîß **PostgreSQL**

```sql
-- –õ–æ–≥—É–≤–∞–Ω–Ω—è –ø–æ–≤—ñ–ª—å–Ω–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤
SET log_min_duration_statement = 1000;  -- –º—Å

-- –¢–∞–π–º-–∞—É—Ç –±–ª–æ–∫—É–≤–∞–Ω–Ω—è
SET lock_timeout = '5s';

-- –î–µ—Ç–µ–∫—Ç–æ—Ä deadlock
SET deadlock_timeout = '1s';

-- –õ–æ–≥—É–≤–∞–Ω–Ω—è –±–ª–æ–∫—É–≤–∞–Ω—å
SET log_lock_waits = on;
```

### üîß **Autovacuum**

```sql
-- –î–ª—è —Ç–∞–±–ª–∏—Ü—å –∑ —á–∞—Å—Ç–∏–º–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è–º–∏
ALTER TABLE hot_table SET (
    autovacuum_vacuum_scale_factor = 0.05,
    autovacuum_vacuum_threshold = 50
);

-- –î–ª—è –≤–µ–ª–∏–∫–∏—Ö —Ç–∞–±–ª–∏—Ü—å –∑ —Ä—ñ–¥–∫–∏–º–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è–º–∏
ALTER TABLE cold_table SET (
    autovacuum_vacuum_scale_factor = 0.4,
    autovacuum_vacuum_threshold = 1000
);
```

## –ü–æ—à–∏—Ä–µ–Ω—ñ –ø–æ–º–∏–ª–∫–∏

### ‚ùå **–ü–æ–º–∏–ª–∫–∞ 1: –î–æ–≤–≥—ñ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó**

```sql
-- –ü–û–ì–ê–ù–û
BEGIN TRANSACTION;
-- –°–∫–ª–∞–¥–Ω–∞ –æ–±—Ä–æ–±–∫–∞ 10+ —Ö–≤–∏–ª–∏–Ω
-- –ë–ª–æ–∫—É—î VACUUM, –Ω–∞–∫–æ–ø–∏—á—É—î –≤–µ—Ä—Å—ñ—ó
COMMIT;

-- –î–û–ë–†–ï
-- –†–æ–∑–±–∏—Ç–∏ –Ω–∞ –º–µ–Ω—à—ñ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó
-- –ê–±–æ –≤–∏–Ω–µ—Å—Ç–∏ –æ–±—Ä–æ–±–∫—É –∑–∞ –º–µ–∂—ñ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó
```

### ‚ùå **–ü–æ–º–∏–ª–∫–∞ 2: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –ø–æ—Ä—è–¥–æ–∫**

```sql
-- –ü–û–ì–ê–ù–û: deadlock-prone
UPDATE table1 WHERE id = 1;
UPDATE table2 WHERE id = 2;
UPDATE table1 WHERE id = 2;
UPDATE table2 WHERE id = 1;

-- –î–û–ë–†–ï: –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–∏–π –ø–æ—Ä—è–¥–æ–∫
UPDATE table1 WHERE id IN (1, 2) ORDER BY id;
UPDATE table2 WHERE id IN (1, 2) ORDER BY id;
```

## –ü–æ—à–∏—Ä–µ–Ω—ñ –ø–æ–º–∏–ª–∫–∏ (–ø—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è)

### ‚ùå **–ü–æ–º–∏–ª–∫–∞ 3: –Ü–≥–Ω–æ—Ä—É–≤–∞–Ω–Ω—è VACUUM**

```sql
-- –ë–µ–∑ —Ä–µ–≥—É–ª—è—Ä–Ω–æ–≥–æ VACUUM:
- –†–æ–∑–¥—É–≤–∞–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—å –Ω–∞ 1000%
- –ü–æ–≤—ñ–ª—å–Ω—ñ –∑–∞–ø–∏—Ç–∏
- –ù–µ–µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ —ñ–Ω–¥–µ–∫—Å–∏
- –ü—Ä–æ–±–ª–µ–º–∏ –∑ –ø–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫–æ–º

-- –†—ñ—à–µ–Ω–Ω—è: –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ + –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—è
```

### ‚ùå **–ü–æ–º–∏–ª–∫–∞ 4: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —Ä—ñ–≤–µ–Ω—å —ñ–∑–æ–ª—è—Ü—ñ—ó**

```sql
-- SERIALIZABLE –¥–ª—è –∑–≤—ñ—Ç—ñ–≤
-- ‚Üí –ó–∞–π–≤—ñ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç–∏ —Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó

-- READ UNCOMMITTED –¥–ª—è —Ñ—ñ–Ω–∞–Ω—Å—ñ–≤
-- ‚Üí –í—Ç—Ä–∞—Ç–∞ –¥–∞–Ω–∏—Ö, –Ω–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ñ—Å—Ç—å

-- –í–∏–±–∏—Ä–∞–π—Ç–µ —Ä—ñ–≤–µ–Ω—å –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ –∑–∞–¥–∞—á—ñ!
```

## –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∏–π —Å–ø–∏—Å–æ–∫ (Checklist)

### ‚úÖ **–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —É –ø—Ä–æ–¥–∞–∫—à–Ω**

**–¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó:**
- ‚òê –í—Å—ñ –∫—Ä–∏—Ç–∏—á–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è—Ö
- ‚òê –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π —Ä–æ–∑–º—ñ—Ä —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π
- ‚òê –ü—Ä–∞–≤–∏–ª—å–Ω–∏–π –ø–æ—Ä—è–¥–æ–∫ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è
- ‚òê –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫ —Ç–∞ –≤—ñ–¥–∫–∞—Ç—ñ–≤

**–†—ñ–≤–µ–Ω—å —ñ–∑–æ–ª—è—Ü—ñ—ó:**
- ‚òê –í–∏–±—Ä–∞–Ω–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ —Ç–∏–ø—É –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É
- ‚òê –ü—Ä–æ—Ç–µ—Å—Ç–æ–≤–∞–Ω–æ –ø—ñ–¥ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è–º
- ‚òê –ü–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ –Ω–∞ deadlock

**–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥:**
- ‚òê –ù–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ –ª–æ–≥—É–≤–∞–Ω–Ω—è
- ‚òê –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ —Ç–∞–π–º-–∞—É—Ç–∏
- ‚òê –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –±–ª–æ–∫—É–≤–∞–Ω—å
- ‚òê –í—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –¥–æ–≤–≥–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π

## –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∏–π —Å–ø–∏—Å–æ–∫ (–ø—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è)

### ‚úÖ **MVCC —Ç–∞ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è**

**Autovacuum:**
- ‚òê –£–≤—ñ–º–∫–Ω–µ–Ω–æ autovacuum
- ‚òê –ù–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –¥–ª—è –∫–æ–∂–Ω–æ—ó —Ç–∞–±–ª–∏—Ü—ñ
- ‚òê –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Ä–æ–∑–¥—É–≤–∞–Ω–Ω—è
- ‚òê –ì—Ä–∞—Ñ—ñ–∫–∏ dead_ratio

**–†–µ–≥—É–ª—è—Ä–Ω–µ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è:**
- ‚òê –ü–ª–∞–Ω–æ–≤—ñ VACUUM ANALYZE
- ‚òê –ü–µ—Ä—ñ–æ–¥–∏—á–Ω–∏–π REINDEX
- ‚òê –í—ñ–∫–Ω–∞ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è –¥–ª—è VACUUM FULL
- ‚òê –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—è —á–µ—Ä–µ–∑ cron/pg_cron

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è:**
- ‚òê –ü—Ä–æ—Ü–µ–¥—É—Ä–∏ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è
- ‚òê –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö
- ‚òê –ö–æ–Ω—Ç–∞–∫—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–∏—Ö

## –ü–æ—Ä—ñ–≤–Ω—è–ª—å–Ω–∞ —Ç–∞–±–ª–∏—Ü—è

### üìä **MVCC vs –ë–ª–æ–∫—É–≤–∞–Ω–Ω—è**

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | MVCC | –ë–ª–æ–∫—É–≤–∞–Ω–Ω—è |
|----------------|------|------------|
| **–ß–∏—Ç–∞–Ω–Ω—è vs –ó–∞–ø–∏—Å** | –ù–µ –±–ª–æ–∫—É—é—Ç—å | –ë–ª–æ–∫—É—é—Ç—å |
| **–ü–∞—Ä–∞–ª–µ–ª—å–Ω—ñ—Å—Ç—å** | –í–∏—Å–æ–∫–∞ | –°–µ—Ä–µ–¥–Ω—è |
| **–ù–∞–∫–ª–∞–¥–Ω—ñ –≤–∏—Ç—Ä–∞—Ç–∏** | –ü—Ä–æ—Å—Ç—ñ—Ä | –ß–∞—Å –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è |
| **–û–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è** | VACUUM | –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–µ |
| **Deadlock** | –†—ñ–¥–∫–æ | –ß–∞—Å—Ç—ñ—à–µ |
| **–î–æ–≤–≥—ñ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó** | –†–æ–∑–¥—É–≤–∞–Ω–Ω—è | –ß–µ—Ä–≥–∏ |

### üìä **–†—ñ–≤–Ω—ñ —ñ–∑–æ–ª—è—Ü—ñ—ó**

| –†—ñ–≤–µ–Ω—å | –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å | –ö–æ—Ä–µ–∫—Ç–Ω—ñ—Å—Ç—å | –ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è |
|--------|----------------|-------------|--------------|
| **READ UNCOMMITTED** | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê | –ó–≤—ñ—Ç–∏ |
| **READ COMMITTED** | ‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê | –í–µ–± |
| **REPEATABLE READ** | ‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê | –§—ñ–Ω–∞–Ω—Å–∏ |
| **SERIALIZABLE** | ‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | –ö—Ä–∏—Ç–∏—á–Ω—ñ |

## –†–µ—Å—É—Ä—Å–∏ –¥–ª—è –ø–æ–¥–∞–ª—å—à–æ–≥–æ –≤–∏–≤—á–µ–Ω–Ω—è

### üìö **–ö–Ω–∏–≥–∏**

- **"Transaction Processing: Concepts and Techniques"** ‚Äî Jim Gray, Andreas Reuter
- **"Designing Data-Intensive Applications"** ‚Äî Martin Kleppmann
- **"PostgreSQL 14 Internals"** ‚Äî Egor Rogov

### üîó **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è**

- PostgreSQL: [www.postgresql.org/docs](https://www.postgresql.org/docs)
- MySQL InnoDB: [dev.mysql.com/doc/innodb](https://dev.mysql.com/doc/innodb)

### üé• **–í—ñ–¥–µ–æ —Ç–∞ –∫—É—Ä—Å–∏**

- CMU Database Systems (YouTube)
- Postgres Conference –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü—ñ—ó

## **–í–∏—Å–Ω–æ–≤–∫–∏**

## –ö–ª—é—á–æ–≤—ñ –≤–∏—Å–Ω–æ–≤–∫–∏

### 1Ô∏è‚É£ **ACID ‚Äî —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç –Ω–∞–¥—ñ–π–Ω–æ—Å—Ç—ñ**

- **Atomicity:** –≤—Å–µ –∞–±–æ –Ω—ñ—á–æ–≥–æ
- **Consistency:** –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ
- **Isolation:** –Ω–µ–∑–∞–ª–µ–∂–Ω—ñ—Å—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π
- **Durability:** –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ø—ñ—Å–ª—è COMMIT

### 2Ô∏è‚É£ **–†—ñ–≤–Ω—ñ —ñ–∑–æ–ª—è—Ü—ñ—ó ‚Äî –∫–æ–º–ø—Ä–æ–º—ñ—Å**

```
READ UNCOMMITTED ‚Üí READ COMMITTED ‚Üí REPEATABLE READ ‚Üí SERIALIZABLE
     –®–≤–∏–¥–∫—ñ—Å—Ç—å ‚Üê                                    ‚Üí –ö–æ—Ä–µ–∫—Ç–Ω—ñ—Å—Ç—å
```

–í–∏–±–∏—Ä–∞–π—Ç–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ –≤–∏–º–æ–≥ –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É!

## –ö–ª—é—á–æ–≤—ñ –≤–∏—Å–Ω–æ–≤–∫–∏ (–ø—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è)

### 3Ô∏è‚É£ **–ü—Ä–æ—Ç–æ–∫–æ–ª–∏ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –ø–∞—Ä–∞–ª–µ–ª—å–Ω—ñ—Å—Ç—é**

**–ë–ª–æ–∫—É–≤–∞–Ω–Ω—è (2PL):**
- –¢—Ä–∞–¥–∏—Ü—ñ–π–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥
- –Ø–≤–Ω–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø—É
- –†–∏–∑–∏–∫ deadlock

**–ü–æ–∑–Ω–∞—á–∫–∏ —á–∞—Å—É:**
- –ë–µ–∑ –±–ª–æ–∫—É–≤–∞–Ω—å
- –î–µ—Ç–µ—Ä–º—ñ–Ω—ñ—Å—Ç–∏—á–Ω–µ —É–ø–æ—Ä—è–¥–∫—É–≤–∞–Ω–Ω—è
- –ë—ñ–ª—å—à–µ –≤—ñ–¥–∫–∞—Ç—ñ–≤

**–û–ø—Ç–∏–º—ñ—Å—Ç–∏—á–Ω–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è:**
- –ï—Ñ–µ–∫—Ç–∏–≤–Ω–∞ –ø—Ä–∏ –Ω–∏–∑—å–∫—ñ–π –∫–æ–Ω—Ñ–ª—ñ–∫—Ç–Ω–æ—Å—Ç—ñ
- –ú—ñ–Ω—ñ–º—É–º –±–ª–æ–∫—É–≤–∞–Ω—å
- –í–∞–ª—ñ–¥–∞—Ü—ñ—è –ø–µ—Ä–µ–¥ COMMIT

## –ö–ª—é—á–æ–≤—ñ –≤–∏—Å–Ω–æ–≤–∫–∏ (—Ñ—ñ–Ω–∞–ª)

### 4Ô∏è‚É£ **–í–∑–∞—î–º–æ–±–ª–æ–∫—É–≤–∞–Ω–Ω—è**

- **–ó–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è:** —É–ø–æ—Ä—è–¥–∫—É–≤–∞–Ω–Ω—è —Ä–µ—Å—É—Ä—Å—ñ–≤, —Ç–∞–π–º-–∞—É—Ç–∏
- **–í–∏—è–≤–ª–µ–Ω–Ω—è:** –≥—Ä–∞—Ñ –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è
- **–í–∏—Ä—ñ—à–µ–Ω–Ω—è:** –≤–∏–±—ñ—Ä –∂–µ—Ä—Ç–≤–∏ –¥–ª—è –≤—ñ–¥–∫–∞—Ç—É

### 5Ô∏è‚É£ **MVCC ‚Äî –≤–∏—Å–æ–∫—É –ø–∞—Ä–∞–ª–µ–ª—å–Ω—ñ—Å—Ç—å**

**–ü–µ—Ä–µ–≤–∞–≥–∏:**
- –ß–∏—Ç–∞–Ω–Ω—è –Ω–µ –±–ª–æ–∫—É—î –∑–∞–ø–∏—Å
- –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ñ —Å–Ω–∞–ø—à–æ—Ç–∏

**–ù–µ–¥–æ–ª—ñ–∫–∏:**
- –†–æ–∑–¥—É–≤–∞–Ω–Ω—è –ë–î
- –ü–æ—Ç—Ä–µ–±–∞ –≤ VACUUM

**–ö–ª—é—á:** —Ä–µ–≥—É–ª—è—Ä–Ω–µ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è!

## –ü—Ä–∞–∫—Ç–∏—á–Ω—ñ –ø–æ—Ä–∞–¥–∏

### üí° **–©–æ —Ä–æ–±–∏—Ç–∏ –∑–∞–≤–∂–¥–∏**

‚úÖ –¢—Ä–∏–º–∞—Ç–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó –∫–æ—Ä–æ—Ç–∫–∏–º–∏
‚úÖ –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–∏–π –ø–æ—Ä—è–¥–æ–∫ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è
‚úÖ –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥
‚úÖ –†–µ–≥—É–ª—è—Ä–Ω–æ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ VACUUM
‚úÖ –í–∏–±–∏—Ä–∞—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —Ä—ñ–≤–µ–Ω—å —ñ–∑–æ–ª—è—Ü—ñ—ó
‚úÖ –û–±—Ä–æ–±–ª—è—Ç–∏ –ø–æ–º–∏–ª–∫–∏ deadlock

### üí° **–ß–æ–≥–æ —É–Ω–∏–∫–∞—Ç–∏**

‚ùå –î–æ–≤–≥–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π (–≥–æ–¥–∏–Ω–∏)
‚ùå –•–∞–æ—Ç–∏—á–Ω–æ–≥–æ –ø–æ—Ä—è–¥–∫—É –±–ª–æ–∫—É–≤–∞–Ω—å
‚ùå –Ü–≥–Ω–æ—Ä—É–≤–∞–Ω–Ω—è —Ä–æ–∑–¥—É–≤–∞–Ω–Ω—è –ë–î
‚ùå SERIALIZABLE —Ç–∞–º, –¥–µ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ
‚ùå –í—ñ–¥—Å—É—Ç–Ω–æ—Å—Ç—ñ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É
