# –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞ —Ä–æ–±–æ—Ç–∞ 3. –ú–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö —Ç–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó

## üéØ –ú–µ—Ç–∞ —Ä–æ–±–æ—Ç–∏

–ó–¥–æ–±—É—Ç–∏ –ø—Ä–∞–∫—Ç–∏—á–Ω—ñ –Ω–∞–≤–∏—á–∫–∏ –±–µ–∑–ø–µ—á–Ω–æ—ó –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –¥–∞–Ω–∏—Ö —É —Ä–µ–ª—è—Ü—ñ–π–Ω–∏—Ö –±–∞–∑–∞—Ö –¥–∞–Ω–∏—Ö, –æ–ø–∞–Ω—É–≤–∞—Ç–∏ –º–µ—Ö–∞–Ω—ñ–∑–º–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π –¥–ª—è –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ –¥–∞–Ω–∏—Ö, –Ω–∞–≤—á–∏—Ç–∏—Å—è –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑ –æ–±–º–µ–∂–µ–Ω–Ω—è–º–∏ —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ —Ç–∞ –∫–∞—Å–∫–∞–¥–Ω–∏–º–∏ –æ–ø–µ—Ä–∞—Ü—ñ—è–º–∏ –ø—Ä–∏ –∑–º—ñ–Ω—ñ –≤–∑–∞—î–º–æ–ø–æ–≤'—è–∑–∞–Ω–∏—Ö –∑–∞–ø–∏—Å—ñ–≤.

## ‚úÖ –ó–∞–≤–¥–∞–Ω–Ω—è

### –†—ñ–≤–µ–Ω—å 1

–°—Ç–≤–æ—Ä–∏—Ç–∏ –±–∞–∑—É –¥–∞–Ω–∏—Ö –¥–ª—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –±—ñ–±–ª—ñ–æ—Ç–µ–∫–æ—é –∑ –Ω–∞—Å—Ç—É–ø–Ω–∏–º–∏ —Ç–∞–±–ª–∏—Ü—è–º–∏: –∞–≤—Ç–æ—Ä–∏, –∫–Ω–∏–≥–∏, —á–∏—Ç–∞—á—ñ, –≤–∏–¥–∞—á—ñ –∫–Ω–∏–≥. –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –±–∞–∑–æ–≤—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –¥–∞–Ω–∏—Ö.

**–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è:**

1. –°—Ç–≤–æ—Ä–∏—Ç–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –±–∞–∑–∏ –¥–∞–Ω–∏—Ö –∑ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–º–∏ –æ–±–º–µ–∂–µ–Ω–Ω—è–º–∏ —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ.
2. –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –æ–ø–µ—Ä–∞—Ü—ñ—ó –¥–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–∏—Ö –∑–∞–ø–∏—Å—ñ–≤ –∑ –ø–µ—Ä–µ–≤—ñ—Ä–∫–æ—é –æ–±–º–µ–∂–µ–Ω—å.
3. –í–∏–∫–æ–Ω–∞—Ç–∏ –±–µ–∑–ø–µ—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ø–∏—Å—ñ–≤ –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º —É–º–æ–≤ WHERE.
4. –ó–¥—ñ–π—Å–Ω–∏—Ç–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∑–∞–ø–∏—Å—ñ–≤ –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º –∑–æ–≤–Ω—ñ—à–Ω—ñ—Ö –∫–ª—é—á—ñ–≤.
5. –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –ø—Ä–æ—Å—Ç—ñ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó –¥–ª—è –≥—Ä—É–ø—É–≤–∞–Ω–Ω—è –æ–ø–µ—Ä–∞—Ü—ñ–π.
6. –ü—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä—É–≤–∞—Ç–∏ —Ä–æ–±–æ—Ç—É –º–µ—Ö–∞–Ω—ñ–∑–º—É ROLLBACK –ø—Ä–∏ –ø–æ–º–∏–ª–∫–∞—Ö.

### –†—ñ–≤–µ–Ω—å 2

–í–∏–∫–æ–Ω–∞—Ç–∏ –∑–∞–≤–¥–∞–Ω–Ω—è —Ä—ñ–≤–Ω—è 1. –†–æ–∑—à–∏—Ä–∏—Ç–∏ –±–∞–∑—É –¥–∞–Ω–∏—Ö –¥–æ–¥–∞—Ç–∫–æ–≤–∏–º–∏ —Å—É—Ç–Ω–æ—Å—Ç—è–º–∏ —Ç–∞ —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —Å–∫–ª–∞–¥–Ω—ñ—à—ñ —Å—Ü–µ–Ω–∞—Ä—ñ—ó –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π.

**–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è:**

1. –î–æ–¥–∞—Ç–∏ —Ç–∞–±–ª–∏—Ü—ñ –¥–ª—è –æ–±–ª—ñ–∫—É –±—Ä–æ–Ω—é–≤–∞–Ω—å –∫–Ω–∏–≥ —Ç–∞ —ñ—Å—Ç–æ—Ä—ñ—ó –∑–º—ñ–Ω.
2. –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —Å–∫–ª–∞–¥–Ω—ñ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó –∑ –º–Ω–æ–∂–∏–Ω–Ω–∏–º–∏ –æ–ø–µ—Ä–∞—Ü—ñ—è–º–∏ –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—ó.
3. –í–ø—Ä–æ–≤–∞–¥–∏—Ç–∏ –∫–∞—Å–∫–∞–¥–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö –∑–∞–ø–∏—Å—ñ–≤.
4. –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ —Ç–æ—á–∫–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è SAVEPOINT –¥–ª—è —á–∞—Å—Ç–∫–æ–≤–æ–≥–æ –≤—ñ–¥–∫–∞—Ç—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π.
5. –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ç—Ä–∏–≥–µ—Ä–∏ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –≤–µ–¥–µ–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó –∑–º—ñ–Ω.
6. –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –º–µ—Ö–∞–Ω—ñ–∑–º–∏ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è –∑–∞–ø–∏—Å—ñ–≤ –¥–ª—è –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø—É.

### –†—ñ–≤–µ–Ω—å 3

–í–∏–∫–æ–Ω–∞—Ç–∏ –∑–∞–≤–¥–∞–Ω–Ω—è —Ä—ñ–≤–Ω—è 2. –†–æ–∑—Ä–æ–±–∏—Ç–∏ –ø–æ–≤–Ω–æ—Ü—ñ–Ω–Ω—É —Å–∏—Å—Ç–µ–º—É —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –¥–∞–Ω–∏–º–∏ –∑ —Ä–æ–∑—à–∏—Ä–µ–Ω–∏–º–∏ –º–æ–∂–ª–∏–≤–æ—Å—Ç—è–º–∏ –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—ó —Ç–∞ –∞—É–¥–∏—Ç—É –∑–º—ñ–Ω.

**–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è:**

1. –í–ø—Ä–æ–≤–∞–¥–∏—Ç–∏ —Å–∏—Å—Ç–µ–º—É –≤–µ—Ä—Å—ñ–æ–Ω—É–≤–∞–Ω–Ω—è –∑–∞–ø–∏—Å—ñ–≤ –∑ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—é –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –≤—Å—ñ—Ö –∑–º—ñ–Ω.
2. –°—Ç–≤–æ—Ä–∏—Ç–∏ –º–µ—Ö–∞–Ω—ñ–∑–º –≤—ñ–¥–∫–ª–∞–¥–µ–Ω–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π –∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–º –≤–∏–∫–æ–Ω–∞–Ω–Ω—è–º.
3. –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —Å–∫–ª–∞–¥–Ω—É –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫—É —á–µ—Ä–µ–∑ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –ø—Ä–æ—Ü–µ–¥—É—Ä–∏.
4. –í–ø—Ä–æ–≤–∞–¥–∏—Ç–∏ —Å–∏—Å—Ç–µ–º—É –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø—É –Ω–∞ —Ä—ñ–≤–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ–π –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—ó.
5. –†–æ–∑—Ä–æ–±–∏—Ç–∏ –º–µ—Ö–∞–Ω—ñ–∑–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –ø—ñ—Å–ª—è –∑–±–æ—ó–≤.
6. –°—Ç–≤–æ—Ä–∏—Ç–∏ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É —Ç–∞ –≤—ñ–¥–∫–∞—Ç—É –∑–º—ñ–Ω –∑–∞ –ø–µ–≤–Ω–∏–π –ø–µ—Ä—ñ–æ–¥.


## üñ•Ô∏è –ü—Ä–æ–≥—Ä–∞–º–Ω–µ –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è

- [PostgreSQL](https://www.postgresql.org)

!!! tip "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó"

    –î–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ—ó —Ä–æ–±–æ—Ç–∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –ë–î –≤ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ

    - [Docker Desktop](https://www.docker.com/products/docker-desktop)
    - [postgres official images](https://hub.docker.com/_/postgres)

## üë• –§–æ—Ä–º–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ä–æ–±–æ—Ç–∏

–§–æ—Ä–º–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ä–æ–±–æ—Ç–∏ **—ñ–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω–∞**.

## üìù –ö—Ä–∏—Ç–µ—Ä—ñ—ó –æ—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è

- —Å–µ—Ä–µ–¥–Ω—ñ–π —Ä—ñ–≤–µ–Ω—å (–æ—Ü—ñ–Ω–∫–∞ "–∑–∞–¥–æ–≤—ñ–ª—å–Ω–æ") - –≤–∏–∫–æ–Ω–∞–Ω–æ –∑–∞–≤–¥–∞–Ω–Ω—è —Ä—ñ–≤–Ω—è 1.
    - –°—Ç–≤–æ—Ä–µ–Ω–æ –∫–æ—Ä–µ–∫—Ç–Ω—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É –±–∞–∑–∏ –¥–∞–Ω–∏—Ö –∑ —É—Å—ñ–º–∞ –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏–º–∏ –æ–±–º–µ–∂–µ–Ω–Ω—è–º–∏ —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ.
    - –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ –±–∞–∑–æ–≤—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó INSERT –¥–ª—è –≤—Å—ñ—Ö —Ç–∞–±–ª–∏—Ü—å –∑ –∫–æ—Ä–µ–∫—Ç–Ω–∏–º–∏ –¥–∞–Ω–∏–º–∏.
    - –í–∏–∫–æ–Ω–∞–Ω–æ –±–µ–∑–ø–µ—á–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó UPDATE –∑ –æ–±–æ–≤'—è–∑–∫–æ–≤–æ—é —É–º–æ–≤–æ—é WHERE.
    - –ó–¥—ñ–π—Å–Ω–µ–Ω–æ –æ–ø–µ—Ä–∞—Ü—ñ—ó DELETE –∑ –ø–µ—Ä–µ–≤—ñ—Ä–∫–æ—é –≤–ø–ª–∏–≤—É –Ω–∞ –ø–æ–≤'—è–∑–∞–Ω—ñ –∑–∞–ø–∏—Å–∏.
    - –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ –ø—Ä–æ—Å—Ç—ñ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó –¥–ª—è –≥—Ä—É–ø—É–≤–∞–Ω–Ω—è –æ–ø–µ—Ä–∞—Ü—ñ–π –∑ COMMIT.
    - –ü—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–æ–≤–∞–Ω–æ —Ä–æ–±–æ—Ç—É ROLLBACK –ø—Ä–∏ –≤–∏–Ω–∏–∫–Ω–µ–Ω–Ω—ñ –ø–æ–º–∏–ª–æ–∫.
    - –ü—ñ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ –∑–≤—ñ—Ç –∑ –æ–ø–∏—Å–æ–º –≤–∏–∫–æ–Ω–∞–Ω–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π —Ç–∞ —Å–∫—Ä—ñ–Ω—à–æ—Ç–∞–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤.
- –¥–æ—Å—Ç–∞—Ç–Ω—ñ–π —Ä—ñ–≤–µ–Ω—å (–æ—Ü—ñ–Ω–∫–∞ "–¥–æ–±—Ä–µ") - –≤–∏–∫–æ–Ω–∞–Ω–æ –≤—Å—ñ –≤–∏–º–æ–≥–∏ —Ä—ñ–≤–Ω—è 2.
    - –°—Ç–≤–æ—Ä–µ–Ω–æ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ —Ç–∞–±–ª–∏—Ü—ñ –∑ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–º–∏ –∑–≤'—è–∑–∫–∞–º–∏ —Ç–∞ –æ–±–º–µ–∂–µ–Ω–Ω—è–º–∏.
    - –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ —Å–∫–ª–∞–¥–Ω—ñ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó –∑ –º–Ω–æ–∂–∏–Ω–Ω–∏–º–∏ –æ–ø–µ—Ä–∞—Ü—ñ—è–º–∏ —Ä—ñ–∑–Ω–∏—Ö —Ç–∏–ø—ñ–≤.
    - –í–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–æ –∫–∞—Å–∫–∞–¥–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –¥–ª—è –≤—Å—ñ—Ö —Ç–∏–ø—ñ–≤ –∑–≤'—è–∑–∫—ñ–≤.
    - –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ —Ç–æ—á–∫–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è SAVEPOINT –¥–ª—è –≥–Ω—É—á–∫–æ–≥–æ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è–º–∏.
    - –°—Ç–≤–æ—Ä–µ–Ω–æ —Ç—Ä–∏–≥–µ—Ä–∏ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –≤–µ–¥–µ–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó –∑–º—ñ–Ω.
    - –ü—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–æ–≤–∞–Ω–æ –º–µ—Ö–∞–Ω—ñ–∑–º–∏ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è –ø—Ä–∏ –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ–º—É –¥–æ—Å—Ç—É–ø—ñ.
    - –ü—ñ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ —Ä–æ–∑—à–∏—Ä–µ–Ω–∏–π –∑–≤—ñ—Ç –∑ –∞–Ω–∞–ª—ñ–∑–æ–º —Ä–æ–±–æ—Ç–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π —Ç–∞ –æ–±–º–µ–∂–µ–Ω—å.
- –≤–∏—Å–æ–∫–∏–π —Ä—ñ–≤–µ–Ω—å (–æ—Ü—ñ–Ω–∫–∞ "–≤—ñ–¥–º—ñ–Ω–Ω–æ") - –≤–∏–∫–æ–Ω–∞–Ω–æ –∑–∞–≤–¥–∞–Ω–Ω—è —Ä—ñ–≤–Ω—è 3.
    - –í–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–æ —Å–∏—Å—Ç–µ–º—É –≤–µ—Ä—Å—ñ–æ–Ω—É–≤–∞–Ω–Ω—è –∑ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—é –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —ñ—Å—Ç–æ—Ä–∏—á–Ω–∏—Ö —Å—Ç–∞–Ω—ñ–≤.
    - –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ –º–µ—Ö–∞–Ω—ñ–∑–º –≤—ñ–¥–∫–ª–∞–¥–µ–Ω–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π –∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–º –≤–∏–∫–æ–Ω–∞–Ω–Ω—è–º.
    - –°—Ç–≤–æ—Ä–µ–Ω–æ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –ø—Ä–æ—Ü–µ–¥—É—Ä–∏ –¥–ª—è —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó —Å–∫–ª–∞–¥–Ω–æ—ó –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∏.
    - –í–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–æ —Å–∏—Å—Ç–µ–º—É —Ä–æ–ª–µ–π –∑ —Ä—ñ–∑–Ω–∏–º–∏ –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø—É.
    - –†–æ–∑—Ä–æ–±–ª–µ–Ω–æ –º–µ—Ö–∞–Ω—ñ–∑–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–∏—Ö —Ç–æ—á–æ–∫.
    - –°—Ç–≤–æ—Ä–µ–Ω–æ –∑—Ä—É—á–Ω–∏–π —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É —ñ—Å—Ç–æ—Ä—ñ—ó –∑–º—ñ–Ω —á–µ—Ä–µ–∑ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è.

## ‚è∞ –ü–æ–ª—ñ—Ç–∏–∫–∞ —â–æ–¥–æ –¥–µ–¥–ª–∞–π–Ω—ñ–≤

–ü—Ä–∏ –ø–æ—Ä—É—à–µ–Ω–Ω—ñ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ–≥–æ —Ç–µ—Ä–º—ñ–Ω—É –∑–¥–∞—á—ñ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ—ó —Ä–æ–±–æ—Ç–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –º–æ–∂–ª–∏–≤–∞ –æ—Ü—ñ–Ω–∫–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—å "–¥–æ–±—Ä–µ", –Ω–µ–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —è–∫–æ—Å—Ç—ñ –≤–∏–∫–æ–Ω–∞–Ω–æ—ó —Ä–æ–±–æ—Ç–∏. –í–∏–Ω—è—Ç–∫–∏ –º–æ–∂–ª–∏–≤—ñ –ª–∏—à–µ –∑–∞ –ø–æ–≤–∞–∂–Ω–∏—Ö –ø—Ä–∏—á–∏–Ω, –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–∞–ª—å–Ω–æ.

## üìö –¢–µ–æ—Ä–µ—Ç–∏—á–Ω—ñ –≤—ñ–¥–æ–º–æ—Å—Ç—ñ

### –û–ø–µ—Ä–∞—Ü—ñ—ó –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –¥–∞–Ω–∏—Ö

–ú–æ–≤–∞ SQL –Ω–∞–¥–∞—î —Ç—Ä–∏ –æ—Å–Ω–æ–≤–Ω—ñ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∏ –¥–ª—è –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –¥–∞–Ω–∏—Ö —É —Ç–∞–±–ª–∏—Ü—è—Ö: INSERT –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–∏—Ö –∑–∞–ø–∏—Å—ñ–≤, UPDATE –¥–ª—è –∑–º—ñ–Ω–∏ —ñ—Å–Ω—É—é—á–∏—Ö –∑–∞–ø–∏—Å—ñ–≤ —Ç–∞ DELETE –¥–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∑–∞–ø–∏—Å—ñ–≤.

#### –û–ø–µ—Ä–∞—Ç–æ—Ä INSERT

–û–ø–µ—Ä–∞—Ç–æ—Ä INSERT –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–∏—Ö —Ä—è–¥–∫—ñ–≤ –¥–æ —Ç–∞–±–ª–∏—Ü—ñ. –Ü—Å–Ω—É—î –∫—ñ–ª—å–∫–∞ –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤ –π–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è.

**–í—Å—Ç–∞–≤–∫–∞ –æ–¥–Ω–æ–≥–æ –∑–∞–ø–∏—Å—É –∑ —è–≤–Ω–∏–º –ø–µ—Ä–µ–ª—ñ–∫–æ–º —Å—Ç–æ–≤–ø—Ü—ñ–≤:**

```sql
INSERT INTO books (isbn, title, author_id, publication_year, genre)
VALUES ('978-0-123456-78-9', '–û—Å–Ω–æ–≤–∏ –±–∞–∑ –¥–∞–Ω–∏—Ö', 1, 2023, '–¢–µ—Ö–Ω—ñ—á–Ω–∞ –ª—ñ—Ç–µ—Ä–∞—Ç—É—Ä–∞');
```

**–í—Å—Ç–∞–≤–∫–∞ –±–µ–∑ –ø–µ—Ä–µ–ª—ñ–∫—É —Å—Ç–æ–≤–ø—Ü—ñ–≤:**

```sql
INSERT INTO books
VALUES (1, '978-0-123456-78-9', '–û—Å–Ω–æ–≤–∏ –±–∞–∑ –¥–∞–Ω–∏—Ö', 1, 2023, '–¢–µ—Ö–Ω—ñ—á–Ω–∞ –ª—ñ—Ç–µ—Ä–∞—Ç—É—Ä–∞', 5);
```

–£ —Ü—å–æ–º—É –≤–∏–ø–∞–¥–∫—É –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ –≤–∫–∞–∑–∞—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è –¥–ª—è –≤—Å—ñ—Ö —Å—Ç–æ–≤–ø—Ü—ñ–≤ —É –ø–æ—Ä—è–¥–∫—É —ó—Ö –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –≤ —Ç–∞–±–ª–∏—Ü—ñ.

**–í—Å—Ç–∞–≤–∫–∞ –º–Ω–æ–∂–∏–Ω–Ω–∏—Ö –∑–∞–ø–∏—Å—ñ–≤:**

```sql
INSERT INTO authors (first_name, last_name, birth_year, country)
VALUES
    ('–Ü–≤–∞–Ω', '–ü–µ—Ç—Ä–µ–Ω–∫–æ', 1975, '–£–∫—Ä–∞—ó–Ω–∞'),
    ('–ú–∞—Ä—ñ—è', '–ö–æ–≤–∞–ª–µ–Ω–∫–æ', 1982, '–£–∫—Ä–∞—ó–Ω–∞'),
    ('–û–ª–µ–∫—Å–∞–Ω–¥—Ä', '–°–∏–¥–æ—Ä–æ–≤', 1968, '–£–∫—Ä–∞—ó–Ω–∞');
```

**–í—Å—Ç–∞–≤–∫–∞ –¥–∞–Ω–∏—Ö –∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ –∑–∞–ø–∏—Ç—É:**

```sql
INSERT INTO archive_books (isbn, title, archive_date)
SELECT isbn, title, CURRENT_DATE
FROM books
WHERE publication_year < 2000;
```

#### –û–ø–µ—Ä–∞—Ç–æ—Ä UPDATE

–û–ø–µ—Ä–∞—Ç–æ—Ä UPDATE –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –∑–º—ñ–Ω–∏ –∑–Ω–∞—á–µ–Ω—å —É —ñ—Å–Ω—É—é—á–∏—Ö –∑–∞–ø–∏—Å–∞—Ö. –û–±–æ–≤'—è–∑–∫–æ–≤–æ—é —á–∞—Å—Ç–∏–Ω–æ—é –±–µ–∑–ø–µ—á–Ω–æ–≥–æ UPDATE —î —É–º–æ–≤–∞ WHERE.

**–û–Ω–æ–≤–ª–µ–Ω–Ω—è –æ–¥–Ω–æ–≥–æ –ø–æ–ª—è:**

```sql
UPDATE books
SET available_copies = available_copies - 1
WHERE isbn = '978-0-123456-78-9';
```

**–û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—ñ–ª—å–∫–æ—Ö –ø–æ–ª—ñ–≤ –æ–¥–Ω–æ—á–∞—Å–Ω–æ:**

```sql
UPDATE readers
SET email = 'new.email@example.com',
    phone = '+380501234567',
    updated_at = CURRENT_TIMESTAMP
WHERE reader_id = 15;
```

**–û–Ω–æ–≤–ª–µ–Ω–Ω—è –Ω–∞ –æ—Å–Ω–æ–≤—ñ –ø—ñ–¥–∑–∞–ø–∏—Ç—É:**

```sql
UPDATE books
SET genre = '–ö–ª–∞—Å–∏—á–Ω–∞ –ª—ñ—Ç–µ—Ä–∞—Ç—É—Ä–∞'
WHERE author_id IN (
    SELECT author_id
    FROM authors
    WHERE birth_year < 1900
);
```

**–û–Ω–æ–≤–ª–µ–Ω–Ω—è –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º JOIN:**

```sql
UPDATE books b
SET b.available_copies = b.available_copies + 1
FROM lendings l
WHERE b.book_id = l.book_id
    AND l.return_date = CURRENT_DATE;
```

#### –û–ø–µ—Ä–∞—Ç–æ—Ä DELETE

–û–ø–µ—Ä–∞—Ç–æ—Ä DELETE –≤–∏–¥–∞–ª—è—î –∑–∞–ø–∏—Å–∏ –∑ —Ç–∞–±–ª–∏—Ü—ñ. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —É–º–æ–≤–∏ WHERE —î –∫—Ä–∏—Ç–∏—á–Ω–æ –≤–∞–∂–ª–∏–≤–∏–º –¥–ª—è —É–Ω–∏–∫–Ω–µ–Ω–Ω—è –≤–∏–ø–∞–¥–∫–æ–≤–æ–≥–æ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –≤—Å—ñ—Ö –¥–∞–Ω–∏—Ö.

**–í–∏–¥–∞–ª–µ–Ω–Ω—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏—Ö –∑–∞–ø–∏—Å—ñ–≤:**

```sql
DELETE FROM lendings
WHERE return_date < CURRENT_DATE - INTERVAL '1 year';
```

**–í–∏–¥–∞–ª–µ–Ω–Ω—è –∑ –ø—ñ–¥–∑–∞–ø–∏—Ç–æ–º:**

```sql
DELETE FROM books
WHERE author_id IN (
    SELECT author_id
    FROM authors
    WHERE country = '–ù–µ–≤—ñ–¥–æ–º–∞'
);
```

**–í–∏–¥–∞–ª–µ–Ω–Ω—è –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º JOIN:**

```sql
DELETE l
FROM lendings l
INNER JOIN readers r ON l.reader_id = r.reader_id
WHERE r.status = 'Blocked';
```

### –ë–µ–∑–ø–µ—á–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—ó

–ë–µ–∑–ø–µ—á–Ω–∞ –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö –ø–µ—Ä–µ–¥–±–∞—á–∞—î –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –∫—ñ–ª—å–∫–æ—Ö –≤–∞–∂–ª–∏–≤–∏—Ö –ø—Ä–∞–∫—Ç–∏–∫.

#### –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —É–º–æ–≤–∏ WHERE

–ù–∞–π–≤–∞–∂–ª–∏–≤—ñ—à–æ—é –ø—Ä–∞–∫—Ç–∏–∫–æ—é —î –∑–∞–≤–∂–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —É–º–æ–≤—É WHERE –≤ –æ–ø–µ—Ä–∞—Ü—ñ—è—Ö UPDATE —Ç–∞ DELETE, —è–∫—â–æ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ –º–æ–¥–∏—Ñ—ñ–∫—É–≤–∞—Ç–∏ –≤—Å—ñ –∑–∞–ø–∏—Å–∏ –≤ —Ç–∞–±–ª–∏—Ü—ñ.

**–ù–µ–±–µ–∑–ø–µ—á–Ω–∞ –æ–ø–µ—Ä–∞—Ü—ñ—è –±–µ–∑ WHERE:**

```sql
-- –£–í–ê–ì–ê: –≤–∏–¥–∞–ª–∏—Ç—å –≤—Å—ñ –∫–Ω–∏–≥–∏ –∑ —Ç–∞–±–ª–∏—Ü—ñ
DELETE FROM books;
```

**–ë–µ–∑–ø–µ—á–Ω–∞ –æ–ø–µ—Ä–∞—Ü—ñ—è –∑ WHERE:**

```sql
-- –í–∏–¥–∞–ª–∏—Ç—å —Ç—ñ–ª—å–∫–∏ –∫–Ω–∏–≥–∏ –ø–µ–≤–Ω–æ–≥–æ –∞–≤—Ç–æ—Ä–∞
DELETE FROM books
WHERE author_id = 5;
```

#### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—î—é

–ü–µ—Ä–µ–¥ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è–º –æ–ø–µ—Ä–∞—Ü—ñ—ó –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –∫–æ—Ä–∏—Å–Ω–æ –≤–∏–∫–æ–Ω–∞—Ç–∏ SELECT –∑ —Ç—ñ—î—é –∂ —É–º–æ–≤–æ—é WHERE –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏, —è–∫—ñ –∑–∞–ø–∏—Å–∏ –±—É–¥—É—Ç—å –∑–º—ñ–Ω–µ–Ω—ñ.

```sql
-- –°–ø–æ—á–∞—Ç–∫—É –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —è–∫—ñ –∑–∞–ø–∏—Å–∏ –±—É–¥—É—Ç—å –æ–Ω–æ–≤–ª–µ–Ω—ñ
SELECT book_id, title, available_copies
FROM books
WHERE genre = '–•—É–¥–æ–∂–Ω—è –ª—ñ—Ç–µ—Ä–∞—Ç—É—Ä–∞';

-- –ü—ñ—Å–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –≤–∏–∫–æ–Ω—É—î–º–æ UPDATE
UPDATE books
SET available_copies = available_copies + 5
WHERE genre = '–•—É–¥–æ–∂–Ω—è –ª—ñ—Ç–µ—Ä–∞—Ç—É—Ä–∞';
```

#### –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è RETURNING

–í PostgreSQL –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—é RETURNING –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö –º–æ–¥–∏—Ñ—ñ–∫–æ–≤–∞–Ω–∏—Ö –∑–∞–ø–∏—Å—ñ–≤.

```sql
UPDATE books
SET available_copies = available_copies - 1
WHERE isbn = '978-0-123456-78-9'
RETURNING book_id, title, available_copies;
```

### –¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó

–¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è —î –ª–æ–≥—ñ—á–Ω–æ—é –æ–¥–∏–Ω–∏—Ü–µ—é —Ä–æ–±–æ—Ç–∏, —è–∫–∞ –º—ñ—Å—Ç–∏—Ç—å –æ–¥–Ω—É –∞–±–æ –±—ñ–ª—å—à–µ –æ–ø–µ—Ä–∞—Ü—ñ–π –∑ –±–∞–∑–æ—é –¥–∞–Ω–∏—Ö. –¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó –∑–∞–±–µ–∑–ø–µ—á—É—é—Ç—å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç–µ–π ACID.

#### –í–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ ACID

**–ê—Ç–æ–º–∞—Ä–Ω—ñ—Å—Ç—å (Atomicity)** –æ–∑–Ω–∞—á–∞—î, —â–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –ø–æ–≤–Ω—ñ—Å—Ç—é –∞–±–æ –Ω–µ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –≤–∑–∞–≥–∞–ª—ñ. –Ø–∫—â–æ –æ–¥–Ω–∞ –∑ –æ–ø–µ—Ä–∞—Ü—ñ–π –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó –Ω–µ –≤–¥–∞—î—Ç—å—Å—è, –≤—Å—ñ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó —Å–∫–∞—Å–æ–≤—É—é—Ç—å—Å—è.

**–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ñ—Å—Ç—å (Consistency)** –≥–∞—Ä–∞–Ω—Ç—É—î, —â–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–∏—Ö –∑ –æ–¥–Ω–æ–≥–æ —É–∑–≥–æ–¥–∂–µ–Ω–æ–≥–æ —Å—Ç–∞–Ω—É –≤ —ñ–Ω—à–∏–π, –∑–±–µ—Ä—ñ–≥–∞—é—á–∏ –≤—Å—ñ –æ–±–º–µ–∂–µ–Ω–Ω—è —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ.

**–Ü–∑–æ–ª—å–æ–≤–∞–Ω—ñ—Å—Ç—å (Isolation)** –∑–∞–±–µ–∑–ø–µ—á—É—î, —â–æ –æ–¥–Ω–æ—á–∞—Å–Ω—ñ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó –Ω–µ –≤–ø–ª–∏–≤–∞—é—Ç—å –æ–¥–Ω–∞ –Ω–∞ –æ–¥–Ω—É. –†–µ–∑—É–ª—å—Ç–∞—Ç –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –ø–∞—Ä–∞–ª–µ–ª—å–Ω–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π –µ–∫–≤—ñ–≤–∞–ª–µ–Ω—Ç–Ω–∏–π —ó—Ö –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ–º—É –≤–∏–∫–æ–Ω–∞–Ω–Ω—é.

**–î–æ–≤–≥–æ–≤—ñ—á–Ω—ñ—Å—Ç—å (Durability)** –≥–∞—Ä–∞–Ω—Ç—É—î, —â–æ –ø—ñ—Å–ª—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó —ó—ó —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –Ω–∞–≤—ñ—Ç—å —É –≤–∏–ø–∞–¥–∫—É –∑–±–æ—é —Å–∏—Å—Ç–µ–º–∏.

#### –û—Å–Ω–æ–≤–Ω—ñ –∫–æ–º–∞–Ω–¥–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π

**BEGIN –∞–±–æ START TRANSACTION** —Ä–æ–∑–ø–æ—á–∏–Ω–∞—î –Ω–æ–≤—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—é.

```sql
BEGIN;
-- –∞–±–æ
START TRANSACTION;
```

**COMMIT** –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂—É—î –≤—Å—ñ –∑–º—ñ–Ω–∏, –≤–∏–∫–æ–Ω–∞–Ω—ñ –≤ –ø–æ—Ç–æ—á–Ω—ñ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó.

```sql
BEGIN;
INSERT INTO authors (first_name, last_name) VALUES ('–¢–∞—Ä–∞—Å', '–®–µ–≤—á–µ–Ω–∫–æ');
INSERT INTO books (title, author_id) VALUES ('–ö–æ–±–∑–∞—Ä', LASTVAL());
COMMIT;
```

**ROLLBACK** —Å–∫–∞—Å–æ–≤—É—î –≤—Å—ñ –∑–º—ñ–Ω–∏, –≤–∏–∫–æ–Ω–∞–Ω—ñ –≤ –ø–æ—Ç–æ—á–Ω—ñ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó.

```sql
BEGIN;
DELETE FROM books WHERE publication_year < 1950;
-- –ü–æ–º–∏–ª–∫–∞ –∞–±–æ –∑–º—ñ–Ω–∞ —Ä—ñ—à–µ–Ω–Ω—è
ROLLBACK;
```

#### –¢–æ—á–∫–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è SAVEPOINT

–¢–æ—á–∫–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –¥–æ–∑–≤–æ–ª—è—é—Ç—å —á–∞—Å—Ç–∫–æ–≤–æ –≤—ñ–¥–∫–æ—Ç–∏—Ç–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—é –¥–æ –ø–µ–≤–Ω–æ—ó —Ç–æ—á–∫–∏ –±–µ–∑ —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è –≤—Å—ñ—î—ó —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó.

```sql
BEGIN;

INSERT INTO authors (first_name, last_name) VALUES ('–õ–µ—Å—è', '–£–∫—Ä–∞—ó–Ω–∫–∞');

SAVEPOINT after_author_insert;

INSERT INTO books (title, author_id) VALUES ('–õ—ñ—Å–æ–≤–∞ –ø—ñ—Å–Ω—è', LASTVAL());

-- –Ø–∫—â–æ –≤–∏–Ω–∏–∫–ª–∞ –ø–æ–º–∏–ª–∫–∞ –∑ –∫–Ω–∏–≥–æ—é, –º–æ–∂–Ω–∞ –≤—ñ–¥–∫–æ—Ç–∏—Ç–∏ —Ç—ñ–ª—å–∫–∏ –≤—Å—Ç–∞–≤–∫—É –∫–Ω–∏–≥–∏
ROLLBACK TO SAVEPOINT after_author_insert;

-- –ê–≤—Ç–æ—Ä –∑–∞–ª–∏—à–∏—Ç—å—Å—è –¥–æ–¥–∞–Ω–∏–º, –º–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏ —ñ–Ω—à—É –∫–Ω–∏–≥—É
INSERT INTO books (title, author_id) VALUES ('–ö–∞–º—ñ–Ω–Ω–∏–π –≥–æ—Å–ø–æ–¥–∞—Ä', LASTVAL());

COMMIT;
```

#### –†—ñ–≤–Ω—ñ —ñ–∑–æ–ª—è—Ü—ñ—ó —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π

SQL —Å—Ç–∞–Ω–¥–∞—Ä—Ç –≤–∏–∑–Ω–∞—á–∞—î —á–æ—Ç–∏—Ä–∏ —Ä—ñ–≤–Ω—ñ —ñ–∑–æ–ª—è—Ü—ñ—ó —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π, —è–∫—ñ –≤–∏–∑–Ω–∞—á–∞—é—Ç—å, —è–∫—ñ –∞–Ω–æ–º–∞–ª—ñ—ó –º–æ–∂—É—Ç—å –≤–∏–Ω–∏–∫–∞—Ç–∏ –ø—Ä–∏ –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ–º—É –≤–∏–∫–æ–Ω–∞–Ω–Ω—ñ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π.

**READ UNCOMMITTED** –¥–æ–∑–≤–æ–ª—è—î —á–∏—Ç–∞—Ç–∏ –Ω–µ–∑–∞—Ñ—ñ–∫—Å–æ–≤–∞–Ω—ñ –∑–º—ñ–Ω–∏ —ñ–Ω—à–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π. –ú–æ–∂–ª–∏–≤—ñ –≤—Å—ñ —Ç–∏–ø–∏ –∞–Ω–æ–º–∞–ª—ñ–π.

**READ COMMITTED** –¥–æ–∑–≤–æ–ª—è—î —á–∏—Ç–∞—Ç–∏ —Ç—ñ–ª—å–∫–∏ –∑–∞—Ñ—ñ–∫—Å–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ. –ó–∞–ø–æ–±—ñ–≥–∞—î –±—Ä—É–¥–Ω–æ–º—É —á–∏—Ç–∞–Ω–Ω—é, –∞–ª–µ –º–æ–∂–ª–∏–≤—ñ –Ω–µ–ø–æ–≤—Ç–æ—Ä—é–≤–∞–Ω—ñ —á–∏—Ç–∞–Ω–Ω—è —Ç–∞ —Ñ–∞–Ω—Ç–æ–º–Ω—ñ –∑–∞–ø–∏—Å–∏.

**REPEATABLE READ** –≥–∞—Ä–∞–Ω—Ç—É—î, —â–æ –ø–æ–≤—Ç–æ—Ä–Ω–µ —á–∏—Ç–∞–Ω–Ω—è –≤ –º–µ–∂–∞—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó –ø–æ–≤–µ—Ä–Ω–µ —Ç—ñ —Å–∞–º—ñ –¥–∞–Ω—ñ. –ó–∞–ø–æ–±—ñ–≥–∞—î –±—Ä—É–¥–Ω–æ–º—É —Ç–∞ –Ω–µ–ø–æ–≤—Ç–æ—Ä—é–≤–∞–Ω–æ–º—É —á–∏—Ç–∞–Ω–Ω—é, –∞–ª–µ –º–æ–∂–ª–∏–≤—ñ —Ñ–∞–Ω—Ç–æ–º–Ω—ñ –∑–∞–ø–∏—Å–∏.

**SERIALIZABLE** –Ω–∞–π–≤–∏—â–∏–π —Ä—ñ–≤–µ–Ω—å —ñ–∑–æ–ª—è—Ü—ñ—ó. –¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è —Ç–∞–∫, –Ω—ñ–±–∏ –≤–æ–Ω–∏ –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ. –ó–∞–ø–æ–±—ñ–≥–∞—î –≤—Å—ñ–º –∞–Ω–æ–º–∞–ª—ñ—è–º.

```sql
BEGIN TRANSACTION ISOLATION LEVEL SERIALIZABLE;
-- –æ–ø–µ—Ä–∞—Ü—ñ—ó –∑ –¥–∞–Ω–∏–º–∏
COMMIT;
```

### –û–±–º–µ–∂–µ–Ω–Ω—è —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ

–û–±–º–µ–∂–µ–Ω–Ω—è —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ —î –ø—Ä–∞–≤–∏–ª–∞–º–∏, —è–∫—ñ –∑–∞–±–µ–∑–ø–µ—á—É—é—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω—ñ—Å—Ç—å —Ç–∞ —É–∑–≥–æ–¥–∂–µ–Ω—ñ—Å—Ç—å –¥–∞–Ω–∏—Ö —É –±–∞–∑—ñ –¥–∞–Ω–∏—Ö.

#### PRIMARY KEY

–ü–µ—Ä–≤–∏–Ω–Ω–∏–π –∫–ª—é—á —É–Ω—ñ–∫–∞–ª—å–Ω–æ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫—É—î –∫–æ–∂–µ–Ω –∑–∞–ø–∏—Å —É —Ç–∞–±–ª–∏—Ü—ñ. –ù–µ –º–æ–∂–µ –º—ñ—Å—Ç–∏—Ç–∏ NULL –∑–Ω–∞—á–µ–Ω–Ω—è.

```sql
CREATE TABLE books (
    book_id SERIAL PRIMARY KEY,
    isbn VARCHAR(17) UNIQUE NOT NULL,
    title VARCHAR(200) NOT NULL
);
```

#### FOREIGN KEY

–ó–æ–≤–Ω—ñ—à–Ω—ñ–π –∫–ª—é—á —Å—Ç–≤–æ—Ä—é—î –∑–≤'—è–∑–æ–∫ –º—ñ–∂ —Ç–∞–±–ª–∏—Ü—è–º–∏ —Ç–∞ –∑–∞–±–µ–∑–ø–µ—á—É—î –ø–æ—Å–∏–ª–∞–ª—å–Ω—É —Ü—ñ–ª—ñ—Å–Ω—ñ—Å—Ç—å.

```sql
CREATE TABLE books (
    book_id SERIAL PRIMARY KEY,
    author_id INTEGER NOT NULL,
    FOREIGN KEY (author_id) REFERENCES authors(author_id)
);
```

#### UNIQUE

–û–±–º–µ–∂–µ–Ω–Ω—è —É–Ω—ñ–∫–∞–ª—å–Ω–æ—Å—Ç—ñ –∑–∞–±–µ–∑–ø–µ—á—É—î, —â–æ –∑–Ω–∞—á–µ–Ω–Ω—è –≤ —Å—Ç–æ–≤–ø—Ü—ñ –∞–±–æ –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—ó —Å—Ç–æ–≤–ø—Ü—ñ–≤ —î —É–Ω—ñ–∫–∞–ª—å–Ω–∏–º–∏.

```sql
CREATE TABLE readers (
    reader_id SERIAL PRIMARY KEY,
    email VARCHAR(100) UNIQUE NOT NULL,
    library_card_number VARCHAR(20) UNIQUE NOT NULL
);
```

#### CHECK

–û–±–º–µ–∂–µ–Ω–Ω—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –∑–∞–±–µ–∑–ø–µ—á—É—î, —â–æ –∑–Ω–∞—á–µ–Ω–Ω—è –≤ —Å—Ç–æ–≤–ø—Ü—ñ –∑–∞–¥–æ–≤–æ–ª—å–Ω—è—î –ø–µ–≤–Ω—É —É–º–æ–≤—É.

```sql
CREATE TABLE books (
    book_id SERIAL PRIMARY KEY,
    title VARCHAR(200) NOT NULL,
    publication_year INTEGER CHECK (publication_year >= 1450 AND publication_year <= EXTRACT(YEAR FROM CURRENT_DATE)),
    available_copies INTEGER CHECK (available_copies >= 0)
);
```

#### NOT NULL

–û–±–º–µ–∂–µ–Ω–Ω—è –∑–∞–±–æ—Ä–æ–Ω—è—î NULL –∑–Ω–∞—á–µ–Ω–Ω—è –≤ —Å—Ç–æ–≤–ø—Ü—ñ.

```sql
CREATE TABLE authors (
    author_id SERIAL PRIMARY KEY,
    first_name VARCHAR(50) NOT NULL,
    last_name VARCHAR(50) NOT NULL
);
```

### –ö–∞—Å–∫–∞–¥–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó

–ö–∞—Å–∫–∞–¥–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–∫–æ–Ω—É—é—Ç—å –ø–µ–≤–Ω—ñ –¥—ñ—ó –Ω–∞–¥ –ø–æ–≤'—è–∑–∞–Ω–∏–º–∏ –∑–∞–ø–∏—Å–∞–º–∏ –ø—Ä–∏ –∑–º—ñ–Ω—ñ –∞–±–æ –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ –±–∞—Ç—å–∫—ñ–≤—Å—å–∫–æ–≥–æ –∑–∞–ø–∏—Å—É.

#### ON DELETE CASCADE

–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–¥–∞–ª—è—î –≤—Å—ñ –∑–∞–ª–µ–∂–Ω—ñ –∑–∞–ø–∏—Å–∏ –ø—Ä–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ –±–∞—Ç—å–∫—ñ–≤—Å—å–∫–æ–≥–æ –∑–∞–ø–∏—Å—É.

```sql
CREATE TABLE lendings (
    lending_id SERIAL PRIMARY KEY,
    book_id INTEGER NOT NULL,
    reader_id INTEGER NOT NULL,
    FOREIGN KEY (book_id) REFERENCES books(book_id) ON DELETE CASCADE,
    FOREIGN KEY (reader_id) REFERENCES readers(reader_id) ON DELETE CASCADE
);
```

–ü—Ä–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ –∫–Ω–∏–≥–∏ –∑ —Ç–∞–±–ª–∏—Ü—ñ books –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–¥–∞–ª—è—Ç—å—Å—è –≤—Å—ñ –∑–∞–ø–∏—Å–∏ –ø—Ä–æ –≤–∏–¥–∞—á—ñ —Ü—ñ—î—ó –∫–Ω–∏–≥–∏.

#### ON UPDATE CASCADE

–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–Ω–æ–≤–ª—é—î –∑–Ω–∞—á–µ–Ω–Ω—è –∑–æ–≤–Ω—ñ—à–Ω—å–æ–≥–æ –∫–ª—é—á–∞ –ø—Ä–∏ –∑–º—ñ–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è –ø–µ—Ä–≤–∏–Ω–Ω–æ–≥–æ –∫–ª—é—á–∞ –≤ –±–∞—Ç—å–∫—ñ–≤—Å—å–∫—ñ–π —Ç–∞–±–ª–∏—Ü—ñ.

```sql
CREATE TABLE books (
    book_id SERIAL PRIMARY KEY,
    author_id INTEGER NOT NULL,
    FOREIGN KEY (author_id) REFERENCES authors(author_id) ON UPDATE CASCADE
);
```

#### ON DELETE SET NULL

–í—Å—Ç–∞–Ω–æ–≤–ª—é—î NULL —É –∑–æ–≤–Ω—ñ—à–Ω—å–æ–º—É –∫–ª—é—á—ñ –ø—Ä–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ –±–∞—Ç—å–∫—ñ–≤—Å—å–∫–æ–≥–æ –∑–∞–ø–∏—Å—É.

```sql
CREATE TABLE books (
    book_id SERIAL PRIMARY KEY,
    publisher_id INTEGER,
    FOREIGN KEY (publisher_id) REFERENCES publishers(publisher_id) ON DELETE SET NULL
);
```

#### ON DELETE SET DEFAULT

–í—Å—Ç–∞–Ω–æ–≤–ª—é—î –∑–Ω–∞—á–µ–Ω–Ω—è –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º —É –∑–æ–≤–Ω—ñ—à–Ω—å–æ–º—É –∫–ª—é—á—ñ –ø—Ä–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ –±–∞—Ç—å–∫—ñ–≤—Å—å–∫–æ–≥–æ –∑–∞–ø–∏—Å—É.

```sql
CREATE TABLE books (
    book_id SERIAL PRIMARY KEY,
    category_id INTEGER DEFAULT 1,
    FOREIGN KEY (category_id) REFERENCES categories(category_id) ON DELETE SET DEFAULT
);
```

#### ON DELETE RESTRICT

–ó–∞–±–æ—Ä–æ–Ω—è—î –≤–∏–¥–∞–ª–µ–Ω–Ω—è –±–∞—Ç—å–∫—ñ–≤—Å—å–∫–æ–≥–æ –∑–∞–ø–∏—Å—É, —è–∫—â–æ —ñ—Å–Ω—É—é—Ç—å –∑–∞–ª–µ–∂–Ω—ñ –∑–∞–ø–∏—Å–∏. –¶–µ –ø–æ–≤–µ–¥—ñ–Ω–∫–∞ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º.

```sql
CREATE TABLE books (
    book_id SERIAL PRIMARY KEY,
    author_id INTEGER NOT NULL,
    FOREIGN KEY (author_id) REFERENCES authors(author_id) ON DELETE RESTRICT
);
```

### –¢—Ä–∏–≥–µ—Ä–∏ –¥–ª—è –∞—É–¥–∏—Ç—É –∑–º—ñ–Ω

–¢—Ä–∏–≥–µ—Ä–∏ –¥–æ–∑–≤–æ–ª—è—é—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –ø–µ–≤–Ω—ñ –¥—ñ—ó –ø—Ä–∏ –≤–∏–Ω–∏–∫–Ω–µ–Ω–Ω—ñ –ø–æ–¥—ñ–π –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –¥–∞–Ω–∏—Ö.

```sql
-- –¢–∞–±–ª–∏—Ü—è –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó –∑–º—ñ–Ω
CREATE TABLE books_audit (
    audit_id SERIAL PRIMARY KEY,
    book_id INTEGER NOT NULL,
    operation VARCHAR(10) NOT NULL,
    old_data JSONB,
    new_data JSONB,
    changed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    changed_by VARCHAR(100) DEFAULT CURRENT_USER
);

-- –§—É–Ω–∫—Ü—ñ—è —Ç—Ä–∏–≥–µ—Ä–∞
CREATE OR REPLACE FUNCTION audit_books_changes()
RETURNS TRIGGER AS $$
BEGIN
    IF TG_OP = 'INSERT' THEN
        INSERT INTO books_audit (book_id, operation, new_data)
        VALUES (NEW.book_id, 'INSERT', row_to_json(NEW));
        RETURN NEW;
    ELSIF TG_OP = 'UPDATE' THEN
        INSERT INTO books_audit (book_id, operation, old_data, new_data)
        VALUES (NEW.book_id, 'UPDATE', row_to_json(OLD), row_to_json(NEW));
        RETURN NEW;
    ELSIF TG_OP = 'DELETE' THEN
        INSERT INTO books_audit (book_id, operation, old_data)
        VALUES (OLD.book_id, 'DELETE', row_to_json(OLD));
        RETURN OLD;
    END IF;
END;
$$ LANGUAGE plpgsql;

-- –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç—Ä–∏–≥–µ—Ä–∞
CREATE TRIGGER books_audit_trigger
AFTER INSERT OR UPDATE OR DELETE ON books
FOR EACH ROW
EXECUTE FUNCTION audit_books_changes();
```

## ‚ñ∂Ô∏è –•—ñ–¥ —Ä–æ–±–æ—Ç–∏

### –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞

1. –ü–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—è, —â–æ PostgreSQL –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ —Ç–∞ –∑–∞–ø—É—â–µ–Ω–æ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–º—É –∫–æ–º–ø'—é—Ç–µ—Ä—ñ –∞–±–æ —î –¥–æ—Å—Ç—É–ø –¥–æ –≤—ñ–¥–¥–∞–ª–µ–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞.
2. –í—ñ–¥–∫—Ä–∏—Ç–∏ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ –±–∞–∑–æ—é –¥–∞–Ω–∏—Ö: pgAdmin, DBeaver –∞–±–æ –∫–æ–º–∞–Ω–¥–Ω–∏–π —Ä—è–¥–æ–∫ psql.
3. –°—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤—É –±–∞–∑—É –¥–∞–Ω–∏—Ö –¥–ª—è –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ—ó —Ä–æ–±–æ—Ç–∏.

```sql
CREATE DATABASE library_lab3;
```
4. –ü—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è –¥–æ —Å—Ç–≤–æ—Ä–µ–Ω–æ—ó –±–∞–∑–∏ –¥–∞–Ω–∏—Ö.
    ### –†—ñ–≤–µ–Ω—å 1

    #### –ö—Ä–æ–∫ 1. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö

    –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ç–∞–±–ª–∏—Ü—ñ –¥–ª—è —Å–∏—Å—Ç–µ–º–∏ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –±—ñ–±–ª—ñ–æ—Ç–µ–∫–æ—é –∑ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–º–∏ –æ–±–º–µ–∂–µ–Ω–Ω—è–º–∏ —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ.

    ```sql
    -- –¢–∞–±–ª–∏—Ü—è –∞–≤—Ç–æ—Ä—ñ–≤
    CREATE TABLE authors (
        author_id SERIAL PRIMARY KEY,
        first_name VARCHAR(50) NOT NULL,
        last_name VARCHAR(50) NOT NULL,
        birth_year INTEGER CHECK (birth_year >= 1000 AND birth_year <= EXTRACT(YEAR FROM CURRENT_DATE)),
        country VARCHAR(50),
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
    );

    -- –¢–∞–±–ª–∏—Ü—è –∫–Ω–∏–≥
    CREATE TABLE books (
        book_id SERIAL PRIMARY KEY,
        isbn VARCHAR(17) UNIQUE NOT NULL,
        title VARCHAR(200) NOT NULL,
        author_id INTEGER NOT NULL,
        publication_year INTEGER CHECK (publication_year >= 1450),
        genre VARCHAR(50),
        total_copies INTEGER DEFAULT 1 CHECK (total_copies >= 0),
        available_copies INTEGER DEFAULT 1 CHECK (available_copies >= 0),
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        FOREIGN KEY (author_id) REFERENCES authors(author_id) ON DELETE RESTRICT,
        CHECK (available_copies <= total_copies)
    );

    -- –¢–∞–±–ª–∏—Ü—è —á–∏—Ç–∞—á—ñ–≤
    CREATE TABLE readers (
        reader_id SERIAL PRIMARY KEY,
        first_name VARCHAR(50) NOT NULL,
        last_name VARCHAR(50) NOT NULL,
        email VARCHAR(100) UNIQUE NOT NULL,
        phone VARCHAR(20),
        library_card_number VARCHAR(20) UNIQUE NOT NULL,
        registration_date DATE DEFAULT CURRENT_DATE,
        status VARCHAR(20) DEFAULT 'Active' CHECK (status IN ('Active', 'Blocked', 'Inactive'))
    );

    -- –¢–∞–±–ª–∏—Ü—è –≤–∏–¥–∞—á –∫–Ω–∏–≥
    CREATE TABLE lendings (
        lending_id SERIAL PRIMARY KEY,
        book_id INTEGER NOT NULL,
        reader_id INTEGER NOT NULL,
        lending_date DATE DEFAULT CURRENT_DATE,
        due_date DATE NOT NULL,
        return_date DATE,
        FOREIGN KEY (book_id) REFERENCES books(book_id) ON DELETE RESTRICT,
        FOREIGN KEY (reader_id) REFERENCES readers(reader_id) ON DELETE RESTRICT,
        CHECK (due_date > lending_date),
        CHECK (return_date IS NULL OR return_date >= lending_date)
    );
    ```

    #### –ö—Ä–æ–∫ 2. –î–æ–¥–∞–≤–∞–Ω–Ω—è —Ç–µ—Å—Ç–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö

    –í—Å—Ç–∞–≤–∏—Ç–∏ –ø–æ—á–∞—Ç–∫–æ–≤—ñ –¥–∞–Ω—ñ —É —Å—Ç–≤–æ—Ä–µ–Ω—ñ —Ç–∞–±–ª–∏—Ü—ñ.

    ```sql
    -- –î–æ–¥–∞–≤–∞–Ω–Ω—è –∞–≤—Ç–æ—Ä—ñ–≤
    INSERT INTO authors (first_name, last_name, birth_year, country)
    VALUES
        ('–¢–∞—Ä–∞—Å', '–®–µ–≤—á–µ–Ω–∫–æ', 1814, '–£–∫—Ä–∞—ó–Ω–∞'),
        ('–Ü–≤–∞–Ω', '–§—Ä–∞–Ω–∫–æ', 1856, '–£–∫—Ä–∞—ó–Ω–∞'),
        ('–õ–µ—Å—è', '–£–∫—Ä–∞—ó–Ω–∫–∞', 1871, '–£–∫—Ä–∞—ó–Ω–∞'),
        ('–ú–∏—Ö–∞–π–ª–æ', '–ö–æ—Ü—é–±–∏–Ω—Å—å–∫–∏–π', 1864, '–£–∫—Ä–∞—ó–Ω–∞'),
        ('–ü–∞–Ω–∞—Å', '–ú–∏—Ä–Ω–∏–π', 1849, '–£–∫—Ä–∞—ó–Ω–∞');

    -- –î–æ–¥–∞–≤–∞–Ω–Ω—è –∫–Ω–∏–≥
    INSERT INTO books (isbn, title, author_id, publication_year, genre, total_copies, available_copies)
    VALUES
        ('978-966-03-4561-2', '–ö–æ–±–∑–∞—Ä', 1, 1840, '–ü–æ–µ–∑—ñ—è', 10, 8),
        ('978-966-03-4562-9', '–ó–∞—Ö–∞—Ä –ë–µ—Ä–∫—É—Ç', 2, 1883, '–Ü—Å—Ç–æ—Ä–∏—á–Ω–∞ –ø—Ä–æ–∑–∞', 5, 4),
        ('978-966-03-4563-6', '–õ—ñ—Å–æ–≤–∞ –ø—ñ—Å–Ω—è', 3, 1911, '–î—Ä–∞–º–∞', 7, 7),
        ('978-966-03-4564-3', '–¢—ñ–Ω—ñ –∑–∞–±—É—Ç–∏—Ö –ø—Ä–µ–¥–∫—ñ–≤', 4, 1911, '–ü–æ–≤—ñ—Å—Ç—å', 6, 5),
        ('978-966-03-4565-0', '–•—ñ–±–∞ —Ä–µ–≤—É—Ç—å –≤–æ–ª–∏, —è–∫ —è—Å–ª–∞ –ø–æ–≤–Ω—ñ', 5, 1880, '–ü–æ–≤—ñ—Å—Ç—å', 4, 4);

    -- –î–æ–¥–∞–≤–∞–Ω–Ω—è —á–∏—Ç–∞—á—ñ–≤
    INSERT INTO readers (first_name, last_name, email, phone, library_card_number)
    VALUES
        ('–û–ª–µ–Ω–∞', '–ü–µ—Ç—Ä–µ–Ω–∫–æ', 'olena.petrenko@email.com', '+380501234567', 'LIB-2024-001'),
        ('–ê–Ω–¥—Ä—ñ–π', '–ö–æ–≤–∞–ª–µ–Ω–∫–æ', 'andrii.kovalenko@email.com', '+380502345678', 'LIB-2024-002'),
        ('–ú–∞—Ä—ñ—è', '–°–∏–¥–æ—Ä–µ–Ω–∫–æ', 'maria.sydorenko@email.com', '+380503456789', 'LIB-2024-003'),
        ('–Ü–≤–∞–Ω', '–ú–µ–ª—å–Ω–∏–∫', 'ivan.melnyk@email.com', '+380504567890', 'LIB-2024-004');
    ```

    #### –ö—Ä–æ–∫ 3. –ë–µ–∑–ø–µ—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ø–∏—Å—ñ–≤

    –í–∏–∫–æ–Ω–∞—Ç–∏ –æ–ø–µ—Ä–∞—Ü—ñ—ó UPDATE –∑ –æ–±–æ–≤'—è–∑–∫–æ–≤–æ—é –ø–µ—Ä–µ–≤—ñ—Ä–∫–æ—é —á–µ—Ä–µ–∑ SELECT.

    ```sql
    -- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è–º
    SELECT book_id, title, available_copies
    FROM books
    WHERE book_id = 1;

    -- –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –¥–æ—Å—Ç—É–ø–Ω–∏—Ö –ø—Ä–∏–º—ñ—Ä–Ω–∏–∫—ñ–≤
    UPDATE books
    SET available_copies = available_copies - 1
    WHERE book_id = 1 AND available_copies > 0;

    -- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
    SELECT book_id, title, available_copies
    FROM books
    WHERE book_id = 1;
    ```

    #### –ö—Ä–æ–∫ 4. –û–ø–µ—Ä–∞—Ü—ñ—ó –∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è–º–∏

    –í–∏–∫–æ–Ω–∞—Ç–∏ –≤–∏–¥–∞—á—É –∫–Ω–∏–≥–∏ —á–∏—Ç–∞—á—É —è–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—é –∑ –∫—ñ–ª—å–∫–æ—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π.

    ```sql
    BEGIN;

    -- –í–∏–¥–∞—á–∞ –∫–Ω–∏–≥–∏
    INSERT INTO lendings (book_id, reader_id, due_date)
    VALUES (1, 1, CURRENT_DATE + INTERVAL '14 days');

    -- –ó–º–µ–Ω—à–µ–Ω–Ω—è –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –¥–æ—Å—Ç—É–ø–Ω–∏—Ö –ø—Ä–∏–º—ñ—Ä–Ω–∏–∫—ñ–≤
    UPDATE books
    SET available_copies = available_copies - 1
    WHERE book_id = 1 AND available_copies > 0;

    -- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ –ø–µ—Ä–µ–¥ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è–º
    SELECT * FROM lendings WHERE lending_id = LASTVAL();
    SELECT available_copies FROM books WHERE book_id = 1;

    COMMIT;
    ```

    #### –ö—Ä–æ–∫ 5. –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—è ROLLBACK

    –ü–æ–∫–∞–∑–∞—Ç–∏ –≤—ñ–¥–∫–∞—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó –ø—Ä–∏ –≤–∏–Ω–∏–∫–Ω–µ–Ω–Ω—ñ –ø–æ–º–∏–ª–∫–∏.

    ```sql
    BEGIN;

    -- –°–ø—Ä–æ–±–∞ –≤–∏–¥–∞–ª–∏—Ç–∏ –∞–≤—Ç–æ—Ä–∞, —É —è–∫–æ–≥–æ —î –∫–Ω–∏–≥–∏
    DELETE FROM authors WHERE author_id = 1;

    -- –¶—è –æ–ø–µ—Ä–∞—Ü—ñ—è –≤–∏–∫–ª–∏—á–µ –ø–æ–º–∏–ª–∫—É —á–µ—Ä–µ–∑ –æ–±–º–µ–∂–µ–Ω–Ω—è FOREIGN KEY
    -- –¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—ñ–¥–∫–æ—Ç–∏—Ç—å—Å—è

    ROLLBACK;

    -- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞, —â–æ –¥–∞–Ω—ñ –Ω–µ –∑–º—ñ–Ω–∏–ª–∏—Å—è
    SELECT * FROM authors WHERE author_id = 1;
    ```

    #### –ö—Ä–æ–∫ 6. –ë–µ–∑–ø–µ—á–Ω–µ –≤–∏–¥–∞–ª–µ–Ω–Ω—è

    –í–∏–∫–æ–Ω–∞—Ç–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∑ –ø–µ—Ä–µ–≤—ñ—Ä–∫–æ—é.

    ```sql
    -- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –≤–∏–¥–∞–ª–µ–Ω–Ω—è–º
    SELECT * FROM readers WHERE status = 'Inactive' AND reader_id NOT IN (
        SELECT DISTINCT reader_id FROM lendings WHERE return_date IS NULL
    );

    -- –í–∏–¥–∞–ª–µ–Ω–Ω—è –Ω–µ–∞–∫—Ç–∏–≤–Ω–∏—Ö —á–∏—Ç–∞—á—ñ–≤ –±–µ–∑ –±–æ—Ä–≥—ñ–≤
    DELETE FROM readers
    WHERE status = 'Inactive' AND reader_id NOT IN (
        SELECT DISTINCT reader_id FROM lendings WHERE return_date IS NULL
    );
    ```

    ### –†—ñ–≤–µ–Ω—å 2

    #### –ö—Ä–æ–∫ 1. –î–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–∏—Ö —Ç–∞–±–ª–∏—Ü—å

    –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ç–∞–±–ª–∏—Ü—ñ –¥–ª—è –±—Ä–æ–Ω—é–≤–∞–Ω—å —Ç–∞ —ñ—Å—Ç–æ—Ä—ñ—ó –∑–º—ñ–Ω.

    ```sql
    -- –¢–∞–±–ª–∏—Ü—è –±—Ä–æ–Ω—é–≤–∞–Ω—å
    CREATE TABLE reservations (
        reservation_id SERIAL PRIMARY KEY,
        book_id INTEGER NOT NULL,
        reader_id INTEGER NOT NULL,
        reservation_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        expiration_date TIMESTAMP NOT NULL,
        status VARCHAR(20) DEFAULT 'Active' CHECK (status IN ('Active', 'Fulfilled', 'Cancelled', 'Expired')),
        FOREIGN KEY (book_id) REFERENCES books(book_id) ON DELETE CASCADE,
        FOREIGN KEY (reader_id) REFERENCES readers(reader_id) ON DELETE CASCADE
    );

    -- –¢–∞–±–ª–∏—Ü—è —ñ—Å—Ç–æ—Ä—ñ—ó –∑–º—ñ–Ω
    CREATE TABLE audit_log (
        log_id SERIAL PRIMARY KEY,
        table_name VARCHAR(50) NOT NULL,
        operation VARCHAR(10) NOT NULL,
        record_id INTEGER NOT NULL,
        old_data JSONB,
        new_data JSONB,
        changed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        changed_by VARCHAR(100) DEFAULT CURRENT_USER
    );
    ```

    #### –ö—Ä–æ–∫ 2. –°–∫–ª–∞–¥–Ω—ñ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó

    –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –ø—Ä–æ—Ü–µ—Å –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –∫–Ω–∏–≥–∏ –∑ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è–º –∫—ñ–ª—å–∫–æ—Ö —Ç–∞–±–ª–∏—Ü—å.

    ```sql
    BEGIN;

    -- –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ø–∏—Å—É –ø—Ä–æ –≤–∏–¥–∞—á—É
    UPDATE lendings
    SET return_date = CURRENT_DATE
    WHERE lending_id = 1 AND return_date IS NULL;

    -- –ó–±—ñ–ª—å—à–µ–Ω–Ω—è –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –¥–æ—Å—Ç—É–ø–Ω–∏—Ö –ø—Ä–∏–º—ñ—Ä–Ω–∏–∫—ñ–≤
    UPDATE books
    SET available_copies = available_copies + 1
    WHERE book_id = (SELECT book_id FROM lendings WHERE lending_id = 1);

    -- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–∏ —î –∞–∫—Ç–∏–≤–Ω—ñ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è –Ω–∞ —Ü—é –∫–Ω–∏–≥—É
    SELECT reservation_id, reader_id
    FROM reservations
    WHERE book_id = (SELECT book_id FROM lendings WHERE lending_id = 1)
        AND status = 'Active'
    ORDER BY reservation_date
    LIMIT 1;

    -- –Ø–∫—â–æ —î –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è, –∑–º—ñ–Ω—é—î–º–æ –π–æ–≥–æ —Å—Ç–∞—Ç—É—Å
    UPDATE reservations
    SET status = 'Fulfilled'
    WHERE reservation_id = (
        SELECT reservation_id
        FROM reservations
        WHERE book_id = (SELECT book_id FROM lendings WHERE lending_id = 1)
            AND status = 'Active'
        ORDER BY reservation_date
        LIMIT 1
    );

    COMMIT;
    ```

    #### –ö—Ä–æ–∫ 3. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è SAVEPOINT

    –î–µ–º–æ–Ω—Å—Ç—Ä—É–≤–∞—Ç–∏ —á–∞—Å—Ç–∫–∏–π –≤—ñ–¥–∫–∞—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó.

    ```sql
    BEGIN;

    -- –î–æ–¥–∞—î–º–æ –Ω–æ–≤–æ–≥–æ –∞–≤—Ç–æ—Ä–∞
    INSERT INTO authors (first_name, last_name, birth_year, country)
    VALUES ('–û–ª—å–≥–∞', '–ö–æ–±–∏–ª—è–Ω—Å—å–∫–∞', 1863, '–£–∫—Ä–∞—ó–Ω–∞');

    SAVEPOINT after_author;

    -- –î–æ–¥–∞—î–º–æ –∫–Ω–∏–≥—É
    INSERT INTO books (isbn, title, author_id, publication_year, genre, total_copies, available_copies)
    VALUES ('978-966-03-4566-7', '–ó–µ–º–ª—è', LASTVAL(), 1902, '–†–æ–º–∞–Ω', 3, 3);

    SAVEPOINT after_book;

    -- –°–ø—Ä–æ–±–∞ –¥–æ–¥–∞—Ç–∏ –¥—É–±–ª—ñ–∫–∞—Ç ISBN –≤–∏–∫–ª–∏—á–µ –ø–æ–º–∏–ª–∫—É
    INSERT INTO books (isbn, title, author_id, publication_year, genre)
    VALUES ('978-966-03-4566-7', '–Ü–Ω—à–∞ –∫–Ω–∏–≥–∞', LASTVAL(), 1905, '–†–æ–º–∞–Ω');

    -- –í—ñ–¥–∫–∞—Ç –¥–æ —Ç–æ—á–∫–∏ –ø—ñ—Å–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∞–≤—Ç–æ—Ä–∞, –∞–ª–µ –¥–æ –ø–æ–º–∏–ª–∫–∏ –∑ –∫–Ω–∏–≥–æ—é
    ROLLBACK TO SAVEPOINT after_author;

    -- –î–æ–¥–∞—î–º–æ –∫–Ω–∏–≥—É –∑ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–º ISBN
    INSERT INTO books (isbn, title, author_id, publication_year, genre, total_copies, available_copies)
    VALUES ('978-966-03-4567-4', '–ó–µ–º–ª—è', LASTVAL(), 1902, '–†–æ–º–∞–Ω', 3, 3);

    COMMIT;
    ```

    #### –ö—Ä–æ–∫ 4. –ö–∞—Å–∫–∞–¥–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó

    –ü—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä—É–≤–∞—Ç–∏ —Ä–æ–±–æ—Ç—É –∫–∞—Å–∫–∞–¥–Ω–æ–≥–æ –≤–∏–¥–∞–ª–µ–Ω–Ω—è.

    ```sql
    -- –°—Ç–≤–æ—Ä—é—î–º–æ —Ç–µ—Å—Ç–æ–≤—ñ –¥–∞–Ω—ñ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—ó –∫–∞—Å–∫–∞–¥—É
    BEGIN;

    INSERT INTO authors (first_name, last_name, birth_year, country)
    VALUES ('–¢–µ—Å—Ç–æ–≤–∏–π', '–ê–≤—Ç–æ—Ä', 1900, '–£–∫—Ä–∞—ó–Ω–∞');

    INSERT INTO books (isbn, title, author_id, publication_year, genre, total_copies, available_copies)
    VALUES ('978-966-00-0000-0', '–¢–µ—Å—Ç–æ–≤–∞ –∫–Ω–∏–≥–∞', LASTVAL(), 2000, '–¢–µ—Å—Ç', 1, 0);

    INSERT INTO reservations (book_id, reader_id, expiration_date)
    VALUES (LASTVAL(), 1, CURRENT_TIMESTAMP + INTERVAL '7 days');

    COMMIT;

    -- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–≤'—è–∑–∫—ñ–≤
    SELECT b.book_id, b.title, r.reservation_id
    FROM books b
    LEFT JOIN reservations r ON b.book_id = r.book_id
    WHERE b.isbn = '978-966-00-0000-0';

    -- –í–∏–¥–∞–ª–µ–Ω–Ω—è –∫–Ω–∏–≥–∏ –∑ –∫–∞—Å–∫–∞–¥–Ω–∏–º –≤–∏–¥–∞–ª–µ–Ω–Ω—è–º –±—Ä–æ–Ω—é–≤–∞–Ω—å
    DELETE FROM books WHERE isbn = '978-966-00-0000-0';

    -- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞, —â–æ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è —Ç–∞–∫–æ–∂ –≤–∏–¥–∞–ª–∏–ª–∏—Å—è
    SELECT * FROM reservations WHERE book_id NOT IN (SELECT book_id FROM books);
    ```

    #### –ö—Ä–æ–∫ 5. –¢—Ä–∏–≥–µ—Ä–∏ –¥–ª—è –∞—É–¥–∏—Ç—É

    –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ç—Ä–∏–≥–µ—Ä –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –ª–æ–≥—É–≤–∞–Ω–Ω—è –∑–º—ñ–Ω.

    ```sql
    -- –§—É–Ω–∫—Ü—ñ—è —Ç—Ä–∏–≥–µ—Ä–∞
    CREATE OR REPLACE FUNCTION log_books_changes()
    RETURNS TRIGGER AS $$
    BEGIN
        IF TG_OP = 'INSERT' THEN
            INSERT INTO audit_log (table_name, operation, record_id, new_data)
            VALUES ('books', 'INSERT', NEW.book_id, row_to_json(NEW)::jsonb);
        ELSIF TG_OP = 'UPDATE' THEN
            INSERT INTO audit_log (table_name, operation, record_id, old_data, new_data)
            VALUES ('books', 'UPDATE', NEW.book_id, row_to_json(OLD)::jsonb, row_to_json(NEW)::jsonb);
        ELSIF TG_OP = 'DELETE' THEN
            INSERT INTO audit_log (table_name, operation, record_id, old_data)
            VALUES ('books', 'DELETE', OLD.book_id, row_to_json(OLD)::jsonb);
        END IF;
        RETURN NULL;
    END;
    $$ LANGUAGE plpgsql;

    -- –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç—Ä–∏–≥–µ—Ä–∞
    CREATE TRIGGER books_audit_trigger
    AFTER INSERT OR UPDATE OR DELETE ON books
    FOR EACH ROW
    EXECUTE FUNCTION log_books_changes();

    -- –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Ç—Ä–∏–≥–µ—Ä–∞
    UPDATE books SET available_copies = available_copies + 1 WHERE book_id = 1;

    -- –ü–µ—Ä–µ–≥–ª—è–¥ –ª–æ–≥—É
    SELECT log_id, operation, record_id,
          new_data->>'title' as title,
          old_data->>'available_copies' as old_copies,
          new_data->>'available_copies' as new_copies,
          changed_at
    FROM audit_log
    WHERE table_name = 'books'
    ORDER BY changed_at DESC;
    ```

    #### –ö—Ä–æ–∫ 6. –ë–ª–æ–∫—É–≤–∞–Ω–Ω—è –∑–∞–ø–∏—Å—ñ–≤

    –ü—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä—É–≤–∞—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –±–ª–æ–∫—É–≤–∞–Ω—å –¥–ª—è –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø—É.

    ```sql
    -- –¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è 1 (–≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –≤ –æ–¥–Ω–æ–º—É –∑'—î–¥–Ω–∞–Ω–Ω—ñ)
    BEGIN;

    -- –ë–ª–æ–∫—É–≤–∞–Ω–Ω—è –∑–∞–ø–∏—Å—É –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
    SELECT * FROM books WHERE book_id = 1 FOR UPDATE;

    -- –Ü–º—ñ—Ç–∞—Ü—ñ—è –¥–æ–≤–≥–æ—ó –æ–ø–µ—Ä–∞—Ü—ñ—ó
    SELECT pg_sleep(5);

    UPDATE books SET available_copies = available_copies - 1 WHERE book_id = 1;

    COMMIT;

    -- –¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è 2 (–≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –≤ —ñ–Ω—à–æ–º—É –∑'—î–¥–Ω–∞–Ω–Ω—ñ –æ–¥–Ω–æ—á–∞—Å–Ω–æ)
    -- –ë—É–¥–µ –æ—á—ñ–∫—É–≤–∞—Ç–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó 1
    BEGIN;
    SELECT * FROM books WHERE book_id = 1 FOR UPDATE;
    UPDATE books SET available_copies = available_copies - 1 WHERE book_id = 1;
    COMMIT;
    ```

    ### –†—ñ–≤–µ–Ω—å 3

    #### –ö—Ä–æ–∫ 1. –°–∏—Å—Ç–µ–º–∞ –≤–µ—Ä—Å—ñ–æ–Ω—É–≤–∞–Ω–Ω—è

    –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –º–µ—Ö–∞–Ω—ñ–∑–º –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤—Å—ñ—Ö –≤–µ—Ä—Å—ñ–π –∑–∞–ø–∏—Å—ñ–≤.

    ```sql
    -- –¢–∞–±–ª–∏—Ü—è –≤–µ—Ä—Å—ñ–π –∫–Ω–∏–≥
    CREATE TABLE books_versions (
        version_id SERIAL PRIMARY KEY,
        book_id INTEGER NOT NULL,
        version_number INTEGER NOT NULL,
        data JSONB NOT NULL,
        valid_from TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        valid_to TIMESTAMP,
        created_by VARCHAR(100) DEFAULT CURRENT_USER,
        UNIQUE(book_id, version_number)
    );

    -- –§—É–Ω–∫—Ü—ñ—è –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ—ó –≤–µ—Ä—Å—ñ—ó
    CREATE OR REPLACE FUNCTION create_book_version()
    RETURNS TRIGGER AS $$
    DECLARE
        v_version_number INTEGER;
    BEGIN
        -- –ó–∞–∫—Ä–∏–≤–∞—î–º–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—é –≤–µ—Ä—Å—ñ—é
        UPDATE books_versions
        SET valid_to = CURRENT_TIMESTAMP
        WHERE book_id = NEW.book_id AND valid_to IS NULL;

        -- –í–∏–∑–Ω–∞—á–∞—î–º–æ –Ω–æ–º–µ—Ä –Ω–æ–≤–æ—ó –≤–µ—Ä—Å—ñ—ó
        SELECT COALESCE(MAX(version_number), 0) + 1
        INTO v_version_number
        FROM books_versions
        WHERE book_id = NEW.book_id;

        -- –°—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤—É –≤–µ—Ä—Å—ñ—é
        INSERT INTO books_versions (book_id, version_number, data)
        VALUES (NEW.book_id, v_version_number, row_to_json(NEW)::jsonb);

        RETURN NEW;
    END;
    $$ LANGUAGE plpgsql;

    CREATE TRIGGER book_versioning_trigger
    AFTER INSERT OR UPDATE ON books
    FOR EACH ROW
    EXECUTE FUNCTION create_book_version();

    -- –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –≤–µ—Ä—Å—ñ—ó –Ω–∞ –ø–µ–≤–Ω—É –¥–∞—Ç—É
    CREATE OR REPLACE FUNCTION get_book_version(p_book_id INTEGER, p_date TIMESTAMP)
    RETURNS JSONB AS $$
    BEGIN
        RETURN (
            SELECT data
            FROM books_versions
            WHERE book_id = p_book_id
                AND valid_from <= p_date
                AND (valid_to IS NULL OR valid_to > p_date)
            LIMIT 1
        );
    END;
    $$ LANGUAGE plpgsql;
    ```

    #### –ö—Ä–æ–∫ 2. –í—ñ–¥–∫–ª–∞–¥–µ–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó

    –°—Ç–≤–æ—Ä–∏—Ç–∏ –º–µ—Ö–∞–Ω—ñ–∑–º –ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è –æ–ø–µ—Ä–∞—Ü—ñ–π –Ω–∞ –º–∞–π–±—É—Ç–Ω—î.

    ```sql
    -- –¢–∞–±–ª–∏—Ü—è –≤—ñ–¥–∫–ª–∞–¥–µ–Ω–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π
    CREATE TABLE scheduled_operations (
        operation_id SERIAL PRIMARY KEY,
        operation_type VARCHAR(50) NOT NULL,
        target_table VARCHAR(50) NOT NULL,
        operation_data JSONB NOT NULL,
        scheduled_for TIMESTAMP NOT NULL,
        status VARCHAR(20) DEFAULT 'Pending' CHECK (status IN ('Pending', 'Executed', 'Failed', 'Cancelled')),
        executed_at TIMESTAMP,
        error_message TEXT,
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
    );

    -- –§—É–Ω–∫—Ü—ñ—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –≤—ñ–¥–∫–ª–∞–¥–µ–Ω–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π
    CREATE OR REPLACE FUNCTION execute_scheduled_operations()
    RETURNS INTEGER AS $$
    DECLARE
        v_operation RECORD;
        v_count INTEGER := 0;
        v_sql TEXT;
    BEGIN
        FOR v_operation IN
            SELECT * FROM scheduled_operations
            WHERE status = 'Pending' AND scheduled_for <= CURRENT_TIMESTAMP
        LOOP
            BEGIN
                -- –§–æ—Ä–º—É—î–º–æ SQL –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Ç–∏–ø—É –æ–ø–µ—Ä–∞—Ü—ñ—ó
                CASE v_operation.operation_type
                    WHEN 'UPDATE_BOOK_STATUS' THEN
                        UPDATE books
                        SET available_copies = (v_operation.operation_data->>'available_copies')::INTEGER
                        WHERE book_id = (v_operation.operation_data->>'book_id')::INTEGER;

                    WHEN 'EXPIRE_RESERVATION' THEN
                        UPDATE reservations
                        SET status = 'Expired'
                        WHERE reservation_id = (v_operation.operation_data->>'reservation_id')::INTEGER;

                    WHEN 'BLOCK_READER' THEN
                        UPDATE readers
                        SET status = 'Blocked'
                        WHERE reader_id = (v_operation.operation_data->>'reader_id')::INTEGER;
                END CASE;

                -- –ü–æ–∑–Ω–∞—á–∞—î–º–æ –æ–ø–µ—Ä–∞—Ü—ñ—é —è–∫ –≤–∏–∫–æ–Ω–∞–Ω—É
                UPDATE scheduled_operations
                SET status = 'Executed', executed_at = CURRENT_TIMESTAMP
                WHERE operation_id = v_operation.operation_id;

                v_count := v_count + 1;
            EXCEPTION WHEN OTHERS THEN
                UPDATE scheduled_operations
                SET status = 'Failed',
                    executed_at = CURRENT_TIMESTAMP,
                    error_message = SQLERRM
                WHERE operation_id = v_operation.operation_id;
            END;
        END LOOP;

        RETURN v_count;
    END;
    $$ LANGUAGE plpgsql;

    -- –î–æ–¥–∞–≤–∞–Ω–Ω—è –≤—ñ–¥–∫–ª–∞–¥–µ–Ω–æ—ó –æ–ø–µ—Ä–∞—Ü—ñ—ó
    INSERT INTO scheduled_operations (operation_type, target_table, operation_data, scheduled_for)
    VALUES (
        'EXPIRE_RESERVATION',
        'reservations',
        '{"reservation_id": 1}'::jsonb,
        CURRENT_TIMESTAMP + INTERVAL '1 hour'
    );
    ```

    #### –ö—Ä–æ–∫ 3. –°–∫–ª–∞–¥–Ω–∞ –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∞

    –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –ø—Ä–æ—Ü–µ–¥—É—Ä–∏ –¥–ª—è —Å–∫–ª–∞–¥–Ω–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π.

    ```sql
    -- –ü—Ä–æ—Ü–µ–¥—É—Ä–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –ø—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è —Ç–µ—Ä–º—ñ–Ω—É –≤–∏–¥–∞—á—ñ
    CREATE OR REPLACE FUNCTION extend_lending(
        p_lending_id INTEGER,
        p_days INTEGER DEFAULT 7
    )
    RETURNS TABLE (
        success BOOLEAN,
        message TEXT,
        new_due_date DATE
    ) AS $$
    DECLARE
        v_reader_status VARCHAR(20);
        v_overdue_count INTEGER;
        v_current_due_date DATE;
    BEGIN
        -- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å—É —á–∏—Ç–∞—á–∞
        SELECT r.status, l.due_date
        INTO v_reader_status, v_current_due_date
        FROM lendings l
        JOIN readers r ON l.reader_id = r.reader_id
        WHERE l.lending_id = p_lending_id;

        IF v_reader_status = 'Blocked' THEN
            RETURN QUERY SELECT FALSE, '–ß–∏—Ç–∞—á –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–∏–π'::TEXT, NULL::DATE;
            RETURN;
        END IF;

        -- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –ø—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω–∏—Ö –∫–Ω–∏–≥
        SELECT COUNT(*)
        INTO v_overdue_count
        FROM lendings l
        JOIN readers r ON l.reader_id = r.reader_id
        WHERE r.reader_id = (SELECT reader_id FROM lendings WHERE lending_id = p_lending_id)
            AND l.return_date IS NULL
            AND l.due_date < CURRENT_DATE;

        IF v_overdue_count > 0 THEN
            RETURN QUERY SELECT FALSE, '–£ —á–∏—Ç–∞—á–∞ —î –ø—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω—ñ –∫–Ω–∏–≥–∏'::TEXT, NULL::DATE;
            RETURN;
        END IF;

        -- –ü—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è —Ç–µ—Ä–º—ñ–Ω—É
        UPDATE lendings
        SET due_date = due_date + p_days
        WHERE lending_id = p_lending_id;

        RETURN QUERY SELECT TRUE, '–¢–µ—Ä–º—ñ–Ω –ø—Ä–æ–¥–æ–≤–∂–µ–Ω–æ'::TEXT, (v_current_due_date + p_days)::DATE;
    END;
    $$ LANGUAGE plpgsql;

    -- –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø—Ä–æ—Ü–µ–¥—É—Ä–∏
    SELECT * FROM extend_lending(1, 14);
    ```

    #### –ö—Ä–æ–∫ 4. –°–∏—Å—Ç–µ–º–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø—É

    –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ä–æ–ª—ñ –∑ —Ä—ñ–∑–Ω–∏–º–∏ –ø—Ä–∞–≤–∞–º–∏ –Ω–∞ –æ–ø–µ—Ä–∞—Ü—ñ—ó –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—ó.

    ```sql
    -- –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ä–æ–ª–µ–π
    CREATE ROLE librarian_read;
    CREATE ROLE librarian_write;
    CREATE ROLE library_admin;

    -- –ù–∞–¥–∞–Ω–Ω—è –ø—Ä–∞–≤ –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É
    GRANT SELECT ON ALL TABLES IN SCHEMA public TO librarian_read;

    -- –ù–∞–¥–∞–Ω–Ω—è –ø—Ä–∞–≤ –¥–ª—è –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
    GRANT SELECT, INSERT, UPDATE ON books, lendings, reservations TO librarian_write;
    GRANT DELETE ON reservations TO librarian_write;
    GRANT USAGE, SELECT ON ALL SEQUENCES IN SCHEMA public TO librarian_write;

    -- –ü–æ–≤–Ω—ñ –ø—Ä–∞–≤–∞ –¥–ª—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞
    GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO library_admin;
    GRANT ALL PRIVILEGES ON ALL SEQUENCES IN SCHEMA public TO library_admin;

    -- –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
    CREATE USER librarian1 WITH PASSWORD 'secure_password1';
    CREATE USER librarian2 WITH PASSWORD 'secure_password2';
    CREATE USER admin1 WITH PASSWORD 'admin_password';

    -- –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ä–æ–ª–µ–π
    GRANT librarian_read TO librarian1;
    GRANT librarian_write TO librarian2;
    GRANT library_admin TO admin1;

    -- –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø—É
    -- –í—ñ–¥ —ñ–º–µ–Ω—ñ librarian1 (—Ç—ñ–ª—å–∫–∏ —á–∏—Ç–∞–Ω–Ω—è)
    SET ROLE librarian1;
    SELECT * FROM books; -- –£—Å–ø—ñ—à–Ω–æ
    UPDATE books SET available_copies = 5 WHERE book_id = 1; -- –ü–æ–º–∏–ª–∫–∞

    -- –í—ñ–¥ —ñ–º–µ–Ω—ñ librarian2 (—á–∏—Ç–∞–Ω–Ω—è —Ç–∞ –∑–∞–ø–∏—Å)
    SET ROLE librarian2;
    UPDATE books SET available_copies = 5 WHERE book_id = 1; -- –£—Å–ø—ñ—à–Ω–æ
    DELETE FROM authors WHERE author_id = 1; -- –ü–æ–º–∏–ª–∫–∞

    RESET ROLE;
    ```

    #### –ö—Ä–æ–∫ 5. –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è

    –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –º–µ—Ö–∞–Ω—ñ–∑–º point-in-time recovery.

    ```sql
    -- –¢–∞–±–ª–∏—Ü—è –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–∏—Ö —Ç–æ—á–æ–∫
    CREATE TABLE backup_points (
        backup_id SERIAL PRIMARY KEY,
        backup_name VARCHAR(100) NOT NULL,
        backup_timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        description TEXT,
        data_snapshot JSONB
    );

    -- –§—É–Ω–∫—Ü—ñ—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ—ó —Ç–æ—á–∫–∏
    CREATE OR REPLACE FUNCTION create_backup_point(p_name VARCHAR, p_description TEXT DEFAULT NULL)
    RETURNS INTEGER AS $$
    DECLARE
        v_backup_id INTEGER;
        v_snapshot JSONB;
    BEGIN
        -- –°—Ç–≤–æ—Ä—é—î–º–æ –∑–Ω—ñ–º–æ–∫ –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö —Ç–∞–±–ª–∏—Ü—å
        SELECT jsonb_build_object(
            'books', (SELECT jsonb_agg(row_to_json(b)) FROM books b),
            'authors', (SELECT jsonb_agg(row_to_json(a)) FROM authors a),
            'readers', (SELECT jsonb_agg(row_to_json(r)) FROM readers r),
            'lendings', (SELECT jsonb_agg(row_to_json(l)) FROM lendings l)
        ) INTO v_snapshot;

        INSERT INTO backup_points (backup_name, description, data_snapshot)
        VALUES (p_name, p_description, v_snapshot)
        RETURNING backup_id INTO v_backup_id;

        RETURN v_backup_id;
    END;
    $$ LANGUAGE plpgsql;

    -- –§—É–Ω–∫—Ü—ñ—è –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –∑ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ—ó —Ç–æ—á–∫–∏
    CREATE OR REPLACE FUNCTION restore_from_backup(p_backup_id INTEGER)
    RETURNS BOOLEAN AS $$
    DECLARE
        v_snapshot JSONB;
        v_record JSONB;
    BEGIN
        -- –û—Ç—Ä–∏–º—É—î–º–æ –∑–Ω—ñ–º–æ–∫
        SELECT data_snapshot INTO v_snapshot
        FROM backup_points
        WHERE backup_id = p_backup_id;

        IF v_snapshot IS NULL THEN
            RAISE EXCEPTION 'Backup point not found';
        END IF;

        -- –í—ñ–¥–Ω–æ–≤–ª—é—î–º–æ –¥–∞–Ω—ñ (—Å–ø—Ä–æ—â–µ–Ω–∞ –≤–µ—Ä—Å—ñ—è –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—ó)
        BEGIN
            -- –û—á–∏—â—É—î–º–æ —ñ—Å–Ω—É—é—á—ñ –¥–∞–Ω—ñ
            TRUNCATE TABLE lendings CASCADE;
            TRUNCATE TABLE books CASCADE;
            TRUNCATE TABLE readers CASCADE;
            TRUNCATE TABLE authors CASCADE;

            -- –í—ñ–¥–Ω–æ–≤–ª—é—î–º–æ –∞–≤—Ç–æ—Ä—ñ–≤
            FOR v_record IN SELECT * FROM jsonb_array_elements(v_snapshot->'authors')
            LOOP
                INSERT INTO authors
                SELECT * FROM jsonb_populate_record(NULL::authors, v_record);
            END LOOP;

            -- –í—ñ–¥–Ω–æ–≤–ª—é—î–º–æ —ñ–Ω—à—ñ —Ç–∞–±–ª–∏—Ü—ñ –∞–Ω–∞–ª–æ–≥—ñ—á–Ω–æ

            RETURN TRUE;
        EXCEPTION WHEN OTHERS THEN
            RAISE EXCEPTION 'Restore failed: %', SQLERRM;
            RETURN FALSE;
        END;
    END;
    $$ LANGUAGE plpgsql;

    -- –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ—ó —Ç–æ—á–∫–∏
    SELECT create_backup_point('Before major update', 'Backup before system upgrade');
    ```

    #### –ö—Ä–æ–∫ 6. –Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–µ—Ä–µ–≥–ª—è–¥—É —ñ—Å—Ç–æ—Ä—ñ—ó

    –°—Ç–≤–æ—Ä–∏—Ç–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è –¥–ª—è –∑—Ä—É—á–Ω–æ–≥–æ –ø–µ—Ä–µ–≥–ª—è–¥—É —ñ—Å—Ç–æ—Ä—ñ—ó –∑–º—ñ–Ω.

    ```sql
    -- –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É —ñ—Å—Ç–æ—Ä—ñ—ó –∑–º—ñ–Ω –∫–Ω–∏–≥
    CREATE VIEW books_change_history AS
    SELECT
        a.log_id,
        a.operation,
        a.record_id as book_id,
        COALESCE(a.new_data->>'title', a.old_data->>'title') as title,
        CASE
            WHEN a.operation = 'INSERT' THEN '–î–æ–¥–∞–Ω–æ –Ω–æ–≤—É –∫–Ω–∏–≥—É'
            WHEN a.operation = 'UPDATE' THEN
                '–û–Ω–æ–≤–ª–µ–Ω–æ: ' ||
                CASE
                    WHEN a.old_data->>'available_copies' <> a.new_data->>'available_copies'
                    THEN '–î–æ—Å—Ç—É–ø–Ω—ñ –ø—Ä–∏–º—ñ—Ä–Ω–∏–∫–∏: ' || a.old_data->>'available_copies' || ' ‚Üí ' || a.new_data->>'available_copies'
                    ELSE '–Ü–Ω—à—ñ –ø–æ–ª—è'
                END
            WHEN a.operation = 'DELETE' THEN '–í–∏–¥–∞–ª–µ–Ω–æ –∫–Ω–∏–≥—É'
        END as change_description,
        a.changed_at,
        a.changed_by
    FROM audit_log a
    WHERE a.table_name = 'books'
    ORDER BY a.changed_at DESC;

    -- –§—É–Ω–∫—Ü—ñ—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó –∑–º—ñ–Ω –∑–∞ –ø–µ—Ä—ñ–æ–¥
    CREATE OR REPLACE FUNCTION get_changes_report(
        p_start_date TIMESTAMP,
        p_end_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP
    )
    RETURNS TABLE (
        change_date DATE,
        total_changes BIGINT,
        inserts BIGINT,
        updates BIGINT,
        deletes BIGINT
    ) AS $$
    BEGIN
        RETURN QUERY
        SELECT
            DATE(changed_at) as change_date,
            COUNT(*) as total_changes,
            COUNT(*) FILTER (WHERE operation = 'INSERT') as inserts,
            COUNT(*) FILTER (WHERE operation = 'UPDATE') as updates,
            COUNT(*) FILTER (WHERE operation = 'DELETE') as deletes
        FROM audit_log
        WHERE changed_at BETWEEN p_start_date AND p_end_date
        GROUP BY DATE(changed_at)
        ORDER BY change_date DESC;
    END;
    $$ LANGUAGE plpgsql;

    -- –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è
    SELECT * FROM get_changes_report(CURRENT_DATE - INTERVAL '30 days');
    ```
5. –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ñ–∞–π–ª `lab03-report.md` ([:fontawesome-solid-download: –ø—Ä–∏–∫–ª–∞–¥ –∑–≤—ñ—Ç—É](assets/lab03-report-example.download){: download="lab03-report.md"}). –î–æ–¥–∞—Ç–∏ –æ–ø–∏—Å –≤–∏–∫–æ–Ω–∞–Ω–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤ —Ç–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤. –í–∫–ª—é—á–∏—Ç–∏ —Å–∫—Ä—ñ–Ω—à–æ—Ç–∏.
6. –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∑–≤—ñ—Ç –∑—ñ —Å–∫—Ä—ñ–Ω—à–æ—Ç–∞–º–∏ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π –Ω–∞ GitHub.
7. –Ø–∫ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –Ω–∞ –∑–∞–≤–¥–∞–Ω–Ω—è –≤ LMS Moodle –≤—Å—Ç–∞–≤–∏—Ç–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π.
8. –ó–∞—Ö–∏—Å—Ç–∏—Ç–∏ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—É –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∞–¥–∞—á–µ–º.

## ‚ùì –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ñ –∑–∞–ø–∏—Ç–∞–Ω–Ω—è

1. –£ —á–æ–º—É –ø–æ–ª—è–≥–∞—î —Ä—ñ–∑–Ω–∏—Ü—è –º—ñ–∂ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º–∏ INSERT, UPDATE —Ç–∞ DELETE? –Ø–∫—ñ –æ–±–º–µ–∂–µ–Ω–Ω—è –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ –≤—Ä–∞—Ö–æ–≤—É–≤–∞—Ç–∏ –ø—Ä–∏ —ó—Ö –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ?
2. –ß–æ–º—É –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —É–º–æ–≤–∏ WHERE —î –∫—Ä–∏—Ç–∏—á–Ω–æ –≤–∞–∂–ª–∏–≤–∏–º –≤ –æ–ø–µ—Ä–∞—Ü—ñ—è—Ö UPDATE —Ç–∞ DELETE? –Ø–∫—ñ –Ω–∞—Å–ª—ñ–¥–∫–∏ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –≤—ñ–¥ —ó—ó –ø—Ä–æ–ø—É—Å–∫—É?
3. –©–æ —Ç–∞–∫–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è —Ç–∞ —è–∫—ñ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ ACID –≤–æ–Ω–∞ –∑–∞–±–µ–∑–ø–µ—á—É—î? –ü–æ—è—Å–Ω—ñ—Ç—å –∫–æ–∂–Ω—É –≤–ª–∞—Å—Ç–∏–≤—ñ—Å—Ç—å –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –ø—Ä–∏–∫–ª–∞–¥—ñ.
4. –Ø–∫–∞ —Ä—ñ–∑–Ω–∏—Ü—è –º—ñ–∂ –∫–æ–º–∞–Ω–¥–∞–º–∏ COMMIT —Ç–∞ ROLLBACK? –£ —è–∫–∏—Ö —Å–∏—Ç—É–∞—Ü—ñ—è—Ö –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –∫–æ–∂–Ω–∞ –∑ –Ω–∏—Ö?
5. –©–æ —Ç–∞–∫–µ —Ç–æ—á–∫–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è SAVEPOINT —ñ —è–∫ –≤–æ–Ω–∏ –¥–æ–∑–≤–æ–ª—è—é—Ç—å –∫–µ—Ä—É–≤–∞—Ç–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è–º–∏ –±—ñ–ª—å—à –≥–Ω—É—á–∫–æ –ø–æ—Ä—ñ–≤–Ω—è–Ω–æ –∑ –ø—Ä–æ—Å—Ç–∏–º ROLLBACK?
6. –Ø–∫—ñ —Ç–∏–ø–∏ –æ–±–º–µ–∂–µ–Ω—å —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ –≤–∏ –∑–Ω–∞—î—Ç–µ? –Ø–∫ –∫–æ–∂–µ–Ω –∑ –Ω–∏—Ö –¥–æ–ø–æ–º–∞–≥–∞—î –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –∫–æ—Ä–µ–∫—Ç–Ω—ñ—Å—Ç—å –¥–∞–Ω–∏—Ö —É –±–∞–∑—ñ?
7. –©–æ —Ç–∞–∫–µ –∫–∞—Å–∫–∞–¥–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó —Ç–∞ —è–∫—ñ –≤–∞—Ä—ñ–∞–Ω—Ç–∏ —ó—Ö –ø–æ–≤–µ–¥—ñ–Ω–∫–∏ —ñ—Å–Ω—É—é—Ç—å –ø—Ä–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ –∞–±–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—ñ –±–∞—Ç—å–∫—ñ–≤—Å—å–∫–∏—Ö –∑–∞–ø–∏—Å—ñ–≤?
8. –Ø–∫—É —Ä–æ–ª—å –≤—ñ–¥—ñ–≥—Ä–∞—é—Ç—å —Ç—Ä–∏–≥–µ—Ä–∏ –≤ –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—ñ —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ –¥–∞–Ω–∏—Ö —Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—ó –æ–ø–µ—Ä–∞—Ü—ñ–π? –ù–∞–≤–µ–¥—ñ—Ç—å –ø—Ä–∏–∫–ª–∞–¥–∏ —ó—Ö –ø—Ä–∞–∫—Ç–∏—á–Ω–æ–≥–æ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è.
9. –ß–æ–º—É –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è –∑–∞–ø–∏—Å—ñ–≤ –ø—Ä–∏ –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ–º—É –¥–æ—Å—Ç—É–ø—ñ? –Ø–∫—ñ –ø—Ä–æ–±–ª–µ–º–∏ –º–æ–∂—É—Ç—å –≤–∏–Ω–∏–∫–Ω—É—Ç–∏ –±–µ–∑ –Ω–∏—Ö?
10. –Ø–∫ —Ä—ñ–≤–Ω—ñ —ñ–∑–æ–ª—è—Ü—ñ—ó —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π –≤–ø–ª–∏–≤–∞—é—Ç—å –Ω–∞ –º–æ–∂–ª–∏–≤—ñ –∞–Ω–æ–º–∞–ª—ñ—ó –ø—Ä–∏ –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ–º—É –≤–∏–∫–æ–Ω–∞–Ω–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ–π? –Ø–∫–∏–π —Ä—ñ–≤–µ–Ω—å —Å–ª—ñ–¥ –æ–±–∏—Ä–∞—Ç–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤?
