# –ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü—ñ—è 12. MongoDB: –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ —Ç–∞ –º–æ–¥–µ–ª—å –¥–∞–Ω–∏—Ö

## –ü–ª–∞–Ω –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü—ñ—ó

1. –í—Å—Ç—É–ø –¥–æ MongoDB
2. –î–æ–∫—É–º–µ–Ω—Ç–æ-–æ—Ä—ñ—î–Ω—Ç–æ–≤–∞–Ω–∞ –º–æ–¥–µ–ª—å –¥–∞–Ω–∏—Ö
3. –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ MongoDB
4. –ú–æ–≤–∞ –∑–∞–ø–∏—Ç—ñ–≤ MongoDB
5. Aggregation Pipeline
6. –¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π–Ω–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞

---

## **üí° –©–æ —Ç–∞–∫–µ MongoDB?**

**MongoDB** - –ø—Ä–æ–≤—ñ–¥–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ-–æ—Ä—ñ—î–Ω—Ç–æ–≤–∞–Ω–∞ NoSQL –°–£–ë–î

### üéØ **–ö–ª—é—á–æ–≤—ñ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**

- üìÑ –î–æ–∫—É–º–µ–Ω—Ç–∏ —É —Ñ–æ—Ä–º–∞—Ç—ñ BSON (Binary JSON)
- üîÑ –ì–Ω—É—á–∫–∞ —Å—Ö–µ–º–∞ –¥–∞–Ω–∏—Ö
- ‚ö° –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–µ –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è
- üåç –†–æ–∑–ø–æ–¥—ñ–ª–µ–Ω–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞
- üìä –ü–æ—Ç—É–∂–Ω—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –∞–≥—Ä–µ–≥–∞—Ü—ñ—ó

### üèÜ **–î–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è:**

- –í–µ–±–¥–æ–¥–∞—Ç–∫–∏ –∑ –¥–∏–Ω–∞–º—ñ—á–Ω–∏–º –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º
- –°–∏—Å—Ç–µ–º–∏ –∫–µ—Ä—É–≤–∞–Ω–Ω—è –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º
- –ê–Ω–∞–ª—ñ—Ç–∏—á–Ω—ñ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∏
- IoT —Ç–∞ —Å–∏—Å—Ç–µ–º–∏ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —á–∞—Å—É
- –ú–æ–±—ñ–ª—å–Ω—ñ –¥–æ–¥–∞—Ç–∫–∏

---

## **1. –í—Å—Ç—É–ø –¥–æ MongoDB**

## –ï–≤–æ–ª—é—Ü—ñ—è –±–∞–∑ –¥–∞–Ω–∏—Ö

```mermaid
timeline
    title –†–æ–∑–≤–∏—Ç–æ–∫ –±–∞–∑ –¥–∞–Ω–∏—Ö
    1970 : –†–µ–ª—è—Ü—ñ–π–Ω—ñ –ë–î
         : SQL, ACID
    1990 : –û–±'—î–∫—Ç–Ω–æ-–æ—Ä—ñ—î–Ω—Ç–æ–≤–∞–Ω—ñ
         : –°–∫–ª–∞–¥–Ω—ñ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏
    2000 : NoSQL —Ä–µ–≤–æ–ª—é—Ü—ñ—è
         : –ú–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—ñ—Å—Ç—å
    2009 : MongoDB 1.0
         : –î–æ–∫—É–º–µ–Ω—Ç–∏, –ì–Ω—É—á–∫—ñ—Å—Ç—å
    2024 : MongoDB 7.x
         : –¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó, Cloud
```

### üìà **–ß–æ–º—É MongoDB?**

**–ü—Ä–æ–±–ª–µ–º–∏ —Ä–µ–ª—è—Ü—ñ–π–Ω–∏—Ö –ë–î:**
- –ñ–æ—Ä—Å—Ç–∫—ñ —Å—Ö–µ–º–∏
- –°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è
- Object-relational impedance mismatch
- –ü–æ–≤—ñ–ª—å–Ω—ñ JOIN –æ–ø–µ—Ä–∞—Ü—ñ—ó

**–†—ñ—à–µ–Ω–Ω—è MongoDB:**
- –ì–Ω—É—á–∫—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∏
- –í–±—É–¥–æ–≤–∞–Ω—ñ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏
- –ü—Ä–∏—Ä–æ–¥–Ω–µ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –æ–±'—î–∫—Ç—ñ–≤
- –®–≤–∏–¥–∫–∏–π –¥–æ—Å—Ç—É–ø –±–µ–∑ JOIN

---

## –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –º–æ–¥–µ–ª–µ–π –¥–∞–Ω–∏—Ö

### üìä **–†–µ–ª—è—Ü—ñ–π–Ω–∞ –º–æ–¥–µ–ª—å:**

```sql
-- –¢—Ä–∏ —Ç–∞–±–ª–∏—Ü—ñ –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–∞
CREATE TABLE students (
    student_id INT PRIMARY KEY,
    name VARCHAR(100),
    email VARCHAR(100)
);

CREATE TABLE addresses (
    address_id INT PRIMARY KEY,
    student_id INT,
    street VARCHAR(200),
    city VARCHAR(100)
);

CREATE TABLE courses (
    enrollment_id INT PRIMARY KEY,
    student_id INT,
    course_name VARCHAR(100)
);
```

### üìÑ **–î–æ–∫—É–º–µ–Ω—Ç–æ-–æ—Ä—ñ—î–Ω—Ç–æ–≤–∞–Ω–∞ –º–æ–¥–µ–ª—å:**

```javascript
// –û–¥–∏–Ω –¥–æ–∫—É–º–µ–Ω—Ç –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–∞
{
    "_id": ObjectId("..."),
    "student_id": "S2024001",
    "name": "–Ü–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤",
    "email": "ivan@university.edu.ua",
    "address": {
        "street": "–≤—É–ª. –•—Ä–µ—â–∞—Ç–∏–∫, 15",
        "city": "–ö–∏—ó–≤"
    },
    "courses": [
        { "name": "–ë–∞–∑–∏ –¥–∞–Ω–∏—Ö", "credits": 6 },
        { "name": "–ê–ª–≥–æ—Ä–∏—Ç–º–∏", "credits": 5 }
    ]
}
```

---

## **2. –î–æ–∫—É–º–µ–Ω—Ç–æ-–æ—Ä—ñ—î–Ω—Ç–æ–≤–∞–Ω–∞ –º–æ–¥–µ–ª—å**

## –§–æ—Ä–º–∞—Ç BSON

### üî¢ **Binary JSON - –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∏–π –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è**

```mermaid
graph LR
    A[JSON Document] --> B[BSON Encoder]
    B --> C[Binary Format]
    C --> D[MongoDB Storage]

    E[MongoDB Query] --> F[BSON Decoder]
    D --> F
    F --> G[JSON Result]
```

**–ü–µ—Ä–µ–≤–∞–≥–∏ BSON:**
- –®–≤–∏–¥—à–∞ –æ–±—Ä–æ–±–∫–∞
- –î–æ–¥–∞—Ç–∫–æ–≤—ñ —Ç–∏–ø–∏ –¥–∞–Ω–∏—Ö
- –ï—Ñ–µ–∫—Ç–∏–≤–Ω–µ –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è
- –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ –±—ñ–Ω–∞—Ä–Ω–∏—Ö –¥–∞–Ω–∏—Ö

---

## –¢–∏–ø–∏ –¥–∞–Ω–∏—Ö BSON

### üì¶ **–†–æ–∑—à–∏—Ä–µ–Ω–∏–π –Ω–∞–±—ñ—Ä —Ç–∏–ø—ñ–≤:**

```javascript
{
    // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ —Ç–∏–ø–∏
    "string": "—Ç–µ–∫—Å—Ç",
    "number": 42,
    "boolean": true,
    "null": null,

    // –°–ø–µ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ —Ç–∏–ø–∏ BSON
    "_id": ObjectId("507f1f77bcf86cd799439011"),
    "date": ISODate("2024-10-17T14:30:00Z"),
    "int32": NumberInt(100),
    "int64": NumberLong(9223372036854775807),
    "decimal": NumberDecimal("123.45"),
    "binary": BinData(0, "base64data=="),
    "timestamp": Timestamp(1634567890, 1),

    // –°–∫–ª–∞–¥–Ω—ñ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏
    "array": [1, 2, 3],
    "object": { "nested": "value" },
    "regex": /pattern/i
}
```

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞

### üóÇÔ∏è **–ì–Ω—É—á–∫–∞ –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö:**

```javascript
// –ü—Ä–∏–∫–ª–∞–¥ –±–∞–≥–∞—Ç–æ—Ä—ñ–≤–Ω–µ–≤–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞
{
    "_id": ObjectId("507f1f77bcf86cd799439011"),
    "student_id": "S2024001",

    // –í–∫–ª–∞–¥–µ–Ω—ñ –æ–±'—î–∫—Ç–∏
    "personal_info": {
        "first_name": "–Ü–≤–∞–Ω",
        "last_name": "–ü–µ—Ç—Ä–æ–≤",
        "birth_date": ISODate("2004-05-15")
    },

    // –ú–∞—Å–∏–≤–∏ –ø—Ä–∏–º—ñ—Ç–∏–≤—ñ–≤
    "skills": ["Python", "Java", "SQL"],

    // –ú–∞—Å–∏–≤–∏ –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤
    "courses": [
        {
            "course_id": "CS101",
            "name": "–ë–∞–∑–∏ –¥–∞–Ω–∏—Ö",
            "grade": "A",
            "credits": 6
        }
    ],

    // –ó–º—ñ—à–∞–Ω—ñ —Ç–∏–ø–∏
    "metadata": {
        "created_at": ISODate("2024-09-01"),
        "tags": ["active", "scholarship"],
        "gpa": NumberDecimal("3.85")
    }
}
```

---

## –ö–æ–ª–µ–∫—Ü—ñ—ó —Ç–∞ —Å—Ö–µ–º–∏

### üìö **–û—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—è –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤:**

```mermaid
graph TB
    A[–ë–∞–∑–∞ –¥–∞–Ω–∏—Ö: university] --> B[–ö–æ–ª–µ–∫—Ü—ñ—è: students]
    A --> C[–ö–æ–ª–µ–∫—Ü—ñ—è: courses]
    A --> D[–ö–æ–ª–µ–∫—Ü—ñ—è: enrollments]

    B --> B1[–î–æ–∫—É–º–µ–Ω—Ç 1]
    B --> B2[–î–æ–∫—É–º–µ–Ω—Ç 2]
    B --> B3[–î–æ–∫—É–º–µ–Ω—Ç N]

    C --> C1[–î–æ–∫—É–º–µ–Ω—Ç 1]
    C --> C2[–î–æ–∫—É–º–µ–Ω—Ç 2]
```

**–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:**
- –ö–æ–ª–µ–∫—Ü—ñ—è = –∞–Ω–∞–ª–æ–≥ —Ç–∞–±–ª–∏—Ü—ñ
- –î–æ–∫—É–º–µ–Ω—Ç–∏ –º–æ–∂—É—Ç—å –º–∞—Ç–∏ —Ä—ñ–∑–Ω—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É
- –î–∏–Ω–∞–º—ñ—á–Ω–∞ —Å—Ö–µ–º–∞ (schema-less)
- –û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è —Å—Ö–µ–º–∏

---

## –í–∞–ª—ñ–¥–∞—Ü—ñ—è —Å—Ö–µ–º–∏

### ‚úÖ **–ö–æ–Ω—Ç—Ä–æ–ª—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –¥–∞–Ω–∏—Ö:**

```javascript
db.createCollection("students", {
    validator: {
        $jsonSchema: {
            bsonType: "object",
            required: ["student_id", "name", "email"],
            properties: {
                student_id: {
                    bsonType: "string",
                    pattern: "^S[0-9]{7}$"
                },
                name: {
                    bsonType: "string",
                    minLength: 1,
                    maxLength: 100
                },
                email: {
                    bsonType: "string",
                    pattern: "^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$"
                },
                gpa: {
                    bsonType: "decimal",
                    minimum: 0.0,
                    maximum: 4.0
                }
            }
        }
    },
    validationLevel: "moderate",
    validationAction: "error"
})
```

---

## **3. –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ MongoDB**

## –ë–∞–∑–æ–≤—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏

```mermaid
graph TB
    A[–ö–ª—ñ—î–Ω—Ç] --> B[mongos Router]
    B --> C[Config Servers]
    B --> D[Shard 1<br/>Replica Set]
    B --> E[Shard 2<br/>Replica Set]
    B --> F[Shard 3<br/>Replica Set]

    D --> D1[Primary]
    D --> D2[Secondary 1]
    D --> D3[Secondary 2]

    E --> E1[Primary]
    E --> E2[Secondary 1]

    F --> F1[Primary]
    F --> F2[Secondary 1]
    F --> F3[Secondary 2]
```

**–ö–ª—é—á–æ–≤—ñ –µ–ª–µ–º–µ–Ω—Ç–∏:**
- üñ•Ô∏è **mongod** - —Å–µ—Ä–≤–µ—Ä –ë–î
- üîÄ **mongos** - –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä –∑–∞–ø–∏—Ç—ñ–≤
- ‚öôÔ∏è **Config Servers** - –º–µ—Ç–∞–¥–∞–Ω—ñ –∫–ª–∞—Å—Ç–µ—Ä–∞
- üîÑ **Replica Set** - –Ω–∞–±—ñ—Ä —Ä–µ–ø–ª—ñ–∫
- üì¶ **Shard** - —á–∞—Å—Ç–∏–Ω–∞ –¥–∞–Ω–∏—Ö

---

## –†–µ–ø–ª—ñ–∫–∞—Ü—ñ—è

### üîÑ **–ó–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –≤–∏—Å–æ–∫–æ—ó –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—ñ:**

```mermaid
graph LR
    A[Client] --> B[Primary]
    B -.Replication.-> C[Secondary 1]
    B -.Replication.-> D[Secondary 2]
    B -.Replication.-> E[Arbiter]

    C -.Heartbeat.-> B
    D -.Heartbeat.-> B
    E -.Voting.-> B
```

**–¢–∏–ø–∏ –≤—É–∑–ª—ñ–≤:**
- **Primary** - –ø—Ä–∏–π–º–∞—î –∑–∞–ø–∏—Å–∏
- **Secondary** - –∫–æ–ø—ñ—é—î –¥–∞–Ω—ñ
- **Arbiter** - –±–µ—Ä–µ —É—á–∞—Å—Ç—å —É –≤–∏–±–æ—Ä–∞—Ö

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è:**
- Heartbeat –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ (–∫–æ–∂–Ω—ñ 2 —Å–µ–∫)
- –í–∏–±–æ—Ä–∏ –Ω–æ–≤–æ–≥–æ Primary (~12 —Å–µ–∫)
- –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö

---

## –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Replica Set

```javascript
// –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –Ω–∞–±–æ—Ä—É —Ä–µ–ø–ª—ñ–∫
rs.initiate({
    _id: "rs0",
    members: [
        {
            _id: 0,
            host: "mongodb1.example.com:27017",
            priority: 2  // –í–∏—â–∏–π –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç –¥–ª—è Primary
        },
        {
            _id: 1,
            host: "mongodb2.example.com:27017",
            priority: 1
        },
        {
            _id: 2,
            host: "mongodb3.example.com:27017",
            priority: 1
        }
    ]
})

// –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å—É
rs.status()

// –î–æ–¥–∞–≤–∞–Ω–Ω—è –≤—É–∑–ª–∞
rs.add({
    host: "mongodb4.example.com:27017",
    priority: 0,    // –ù–µ –±—É–¥–µ Primary
    hidden: true,   // –ù–µ –≤–∏–¥–∏–º–∏–π –¥–ª—è –∫–ª—ñ—î–Ω—Ç—ñ–≤
    votes: 0        // –ù–µ –±–µ—Ä–µ —É—á–∞—Å—Ç—å —É –≤–∏–±–æ—Ä–∞—Ö
})
```

---

## Preferenc—ñ—ó —á–∏—Ç–∞–Ω–Ω—è

### üìñ **–ö–æ–Ω—Ç—Ä–æ–ª—å –¥–∂–µ—Ä–µ–ª–∞ –¥–∞–Ω–∏—Ö:**

```javascript
// Primary (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º) - –Ω–∞–π—Å–≤—ñ–∂—ñ—à—ñ –¥–∞–Ω—ñ
db.collection.find().readPref("primary")

// Secondary - —Ä–æ–∑–ø–æ–¥—ñ–ª –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
db.collection.find().readPref("secondary")

// PrimaryPreferred - Primary —è–∫—â–æ –¥–æ—Å—Ç—É–ø–Ω–∏–π
db.collection.find().readPref("primaryPreferred")

// SecondaryPreferred - Secondary —è–∫—â–æ –¥–æ—Å—Ç—É–ø–Ω–∏–π
db.collection.find().readPref("secondaryPreferred")

// Nearest - –Ω–∞–π–º–µ–Ω—à–∞ –∑–∞—Ç—Ä–∏–º–∫–∞
db.collection.find().readPref("nearest")
```

**–ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏:**
- `primary` - –∫—Ä–∏—Ç–∏—á–Ω–∞ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ñ—Å—Ç—å
- `secondary` - –∞–Ω–∞–ª—ñ—Ç–∏–∫–∞, –∑–≤—ñ—Ç–∏
- `nearest` - –Ω–∞–π–∫—Ä–∞—â–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å

---

## –®–∞—Ä–¥–∏–Ω–≥

### üìä **–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–µ –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è:**

```mermaid
graph TB
    A[mongos] --> B[Config Servers]
    A --> C[Shard 1<br/>students: A-K]
    A --> D[Shard 2<br/>students: L-R]
    A --> E[Shard 3<br/>students: S-Z]

    C --> C1[RS Primary]
    C --> C2[RS Secondary]

    D --> D1[RS Primary]
    D --> D2[RS Secondary]

    E --> E1[RS Primary]
    E --> E2[RS Secondary]
```

**–ö–ª—é—á —à–∞—Ä–¥–∏–Ω–≥—É –≤–∏–∑–Ω–∞—á–∞—î —Ä–æ–∑–ø–æ–¥—ñ–ª:**
- Hash-based - —Ä—ñ–≤–Ω–æ–º—ñ—Ä–Ω–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª
- Range-based - –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ø–æ—Ä—è–¥–∫—É
- Zone-based - –≥–µ–æ–≥—Ä–∞—Ñ—ñ—á–Ω–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª

---

## –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —à–∞—Ä–¥–∏–Ω–≥—É

```javascript
// –£–≤—ñ–º–∫–Ω–µ–Ω–Ω—è —à–∞—Ä–¥–∏–Ω–≥—É –¥–ª—è –ë–î
sh.enableSharding("university")

// –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —ñ–Ω–¥–µ–∫—Å—É –¥–ª—è –∫–ª—é—á–∞ —à–∞—Ä–¥–∏–Ω–≥—É
db.students.createIndex({ "student_id": "hashed" })

// –®–∞—Ä–¥–∏–Ω–≥ –∫–æ–ª–µ–∫—Ü—ñ—ó (hash-based)
sh.shardCollection(
    "university.students",
    { "student_id": "hashed" }
)

// –®–∞—Ä–¥–∏–Ω–≥ –∑–∞ –¥—ñ–∞–ø–∞–∑–æ–Ω–æ–º
sh.shardCollection(
    "university.courses",
    { "department": 1, "course_number": 1 }
)

// –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–æ–∑–ø–æ–¥—ñ–ª—É
db.students.getShardDistribution()

// –†–µ–∑—É–ª—å—Ç–∞—Ç:
// Shard shard0000: 33.3% (334 docs)
// Shard shard0001: 33.5% (335 docs)
// Shard shard0002: 33.2% (331 docs)
```

---

## –Ü–Ω–¥–µ–∫—Å—É–≤–∞–Ω–Ω—è

### üîç **–û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –ø–æ—à—É–∫—É:**

```javascript
// –û–¥–∏–Ω–∞—Ä–Ω–∏–π —ñ–Ω–¥–µ–∫—Å
db.students.createIndex({ "email": 1 })

// –£–Ω—ñ–∫–∞–ª—å–Ω–∏–π —ñ–Ω–¥–µ–∫—Å
db.students.createIndex(
    { "student_id": 1 },
    { unique: true }
)

// –°–∫–ª–∞–¥–µ–Ω–∏–π —ñ–Ω–¥–µ–∫—Å
db.students.createIndex({
    "academic_record.major": 1,
    "academic_record.current_year": 1
})

// –¢–µ–∫—Å—Ç–æ–≤–∏–π —ñ–Ω–¥–µ–∫—Å
db.courses.createIndex({
    "name": "text",
    "description": "text"
})

// –ì–µ–æ–ø—Ä–æ—Å—Ç–æ—Ä–æ–≤–∏–π —ñ–Ω–¥–µ–∫—Å
db.universities.createIndex({
    "location": "2dsphere"
})
```

---

## –¢–∏–ø–∏ —ñ–Ω–¥–µ–∫—Å—ñ–≤

| –¢–∏–ø | –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è | –ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è |
|-----|-------------|---------------------|
| **Single Field** | –û–¥–∏–Ω –∞—Ç—Ä–∏–±—É—Ç | –ü–æ—à—É–∫ –∑–∞ email |
| **Compound** | –ö—ñ–ª—å–∫–∞ –∞—Ç—Ä–∏–±—É—Ç—ñ–≤ | –°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è –∑–∞ –∫—ñ–ª—å–∫–æ–º–∞ –ø–æ–ª—è–º–∏ |
| **Text** | –ü–æ–≤–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–∏–π –ø–æ—à—É–∫ | –ü–æ—à—É–∫ —É –∫–æ–Ω—Ç–µ–Ω—Ç—ñ |
| **Geospatial** | –ì–µ–æ–≥—Ä–∞—Ñ—ñ—á–Ω—ñ –¥–∞–Ω—ñ | –ü–æ—à—É–∫ –∑–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ |
| **Hashed** | –†—ñ–≤–Ω–æ–º—ñ—Ä–Ω–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª | –ö–ª—é—á —à–∞—Ä–¥–∏–Ω–≥—É |
| **TTL** | –ê–≤—Ç–æ–≤–∏–¥–∞–ª–µ–Ω–Ω—è | –¢–∏–º—á–∞—Å–æ–≤—ñ –¥–∞–Ω—ñ |
| **Partial** | –ß–∞—Å—Ç–∫–æ–≤–µ —ñ–Ω–¥–µ–∫—Å—É–≤–∞–Ω–Ω—è | –¢—ñ–ª—å–∫–∏ –ø–µ–≤–Ω—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∏ |
| **Sparse** | –†–æ–∑—Ä—ñ–¥–∂–µ–Ω–∏–π | –¢—ñ–ª—å–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏ –∑ –ø–æ–ª–µ–º |

---

## **4. –ú–æ–≤–∞ –∑–∞–ø–∏—Ç—ñ–≤ MongoDB**

## CRUD –æ–ø–µ—Ä–∞—Ü—ñ—ó

### ‚úèÔ∏è **Create - –°—Ç–≤–æ—Ä–µ–Ω–Ω—è:**

```javascript
// –û–¥–∏–Ω –¥–æ–∫—É–º–µ–Ω—Ç
db.students.insertOne({
    student_id: "S2024001",
    name: "–Ü–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤",
    email: "ivan@example.com",
    enrollment_year: 2024
})

// –ö—ñ–ª—å–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤
db.students.insertMany([
    {
        student_id: "S2024002",
        name: "–ú–∞—Ä—ñ—è –ö–æ–≤–∞–ª–µ–Ω–∫–æ"
    },
    {
        student_id: "S2024003",
        name: "–û–ª–µ–∫—Å–∞–Ω–¥—Ä –°–∏–¥–æ—Ä–æ–≤"
    }
])
```

---

## Read –æ–ø–µ—Ä–∞—Ü—ñ—ó

### üìñ **–ß–∏—Ç–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö:**

```javascript
// –í—Å—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∏
db.students.find()

// –ó —Ñ—ñ–ª—å—Ç—Ä–æ–º
db.students.find({ enrollment_year: 2024 })

// –°–∫–ª–∞–¥–Ω—ñ —É–º–æ–≤–∏
db.students.find({
    enrollment_year: 2024,
    "academic_record.gpa": { $gte: 3.5 }
})

// –õ–æ–≥—ñ—á–Ω—ñ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∏
db.students.find({
    $or: [
        { "academic_record.major": "Computer Science" },
        { "academic_record.major": "Software Engineering" }
    ]
})

// –ü—Ä–æ–µ–∫—Ü—ñ—è –ø–æ–ª—ñ–≤ (SELECT specific fields)
db.students.find(
    { enrollment_year: 2024 },
    { name: 1, email: 1, _id: 0 }
)

// –°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ –ª—ñ–º—ñ—Ç
db.students.find()
    .sort({ "academic_record.gpa": -1 })
    .limit(10)
```

---

## Update –æ–ø–µ—Ä–∞—Ü—ñ—ó

### üîÑ **–û–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö:**

```javascript
// –û–¥–∏–Ω –¥–æ–∫—É–º–µ–Ω—Ç
db.students.updateOne(
    { student_id: "S2024001" },
    {
        $set: { "contact.phone": "+380501234567" },
        $inc: { "academic_record.current_year": 1 }
    }
)

// –ö—ñ–ª—å–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤
db.students.updateMany(
    { enrollment_year: 2024 },
    { $set: { status: "active" } }
)

// –î–æ–¥–∞–≤–∞–Ω–Ω—è –¥–æ –º–∞—Å–∏–≤—É
db.students.updateOne(
    { student_id: "S2024001" },
    {
        $push: {
            courses: {
                course_id: "CS301",
                name: "–ë–∞–∑–∏ –¥–∞–Ω–∏—Ö"
            }
        }
    }
)

// –í–∏–¥–∞–ª–µ–Ω–Ω—è –ø–æ–ª—è
db.students.updateOne(
    { student_id: "S2024001" },
    { $unset: { temporary_field: "" } }
)
```

---

## Delete –æ–ø–µ—Ä–∞—Ü—ñ—ó

### üóëÔ∏è **–í–∏–¥–∞–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö:**

```javascript
// –û–¥–∏–Ω –¥–æ–∫—É–º–µ–Ω—Ç
db.students.deleteOne({ student_id: "S2024001" })

// –ö—ñ–ª—å–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤
db.students.deleteMany({ status: "inactive" })

// –í—Å—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∏ –∫–æ–ª–µ–∫—Ü—ñ—ó
db.students.deleteMany({})
```

---

## –û–ø–µ—Ä–∞—Ç–æ—Ä–∏ –∑–∞–ø–∏—Ç—ñ–≤

### üéØ **–ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –∑ SQL:**

| SQL | MongoDB | –ü—Ä–∏–∫–ª–∞–¥ |
|-----|---------|---------|
| `=` | `$eq` | `{ age: { $eq: 18 } }` |
| `>` | `$gt` | `{ age: { $gt: 18 } }` |
| `>=` | `$gte` | `{ age: { $gte: 18 } }` |
| `<` | `$lt` | `{ age: { $lt: 25 } }` |
| `<=` | `$lte` | `{ age: { $lte: 25 } }` |
| `!=` | `$ne` | `{ status: { $ne: 'inactive' } }` |
| `IN` | `$in` | `{ major: { $in: ['CS', 'SE'] } }` |
| `NOT IN` | `$nin` | `{ major: { $nin: ['Math'] } }` |
| `LIKE` | `$regex` | `{ name: { $regex: /^–Ü–≤–∞–Ω/ } }` |
| `IS NULL` | `$exists: false` | `{ email: { $exists: false } }` |

---

## **5. Aggregation Pipeline**

## –ö–æ–Ω—Ü–µ–ø—Ü—ñ—è –∫–æ–Ω–≤–µ—î—Ä–∞

```mermaid
graph LR
    A[–ö–æ–ª–µ–∫—Ü—ñ—è<br/>1000 docs] --> B[$match<br/>Filter<br/>500 docs]
    B --> C[$group<br/>Group by<br/>50 groups]
    C --> D[$sort<br/>Sort<br/>50 sorted]
    D --> E[$limit<br/>Top 10<br/>10 results]
    E --> F[–†–µ–∑—É–ª—å—Ç–∞—Ç]
```

**–ü—Ä–∏–Ω—Ü–∏–ø —Ä–æ–±–æ—Ç–∏:**
- –ü–æ—Å–ª—ñ–¥–æ–≤–Ω–∞ –æ–±—Ä–æ–±–∫–∞
- –ö–æ–∂–µ–Ω –µ—Ç–∞–ø —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º—É—î –¥–∞–Ω—ñ
- –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ ‚Üí –≤—Ö—ñ–¥ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ
- –ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å —Å–∫–ª–∞–¥–Ω–∏—Ö —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü—ñ–π

---

## –û—Å–Ω–æ–≤–Ω—ñ –µ—Ç–∞–ø–∏ pipeline

### üîç **$match - –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è:**

```javascript
db.students.aggregate([
    {
        $match: {
            enrollment_year: { $gte: 2020 },
            "academic_record.gpa": { $gt: 3.0 },
            status: "active"
        }
    }
])
```

### üìä **$group - –ì—Ä—É–ø—É–≤–∞–Ω–Ω—è:**

```javascript
db.students.aggregate([
    {
        $group: {
            _id: "$academic_record.major",
            total_students: { $sum: 1 },
            avg_gpa: { $avg: "$academic_record.gpa" },
            max_gpa: { $max: "$academic_record.gpa" }
        }
    }
])
```

---

## –°–∫–ª–∞–¥–Ω–∏–π –ø—Ä–∏–∫–ª–∞–¥ pipeline

```javascript
db.students.aggregate([
    // –ï—Ç–∞–ø 1: –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –∞–∫—Ç–∏–≤–Ω–∏—Ö —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤
    {
        $match: {
            status: "active",
            enrollment_year: { $gte: 2020 }
        }
    },

    // –ï—Ç–∞–ø 2: –†–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è –º–∞—Å–∏–≤—É –∫—É—Ä—Å—ñ–≤
    { $unwind: "$courses" },

    // –ï—Ç–∞–ø 3: –ì—Ä—É–ø—É–≤–∞–Ω–Ω—è –∑–∞ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω—ñ—Å—Ç—é
    {
        $group: {
            _id: "$academic_record.major",
            total_students: { $addToSet: "$student_id" },
            avg_gpa: { $avg: "$academic_record.gpa" },
            total_courses: { $sum: 1 }
        }
    },

    // –ï—Ç–∞–ø 4: –û–±—á–∏—Å–ª–µ–Ω–Ω—è –∫—ñ–ª—å–∫–æ—Å—Ç—ñ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤
    {
        $project: {
            major: "$_id",
            students_count: { $size: "$total_students" },
            avg_gpa: { $round: ["$avg_gpa", 2] },
            avg_courses: {
                $round: [
                    { $divide: ["$total_courses", { $size: "$total_students" }] },
                    1
                ]
            }
        }
    },

    // –ï—Ç–∞–ø 5: –°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è
    { $sort: { avg_gpa: -1 } },

    // –ï—Ç–∞–ø 6: –¢–æ–ø-5
    { $limit: 5 }
])
```

---

## –ê–≥—Ä–µ–≥–∞—Ü—ñ–π–Ω—ñ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∏

### üìê **–ê—Ä–∏—Ñ–º–µ—Ç–∏—á–Ω—ñ:**

```javascript
{
    $project: {
        // –î–æ–¥–∞–≤–∞–Ω–Ω—è
        total: { $add: ["$price", "$tax"] },

        // –í—ñ–¥–Ω—ñ–º–∞–Ω–Ω—è
        profit: { $subtract: ["$revenue", "$cost"] },

        // –ú–Ω–æ–∂–µ–Ω–Ω—è
        total_price: { $multiply: ["$price", "$quantity"] },

        // –î—ñ–ª–µ–Ω–Ω—è
        avg_price: { $divide: ["$total", "$count"] },

        // –û–∫—Ä—É–≥–ª–µ–Ω–Ω—è
        rounded: { $round: ["$value", 2] }
    }
}
```

### üìù **–†—è–¥–∫–æ–≤—ñ:**

```javascript
{
    $project: {
        // –ö–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü—ñ—è
        full_name: {
            $concat: ["$first_name", " ", "$last_name"]
        },

        // –ü—ñ–¥—Ä—è–¥–æ–∫
        initials: { $substr: ["$name", 0, 1] },

        // –í–µ—Ä—Ö–Ω—ñ–π/–Ω–∏–∂–Ω—ñ–π —Ä–µ–≥—ñ—Å—Ç—Ä
        upper_name: { $toUpper: "$name" },
        lower_email: { $toLower: "$email" }
    }
}
```

---

## $lookup - JOIN –æ–ø–µ—Ä–∞—Ü—ñ—ó

### üîó **–û–±'—î–¥–Ω–∞–Ω–Ω—è –∫–æ–ª–µ–∫—Ü—ñ–π:**

```javascript
db.students.aggregate([
    // JOIN –∑ –∫–æ–ª–µ–∫—Ü—ñ—î—é courses
    {
        $lookup: {
            from: "courses",
            localField: "course_ids",
            foreignField: "course_id",
            as: "course_details"
        }
    },

    // –†–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
    { $unwind: "$course_details" },

    // –ü—Ä–æ–µ–∫—Ü—ñ—è –ø–æ—Ç—Ä—ñ–±–Ω–∏—Ö –ø–æ–ª—ñ–≤
    {
        $project: {
            student_name: "$name",
            course_name: "$course_details.name",
            credits: "$course_details.credits"
        }
    }
])
```

---

## **6. –¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π–Ω–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞**

## ACID —É MongoDB

### üîí **–í–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π:**

**A**tomicity - –ê—Ç–æ–º–∞—Ä–Ω—ñ—Å—Ç—å
- –í—Å—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –∞–±–æ –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è, –∞–±–æ –≤—ñ–¥–∫–æ—á—É—é—Ç—å—Å—è

**C**onsistency - –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ñ—Å—Ç—å
- –î–∞–Ω—ñ –∑–∞–ª–∏—à–∞—é—Ç—å—Å—è –≤ —É–∑–≥–æ–¥–∂–µ–Ω–æ–º—É —Å—Ç–∞–Ω—ñ

**I**solation - –Ü–∑–æ–ª—å–æ–≤–∞–Ω—ñ—Å—Ç—å
- –¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó –Ω–µ –≤–ø–ª–∏–≤–∞—é—Ç—å –æ–¥–Ω–∞ –Ω–∞ –æ–¥–Ω—É

**D**urability - –î–æ–≤–≥–æ–≤—ñ—á–Ω—ñ—Å—Ç—å
- –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω—ñ –∑–º—ñ–Ω–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è

---

## –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π

```javascript
const session = db.getMongo().startSession()

session.startTransaction()

try {
    const students = session.getDatabase("university").students
    const enrollments = session.getDatabase("university").enrollments

    // –û–ø–µ—Ä–∞—Ü—ñ—è 1: –ó–∞—Ä–∞—Ö—É–≤–∞–Ω–Ω—è –Ω–∞ –∫—É—Ä—Å
    enrollments.insertOne({
        student_id: "S2024001",
        course_id: "CS301",
        enrollment_date: new Date(),
        status: "active"
    }, { session })

    // –û–ø–µ—Ä–∞—Ü—ñ—è 2: –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—Ä–µ–¥–∏—Ç—ñ–≤
    students.updateOne(
        { student_id: "S2024001" },
        {
            $inc: { "academic_record.total_credits": 6 }
        },
        { session }
    )

    // –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è
    session.commitTransaction()

} catch (error) {
    // –í—ñ–¥–∫–∞—Ç –ø—Ä–∏ –ø–æ–º–∏–ª—Ü—ñ
    session.abortTransaction()
    throw error
} finally {
    session.endSession()
}
```

---

## –†—ñ–≤–Ω—ñ —ñ–∑–æ–ª—è—Ü—ñ—ó

### üìä **–ì–∞—Ä–∞–Ω—Ç—ñ—ó –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—ñ:**

```javascript
// Snapshot isolation (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º)
session.withTransaction(async () => {
    // –û–ø–µ—Ä–∞—Ü—ñ—ó –±–∞—á–∞—Ç—å –¥–∞–Ω—ñ –Ω–∞ –º–æ–º–µ–Ω—Ç –ø–æ—á–∞—Ç–∫—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó
    await collection.find({}).toArray()
}, {
    readConcern: { level: "snapshot" },
    writeConcern: { w: "majority" },
    readPreference: "primary"
})
```

**Read Concern —Ä—ñ–≤–Ω—ñ:**
- `local` - –ª–æ–∫–∞–ª—å–Ω—ñ –¥–∞–Ω—ñ
- `majority` - –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω—ñ –±—ñ–ª—å—à—ñ—Å—Ç—é
- `snapshot` - –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–∏–π –∑–Ω—ñ–º–æ–∫

**Write Concern:**
- `w: 1` - –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –≤—ñ–¥ primary
- `w: "majority"` - –≤—ñ–¥ –±—ñ–ª—å—à–æ—Å—Ç—ñ –≤—É–∑–ª—ñ–≤
- `w: 3` - –≤—ñ–¥ 3 –≤—É–∑–ª—ñ–≤

---

## –û–±–º–µ–∂–µ–Ω–Ω—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π

### ‚ö†Ô∏è **–í–∞–∂–ª–∏–≤–æ –∑–Ω–∞—Ç–∏:**

**–¢–∏–º—á–∞—Å–æ–≤—ñ –æ–±–º–µ–∂–µ–Ω–Ω—è:**
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∏–π —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è: 60 —Å–µ–∫—É–Ω–¥ (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º)
- –ú–æ–∂–Ω–∞ –∑–±—ñ–ª—å—à–∏—Ç–∏ –¥–æ 24 –≥–æ–¥–∏–Ω

**–û–ø–µ—Ä–∞—Ü—ñ–π–Ω—ñ –æ–±–º–µ–∂–µ–Ω–Ω—è:**
- –ù–µ –º–æ–∂–Ω–∞ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –∫–æ–ª–µ–∫—Ü—ñ—ó
- –ù–µ –º–æ–∂–Ω–∞ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ —ñ–Ω–¥–µ–∫—Å–∏
- –ú–∞–∫—Å–∏–º—É–º 1000 –æ–ø–µ—Ä–∞—Ü—ñ–π

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó:**
- ‚úÖ –ö–æ—Ä–æ—Ç–∫—ñ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó
- ‚úÖ –ú—ñ–Ω—ñ–º—É–º –æ–ø–µ—Ä–∞—Ü—ñ–π
- ‚úÖ –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –¥–∞–Ω–∏—Ö
- ‚ùå –£–Ω–∏–∫–∞—Ç–∏ –¥–æ–≤–≥–∏—Ö –æ–±—á–∏—Å–ª–µ–Ω—å
- ‚ùå –ù–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –¥–ª—è –±–∞—Ç—á—ñ–≤

---

## –ü—Ä–∞–∫—Ç–∏—á–Ω—ñ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó

### üí° **Best Practices:**

**–ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó:**
- –§—ñ–Ω–∞–Ω—Å–æ–≤—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó
- –ö—Ä–∏—Ç–∏—á–Ω—ñ –±—ñ–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å–∏
- –ë–∞–≥–∞—Ç–æ–¥–æ–∫—É–º–µ–Ω—Ç–Ω—ñ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è–º:**
- –í–±—É–¥–æ–≤—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö –≤ –æ–¥–∏–Ω –¥–æ–∫—É–º–µ–Ω—Ç
- –î–∏–∑–∞–π–Ω –±–µ–∑ –ø–æ—Ç—Ä–µ–±–∏ –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è—Ö
- Eventual consistency –¥–ª—è –Ω–µ–∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –¥–∞–Ω–∏—Ö

**–û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è:**
```javascript
// –î–æ–±—Ä–µ: —à–≤–∏–¥–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è
async function transfer(from, to, amount) {
    await session.withTransaction(async () => {
        await accounts.updateOne(
            { _id: from },
            { $inc: { balance: -amount } }
        )
        await accounts.updateOne(
            { _id: to },
            { $inc: { balance: amount } }
        )
    })
}
```

---

## –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è: SQL vs MongoDB

| –ê—Å–ø–µ–∫—Ç | SQL | MongoDB |
|--------|-----|---------|
| **–°—Ç—Ä—É–∫—Ç—É—Ä–∞** | –¢–∞–±–ª–∏—Ü—ñ, —Ä—è–¥–∫–∏ | –ö–æ–ª–µ–∫—Ü—ñ—ó, –¥–æ–∫—É–º–µ–Ω—Ç–∏ |
| **–°—Ö–µ–º–∞** | –ñ–æ—Ä—Å—Ç–∫–∞ | –ì–Ω—É—á–∫–∞ |
| **–ó–≤'—è–∑–∫–∏** | JOIN | –í–±—É–¥–æ–≤—É–≤–∞–Ω–Ω—è/$lookup |
| **–ú–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è** | –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–µ | –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–µ |
| **–¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó** | –ó–∞–≤–∂–¥–∏ | –û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ |
| **–ó–∞–ø–∏—Ç–∏** | SQL | JSON-–ø–æ–¥—ñ–±–Ω—ñ |
| **–Ü–Ω–¥–µ–∫—Å–∏** | B-tree | B-tree + —ñ–Ω—à—ñ |
| **–ê–≥—Ä–µ–≥–∞—Ü—ñ—è** | GROUP BY | Pipeline |

---

## –ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ MongoDB?

### ‚úÖ **–Ü–¥–µ–∞–ª—å–Ω–æ –ø—ñ–¥—Ö–æ–¥–∏—Ç—å:**

- üì± –í–µ–±–¥–æ–¥–∞—Ç–∫–∏ —Ç–∞ –º–æ–±—ñ–ª—å–Ω—ñ –¥–æ–¥–∞—Ç–∫–∏
- üìä –°–∏—Å—Ç–µ–º–∏ –∞–Ω–∞–ª—ñ—Ç–∏–∫–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ
- üìù –°–∏—Å—Ç–µ–º–∏ –∫–µ—Ä—É–≤–∞–Ω–Ω—è –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º
- üåê –ö–∞—Ç–∞–ª–æ–≥–∏ –ø—Ä–æ–¥—É–∫—Ç—ñ–≤
- üìç –ì–µ–æ–ø—Ä–æ—Å—Ç–æ—Ä–æ–≤—ñ –¥–æ–¥–∞—Ç–∫–∏
- üìà –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ç–∞ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥
- üîÑ –ü—Ä–æ—Ç–æ—Ç–∏–ø—É–≤–∞–Ω–Ω—è –∑ –º—ñ–Ω–ª–∏–≤–∏–º–∏ –≤–∏–º–æ–≥–∞–º–∏

### ‚ùå **–ú–µ–Ω—à –ø—ñ–¥—Ö–æ–¥–∏—Ç—å:**

- üí∞ –ë–∞–Ω–∫—ñ–≤—Å—å–∫—ñ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó (—Ç—Ä–∞–¥–∏—Ü—ñ–π–Ω–æ)
- üìä –°–∫–ª–∞–¥–Ω–∞ –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∞ –∑ –±–∞–≥–∞—Ç—å–º–∞ JOIN
- üîó –°–∏–ª—å–Ω–æ –ø–æ–≤'—è–∑–∞–Ω—ñ –¥–∞–Ω—ñ
- üìã –°–∏—Å—Ç–µ–º–∏ –∑ –∂–æ—Ä—Å—Ç–∫–∏–º–∏ —Å—Ö–µ–º–∞–º–∏

---

## –í–∏—Å–Ω–æ–≤–∫–∏

### üéØ **–ö–ª—é—á–æ–≤—ñ –ø–µ—Ä–µ–≤–∞–≥–∏ MongoDB:**

**–ì–Ω—É—á–∫—ñ—Å—Ç—å:**
- –î–∏–Ω–∞–º—ñ—á–Ω—ñ —Å—Ö–µ–º–∏
- –®–≤–∏–¥–∫–∞ –∞–¥–∞–ø—Ç–∞—Ü—ñ—è –¥–æ –∑–º—ñ–Ω
- –ü—Ä–∏—Ä–æ–¥–Ω–µ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –æ–±'—î–∫—Ç—ñ–≤

**–ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å:**
- –®–≤–∏–¥–∫–∏–π –¥–æ—Å—Ç—É–ø –±–µ–∑ JOIN
- –ï—Ñ–µ–∫—Ç–∏–≤–Ω–µ —ñ–Ω–¥–µ–∫—Å—É–≤–∞–Ω–Ω—è
- –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–µ –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è

**–ú–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—ñ—Å—Ç—å:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π —à–∞—Ä–¥–∏–Ω–≥
- –†–µ–ø–ª—ñ–∫–∞—Ü—ñ—è –¥–ª—è –≤–∏—Å–æ–∫–æ—ó –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—ñ
- –†–æ–∑–ø–æ–¥—ñ–ª–µ–Ω—ñ –æ–±—á–∏—Å–ª–µ–Ω–Ω—è

**–ó—Ä—É—á–Ω—ñ—Å—Ç—å:**
- –Ü–Ω—Ç—É—ó—Ç–∏–≤–Ω–∞ –º–æ–≤–∞ –∑–∞–ø–∏—Ç—ñ–≤
- –ë–∞–≥–∞—Ç–∏–π –Ω–∞–±—ñ—Ä –¥—Ä–∞–π–≤–µ—Ä—ñ–≤
- –ü–æ—Ç—É–∂–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ (Compass, Atlas)
