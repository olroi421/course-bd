# –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞ —Ä–æ–±–æ—Ç–∞ 5 –ö–µ—Ä—É–≤–∞–Ω–Ω—è –ë–î, –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ —Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—è

## üéØ –ú–µ—Ç–∞ —Ä–æ–±–æ—Ç–∏

–ù–∞–≤—á–∏—Ç–∏—Å—è –∞–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —Ç–∞ –æ–ø—Ç–∏–º—ñ–∑—É–≤–∞—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –±–∞–∑ –¥–∞–Ω–∏—Ö —á–µ—Ä–µ–∑ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —ñ–Ω–¥–µ–∫—Å—ñ–≤ —Ç–∞ –∞–Ω–∞–ª—ñ–∑ –ø–ª–∞–Ω—ñ–≤ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∑–∞–ø–∏—Ç—ñ–≤, –æ–ø–∞–Ω—É–≤–∞—Ç–∏ –º–µ—Ö–∞–Ω—ñ–∑–º–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—ó –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ç—Ä–∏–≥–µ—Ä—ñ–≤ —Ç–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—å, –æ—Å–≤–æ—ó—Ç–∏ –±–∞–∑–æ–≤—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä—É–≤–∞–Ω–Ω—è –°–£–ë–î, –≤–∫–ª—é—á–∞—é—á–∏ –∫–µ—Ä—É–≤–∞–Ω–Ω—è –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø—É —Ç–∞ —Ä–µ–∑–µ—Ä–≤–Ω–µ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è.

## ‚úÖ –ó–∞–≤–¥–∞–Ω–Ω—è

### –†—ñ–≤–µ–Ω—å 1

–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Å—Ç–≤–æ—Ä–µ–Ω—É –≤ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö —Ä–æ–±–æ—Ç–∞—Ö –±–∞–∑—É –¥–∞–Ω–∏—Ö:

1. –ü—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å —Ç—Ä—å–æ—Ö —Å–∫–ª–∞–¥–Ω–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∫–æ–º–∞–Ω–¥–∏ `EXPLAIN ANALYZE`.
2. –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ç—Ä–∏ —ñ–Ω–¥–µ–∫—Å–∏ –¥–ª—è –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó –Ω–∞–π–±—ñ–ª—å—à –ø–æ–≤—ñ–ª—å–Ω–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤ —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ.
3. –°—Ç–≤–æ—Ä–∏—Ç–∏ –¥–≤–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è (VIEW) –¥–ª—è —Å–ø—Ä–æ—â–µ–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É –¥–æ —á–∞—Å—Ç–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–Ω–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤.
4. –†–æ–∑—Ä–æ–±–∏—Ç–∏ —Ç—Ä–∏–≥–µ—Ä –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –ª–æ–≥—É–≤–∞–Ω–Ω—è –æ–ø–µ—Ä–∞—Ü—ñ–π –≤—Å—Ç–∞–≤–∫–∏ –∞–±–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –≤ –æ–¥–Ω—ñ–π –∑ —Ç–∞–±–ª–∏—Ü—å.
5. –°—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ –æ–±–º–µ–∂–µ–Ω–∏–º–∏ –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø—É –¥–æ –ø–µ–≤–Ω–∏—Ö —Ç–∞–±–ª–∏—Ü—å.

### –†—ñ–≤–µ–Ω—å 2

–î–æ–¥–∞—Ç–∫–æ–≤–æ –¥–æ —Ä—ñ–≤–Ω—è 1:

1. –°—Ç–≤–æ—Ä–∏—Ç–∏ —Å–∫–ª–∞–¥–Ω–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è –∑ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—é –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —á–µ—Ä–µ–∑ –ø—Ä–∞–≤–∏–ª–∞ (RULES).
2. –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —Ç—Ä–∏–≥–µ—Ä –¥–ª—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó –¥–∞–Ω–∏—Ö –ø–µ—Ä–µ–¥ –≤—Å—Ç–∞–≤–∫–æ—é –∑ –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è–º –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω–∏—Ö –∑–Ω–∞—á–µ–Ω—å.
3. –†–æ–∑—Ä–æ–±–∏—Ç–∏ —Å–∏—Å—Ç–µ–º—É –ª–æ–≥—É–≤–∞–Ω–Ω—è –∑–º—ñ–Ω –∑ –æ–∫—Ä–µ–º–æ—é —Ç–∞–±–ª–∏—Ü–µ—é audit_log, —è–∫–∞ –∑–±–µ—Ä—ñ–≥–∞—î:
    - —Ç–∏–ø –æ–ø–µ—Ä–∞—Ü—ñ—ó (INSERT, UPDATE, DELETE)
    - –Ω–∞–∑–≤—É —Ç–∞–±–ª–∏—Ü—ñ
    - —á–∞—Å–æ–≤—É –º—ñ—Ç–∫—É
    - –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, —è–∫–∏–π –≤–∏–∫–æ–Ω–∞–≤ –æ–ø–µ—Ä–∞—Ü—ñ—é
    - —Å—Ç–∞—Ä—ñ —Ç–∞ –Ω–æ–≤—ñ –∑–Ω–∞—á–µ–Ω–Ω—è (–¥–ª—è UPDATE)
4. –°—Ç–≤–æ—Ä–∏—Ç–∏ —á–∞—Å—Ç–∫–æ–≤—ñ —ñ–Ω–¥–µ–∫—Å–∏ –¥–ª—è –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó –∑–∞–ø–∏—Ç—ñ–≤ –∑ WHERE —É–º–æ–≤–∞–º–∏.
5. –í–∏–∫–æ–Ω–∞—Ç–∏ —Ä–µ–∑–µ—Ä–≤–Ω–µ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö –∫–æ–º–∞–Ω–¥–æ—é `pg_dump` —Ç–∞ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ—ó –∫–æ–ø—ñ—ó.

### –†—ñ–≤–µ–Ω—å 3

–î–æ–¥–∞—Ç–∫–æ–≤–æ –¥–æ —Ä—ñ–≤–Ω—è 2:

1. –°—Ç–≤–æ—Ä–∏—Ç–∏ –º–∞—Ç–µ—Ä—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è (MATERIALIZED VIEW) –∑ –∞–≥—Ä–µ–≥–æ–≤–∞–Ω–∏–º–∏ –¥–∞–Ω–∏–º–∏ —Ç–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –π–æ–≥–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —á–µ—Ä–µ–∑ —Ç—Ä–∏–≥–µ—Ä–∏.
2. –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –∫–∞—Å–∫–∞–¥–Ω—ñ —Ç—Ä–∏–≥–µ—Ä–∏ –¥–ª—è –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ —Å–∫–ª–∞–¥–Ω–æ—ó –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∏ –º—ñ–∂ —Ç–∞–±–ª–∏—Ü—è–º–∏.
3. –†–æ–∑—Ä–æ–±–∏—Ç–∏ —Å–∏—Å—Ç–µ–º—É —Ä–æ–ª–µ–π –∑ —ñ—î—Ä–∞—Ä—Ö—ñ—î—é –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø—É (–∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä, –º–æ–¥–µ—Ä–∞—Ç–æ—Ä, –∑–≤–∏—á–∞–π–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á).
4. –°—Ç–≤–æ—Ä–∏—Ç–∏ –∑–±–µ—Ä–µ–∂–µ–Ω—É –ø—Ä–æ—Ü–µ–¥—É—Ä—É –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–æ–≤–∞–Ω–æ—ó –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó –±–∞–∑–∏ –¥–∞–Ω–∏—Ö (–æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏, –ø–µ—Ä–µ–±—É–¥–æ–≤–∞ —ñ–Ω–¥–µ–∫—Å—ñ–≤).
5. –†–æ–∑—Ä–æ–±–∏—Ç–∏ —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–æ–≤–∞–Ω–æ–≥–æ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –∑ –≤–∏–≤–µ–¥–µ–Ω–Ω—è–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —ñ–Ω–¥–µ–∫—Å—ñ–≤ —Ç–∞ –Ω–∞–π–ø–æ–≤—ñ–ª—å–Ω—ñ—à–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤.


## üñ•Ô∏è –ü—Ä–æ–≥—Ä–∞–º–Ω–µ –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è

- [PostgreSQL](https://www.postgresql.org)

## üë• –§–æ—Ä–º–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ä–æ–±–æ—Ç–∏

–§–æ—Ä–º–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ä–æ–±–æ—Ç–∏ **—ñ–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω–∞**.

## üìù –ö—Ä–∏—Ç–µ—Ä—ñ—ó –æ—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è


### –†—ñ–≤–µ–Ω—å 1 - –û–±–æ–≤ º—è–∑–∫–æ–≤–∏–π –º—ñ–Ω—ñ–º—É–º

- –í–∏–∫–æ–Ω–∞–Ω–æ –∞–Ω–∞–ª—ñ–∑ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ —Ç—Ä—å–æ—Ö –∑–∞–ø–∏—Ç—ñ–≤ –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º EXPLAIN ANALYZE (8 –±–∞–ª—ñ–≤).
- –°—Ç–≤–æ—Ä–µ–Ω–æ —Ç—Ä–∏ –∫–æ—Ä–µ–∫—Ç–Ω–∏—Ö —ñ–Ω–¥–µ–∫—Å–∏ –∑ –ø–µ—Ä–µ–≤—ñ—Ä–∫–æ—é –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ (10 –±–∞–ª—ñ–≤).
- –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ –¥–≤–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è –¥–ª—è —Å–ø—Ä–æ—â–µ–Ω–Ω—è —Å–∫–ª–∞–¥–Ω–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤ (8 –±–∞–ª—ñ–≤).
- –°—Ç–≤–æ—Ä–µ–Ω–æ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω—É—é—á–∏–π —Ç—Ä–∏–≥–µ—Ä –¥–ª—è –ª–æ–≥—É–≤–∞–Ω–Ω—è –æ–ø–µ—Ä–∞—Ü—ñ–π (10 –±–∞–ª—ñ–≤).
- –ù–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±–º–µ–∂–µ–Ω–∏–º–∏ –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø—É (8 –±–∞–ª—ñ–≤).

**–ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π –ø–æ—Ä—ñ–≥ –¥–ª—è —Ä—ñ–≤–Ω—è 1: 35 –±–∞–ª—ñ–≤ (–æ—Ü—ñ–Ω–∫–∞ "–∑–∞–¥–æ–≤—ñ–ª—å–Ω–æ")**

### –†—ñ–≤–µ–Ω—å 2 - –î–æ–¥–∞—Ç–∫–æ–≤–∞ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å

–£—Å—ñ –∑–∞–≤–¥–∞–Ω–Ω—è —Ä—ñ–≤–Ω—è 1 –ø–ª—é—Å:

- –°—Ç–≤–æ—Ä–µ–Ω–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è –∑ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—é –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —á–µ—Ä–µ–∑ –ø—Ä–∞–≤–∏–ª–∞ (5 –±–∞–ª—ñ–≤).
- –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ —Ç—Ä–∏–≥–µ—Ä –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó –∑ –∫–æ—Ä–µ–∫—Ç–Ω–æ—é –æ–±—Ä–æ–±–∫–æ—é –ø–æ–º–∏–ª–æ–∫ (8 –±–∞–ª—ñ–≤).
- –†–æ–∑—Ä–æ–±–ª–µ–Ω–æ –ø–æ–≤–Ω–æ—Ü—ñ–Ω–Ω—É —Å–∏—Å—Ç–µ–º—É –ª–æ–≥—É–≤–∞–Ω–Ω—è –≤—Å—ñ—Ö —Ç–∏–ø—ñ–≤ –æ–ø–µ—Ä–∞—Ü—ñ–π (8 –±–∞–ª—ñ–≤).
- –°—Ç–≤–æ—Ä–µ–Ω–æ —á–∞—Å—Ç–∫–æ–≤—ñ —ñ–Ω–¥–µ–∫—Å–∏ –∑ –∞–Ω–∞–ª—ñ–∑–æ–º —ó—Ö –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ (4 –±–∞–ª–∏).
- –í–∏–∫–æ–Ω–∞–Ω–æ —Ä–µ–∑–µ—Ä–≤–Ω–µ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è —Ç–∞ —É—Å–ø—ñ—à–Ω–µ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö (5 –±–∞–ª—ñ–≤).

**–î—ñ–∞–ø–∞–∑–æ–Ω –¥–ª—è —Ä—ñ–≤–Ω—è 2: 50-74 –±–∞–ª–∏ (–æ—Ü—ñ–Ω–∫–∞ "–¥–æ–±—Ä–µ")**

### –†—ñ–≤–µ–Ω—å 3 - –¢–≤–æ—Ä—á–µ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è

–£—Å—ñ –∑–∞–≤–¥–∞–Ω–Ω—è —Ä—ñ–≤–Ω—è 2 –ø–ª—é—Å:

- –°—Ç–≤–æ—Ä–µ–Ω–æ –º–∞—Ç–µ—Ä—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è –∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–º –æ–Ω–æ–≤–ª–µ–Ω–Ω—è–º (6 –±–∞–ª—ñ–≤).
- –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ –∫–∞—Å–∫–∞–¥–Ω—ñ —Ç—Ä–∏–≥–µ—Ä–∏ –¥–ª—è —Å–∫–ª–∞–¥–Ω–æ—ó –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∏ (6 –±–∞–ª—ñ–≤).
- –†–æ–∑—Ä–æ–±–ª–µ–Ω–æ —ñ—î—Ä–∞—Ä—Ö—ñ—é —Ä–æ–ª–µ–π –∑ –¥–µ—Ç–∞–ª—å–Ω–æ—é —Å–∏—Å—Ç–µ–º–æ—é –ø—Ä–∞–≤ (6 –±–∞–ª—ñ–≤).
- –°—Ç–≤–æ—Ä–µ–Ω–æ –∑–±–µ—Ä–µ–∂–µ–Ω—É –ø—Ä–æ—Ü–µ–¥—É—Ä—É –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–æ–≤–∞–Ω–æ–≥–æ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è (4 –±–∞–ª–∏).
- –†–æ–∑—Ä–æ–±–ª–µ–Ω–æ —Å–∫—Ä–∏–ø—Ç–∏ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É –∑ –∞–Ω–∞–ª—ñ–∑–æ–º –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —ñ–Ω–¥–µ–∫—Å—ñ–≤ (4 –±–∞–ª–∏).

**–î—ñ–∞–ø–∞–∑–æ–Ω –¥–ª—è —Ä—ñ–≤–Ω—è 3: 75-100 –±–∞–ª—ñ–≤ (–æ—Ü—ñ–Ω–∫–∞ "–≤—ñ–¥–º—ñ–Ω–Ω–æ")**


## ‚è∞ –ü–æ–ª—ñ—Ç–∏–∫–∞ —â–æ–¥–æ –¥–µ–¥–ª–∞–π–Ω—ñ–≤

–ü—Ä–∏ –ø–æ—Ä—É—à–µ–Ω–Ω—ñ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ–≥–æ —Ç–µ—Ä–º—ñ–Ω—É –∑–¥–∞—á—ñ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ—ó —Ä–æ–±–æ—Ç–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –º–æ–∂–ª–∏–≤–∞ –æ—Ü—ñ–Ω–∫–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—å "–¥–æ–±—Ä–µ", –Ω–µ–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —è–∫–æ—Å—Ç—ñ –≤–∏–∫–æ–Ω–∞–Ω–æ—ó —Ä–æ–±–æ—Ç–∏. –í–∏–Ω—è—Ç–∫–∏ –º–æ–∂–ª–∏–≤—ñ –ª–∏—à–µ –∑–∞ –ø–æ–≤–∞–∂–Ω–∏—Ö –ø—Ä–∏—á–∏–Ω, –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–∞–ª—å–Ω–æ.

## üìö –¢–µ–æ—Ä–µ—Ç–∏—á–Ω—ñ –≤—ñ–¥–æ–º–æ—Å—Ç—ñ


### –ê–Ω–∞–ª—ñ–∑ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –∑–∞–ø–∏—Ç—ñ–≤

PostgreSQL –Ω–∞–¥–∞—î –ø–æ—Ç—É–∂–Ω–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ä—ñ–π –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∑–∞–ø–∏—Ç—ñ–≤ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É `EXPLAIN`, —è–∫–∞ –ø–æ–∫–∞–∑—É—î –ø–ª–∞–Ω –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∑–∞–ø–∏—Ç—É –±–µ–∑ –π–æ–≥–æ —Ñ–∞–∫—Ç–∏—á–Ω–æ–≥–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è, —Ç–∞ `EXPLAIN ANALYZE`, —è–∫–∞ –≤–∏–∫–æ–Ω—É—î –∑–∞–ø–∏—Ç —ñ –ø–æ–≤–µ—Ä—Ç–∞—î —Ä–µ–∞–ª—å–Ω–∏–π —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è.

–û—Å–Ω–æ–≤–Ω—ñ —Ç–∏–ø–∏ —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—å:

- **Sequential Scan** ‚Äî –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–µ —á–∏—Ç–∞–Ω–Ω—è –≤—Å—ñ—Ö —Ä—è–¥–∫—ñ–≤ —Ç–∞–±–ª–∏—Ü—ñ, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –∫–æ–ª–∏ –Ω–µ–º–∞—î –ø—ñ–¥—Ö–æ–¥—è—â–∏—Ö —ñ–Ω–¥–µ–∫—Å—ñ–≤ –∞–±–æ —Ç–∞–±–ª–∏—Ü—è –º–∞–ª–∞.
- **Index Scan** ‚Äî –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —ñ–Ω–¥–µ–∫—Å—É –¥–ª—è –≤–∏–±—ñ—Ä–∫–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏—Ö —Ä—è–¥–∫—ñ–≤, –µ—Ñ–µ–∫—Ç–∏–≤–Ω–µ –¥–ª—è –Ω–µ–≤–µ–ª–∏–∫–æ—ó –∫—ñ–ª—å–∫–æ—Å—Ç—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤.
- **Index Only Scan** ‚Äî –Ω–∞–π—à–≤–∏–¥—à–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç, –∫–æ–ª–∏ –≤—Å—ñ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ –º—ñ—Å—Ç—è—Ç—å—Å—è –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –≤ —ñ–Ω–¥–µ–∫—Å—ñ.
- **Bitmap Index Scan** ‚Äî –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –≤–µ–ª–∏–∫–æ—ó –∫—ñ–ª—å–∫–æ—Å—Ç—ñ —Ä—è–¥–∫—ñ–≤, —Å—Ç–≤–æ—Ä—é—î bitmap –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏—Ö —Å—Ç–æ—Ä—ñ–Ω–æ–∫.

–ö–ª—é—á–æ–≤—ñ –º–µ—Ç—Ä–∏–∫–∏ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö EXPLAIN:

- **cost** ‚Äî –æ—Ü—ñ–Ω–æ—á–Ω–∞ –≤–∞—Ä—Ç—ñ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü—ñ—ó (—Å—Ç–∞—Ä—Ç–æ–≤–∞ —Ç–∞ –∑–∞–≥–∞–ª—å–Ω–∞).
- **rows** ‚Äî –æ—á—ñ–∫—É–≤–∞–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Ä—è–¥–∫—ñ–≤.
- **width** ‚Äî —Å–µ—Ä–µ–¥–Ω—ñ–π —Ä–æ–∑–º—ñ—Ä —Ä—è–¥–∫–∞ –≤ –±–∞–π—Ç–∞—Ö.
- **actual time** ‚Äî —Ä–µ–∞–ª—å–Ω–∏–π —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è (—Ç—ñ–ª—å–∫–∏ –≤ EXPLAIN ANALYZE).

### –Ü–Ω–¥–µ–∫—Å–∞—Ü—ñ—è

–Ü–Ω–¥–µ–∫—Å —Ü–µ –¥–æ–ø–æ–º—ñ–∂–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–∏—Ö, —è–∫–∞ –ø—Ä–∏—Å–∫–æ—Ä—é—î –ø–æ—à—É–∫ –∑–∞–ø–∏—Å—ñ–≤ —É —Ç–∞–±–ª–∏—Ü—ñ. PostgreSQL –ø—ñ–¥—Ç—Ä–∏–º—É—î —Ä—ñ–∑–Ω—ñ —Ç–∏–ø–∏ —ñ–Ω–¥–µ–∫—Å—ñ–≤:

**B-tree —ñ–Ω–¥–µ–∫—Å–∏** ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π —Ç–∏–ø, –ø—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è –±—ñ–ª—å—à–æ—Å—Ç—ñ –≤–∏–ø–∞–¥–∫—ñ–≤, –µ—Ñ–µ–∫—Ç–∏–≤–Ω–∏–π –¥–ª—è –æ–ø–µ—Ä–∞—Ü—ñ–π –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è —Ç–∞ —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è.

```sql
CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_orders_date ON orders(order_date DESC);
```

**–ß–∞—Å—Ç–∫–æ–≤—ñ —ñ–Ω–¥–µ–∫—Å–∏** ‚Äî —ñ–Ω–¥–µ–∫—Å—É—é—Ç—å —Ç—ñ–ª—å–∫–∏ —Ç—ñ —Ä—è–¥–∫–∏, —â–æ –∑–∞–¥–æ–≤–æ–ª—å–Ω—è—é—Ç—å –ø–µ–≤–Ω—ñ–π —É–º–æ–≤—ñ, –µ–∫–æ–Ω–æ–º–ª—è—Ç—å –º—ñ—Å—Ü–µ —Ç–∞ –ø—Ä–∏—Å–∫–æ—Ä—é—é—Ç—å –∑–∞–ø–∏—Ç–∏ –∑ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–º–∏ WHERE —É–º–æ–≤–∞–º–∏.

```sql
CREATE INDEX idx_active_users ON users(username) WHERE status = 'active';
```

**–°–∫–ª–∞–¥–µ–Ω—ñ —ñ–Ω–¥–µ–∫—Å–∏** ‚Äî —ñ–Ω–¥–µ–∫—Å—É—é—Ç—å –∫—ñ–ª—å–∫–∞ —Å—Ç–æ–≤–ø—Ü—ñ–≤ –æ–¥–Ω–æ—á–∞—Å–Ω–æ, –ø–æ—Ä—è–¥–æ–∫ —Å—Ç–æ–≤–ø—Ü—ñ–≤ –≤–∞–∂–ª–∏–≤–∏–π.

```sql
CREATE INDEX idx_orders_user_date ON orders(user_id, order_date);
```

**–£–Ω—ñ–∫–∞–ª—å–Ω—ñ —ñ–Ω–¥–µ–∫—Å–∏** ‚Äî –≥–∞—Ä–∞–Ω—Ç—É—é—Ç—å —É–Ω—ñ–∫–∞–ª—å–Ω—ñ—Å—Ç—å –∑–Ω–∞—á–µ–Ω—å, –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å—Ç–≤–æ—Ä—é—é—Ç—å—Å—è –¥–ª—è PRIMARY KEY —Ç–∞ UNIQUE –æ–±–º–µ–∂–µ–Ω—å.

```sql
CREATE UNIQUE INDEX idx_users_email_unique ON users(email);
```

–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó —â–æ–¥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —ñ–Ω–¥–µ–∫—Å—ñ–≤:

- –°—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ —ñ–Ω–¥–µ–∫—Å–∏ –Ω–∞ —Å—Ç–æ–≤–ø—Ü—è—Ö, —â–æ —á–∞—Å—Ç–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –≤ WHERE, JOIN, ORDER BY.
- –£–Ω–∏–∫–∞—Ç–∏ –Ω–∞–¥–º—ñ—Ä–Ω–æ—ó —ñ–Ω–¥–µ–∫—Å–∞—Ü—ñ—ó, –æ—Å–∫—ñ–ª—å–∫–∏ –∫–æ–∂–µ–Ω —ñ–Ω–¥–µ–∫—Å —É–ø–æ–≤—ñ–ª—å–Ω—é—î –æ–ø–µ—Ä–∞—Ü—ñ—ó INSERT, UPDATE, DELETE.
- –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫–æ–º–∞–Ω–¥–æ—é `ANALYZE` –¥–ª—è –∫–æ—Ä–µ–∫—Ç–Ω–æ—ó —Ä–æ–±–æ—Ç–∏ –æ–ø—Ç–∏–º—ñ–∑–∞—Ç–æ—Ä–∞.
- –ü–µ—Ä—ñ–æ–¥–∏—á–Ω–æ –ø–µ—Ä–µ–±—É–¥–æ–≤—É–≤–∞—Ç–∏ —ñ–Ω–¥–µ–∫—Å–∏ –∫–æ–º–∞–Ω–¥–æ—é `REINDEX` –¥–ª—è –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ —ó—Ö –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ.

### –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è (Views)

–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è —Ü–µ –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–∞ —Ç–∞–±–ª–∏—Ü—è, –≤–∏–∑–Ω–∞—á–µ–Ω–∞ SQL –∑–∞–ø–∏—Ç–æ–º. –í–æ–Ω–∏ –Ω–µ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å –¥–∞–Ω—ñ —Ñ—ñ–∑–∏—á–Ω–æ, –∞ –≤–∏–∫–æ–Ω—É—é—Ç—å –∑–∞–ø–∏—Ç –∫–æ–∂–Ω–æ–≥–æ —Ä–∞–∑—É –ø—Ä–∏ –∑–≤–µ—Ä–Ω–µ–Ω–Ω—ñ.

**–ü–µ—Ä–µ–≤–∞–≥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—å:**

- –°–ø—Ä–æ—â–µ–Ω–Ω—è —Å–∫–ª–∞–¥–Ω–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤ —á–µ—Ä–µ–∑ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —ó—Ö —è–∫ —ñ–º–µ–Ω–æ–≤–∞–Ω–∏—Ö –æ–±'—î–∫—Ç—ñ–≤.
- –ó–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –±–µ–∑–ø–µ–∫–∏ —á–µ—Ä–µ–∑ –æ–±–º–µ–∂–µ–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É –¥–æ –ø–µ–≤–Ω–∏—Ö —Å—Ç–æ–≤–ø—Ü—ñ–≤ –∞–±–æ —Ä—è–¥–∫—ñ–≤.
- –õ–æ–≥—ñ—á–Ω–∞ –Ω–µ–∑–∞–ª–µ–∂–Ω—ñ—Å—Ç—å –¥–∞–Ω–∏—Ö –≤—ñ–¥ —Ñ—ñ–∑–∏—á–Ω–æ—ó —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ —Ç–∞–±–ª–∏—Ü—å.
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü—ñ—è –¥–æ—Å—Ç—É–ø—É –¥–æ –¥–∞–Ω–∏—Ö –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤.

```sql
CREATE VIEW active_users_with_orders AS
SELECT
    u.user_id,
    u.username,
    u.email,
    COUNT(o.order_id) as order_count,
    SUM(o.total_amount) as total_spent
FROM users u
LEFT JOIN orders o ON u.user_id = o.user_id
WHERE u.status = 'active'
GROUP BY u.user_id, u.username, u.email;
```

**–ú–∞—Ç–µ—Ä—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è** –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø–∏—Ç—É —Ñ—ñ–∑–∏—á–Ω–æ, —â–æ –∑–Ω–∞—á–Ω–æ –ø—Ä–∏—Å–∫–æ—Ä—é—î –¥–æ—Å—Ç—É–ø –¥–æ –∞–≥—Ä–µ–≥–æ–≤–∞–Ω–∏—Ö –¥–∞–Ω–∏—Ö, –∞–ª–µ –≤–∏–º–∞–≥–∞—î –ø–µ—Ä—ñ–æ–¥–∏—á–Ω–æ–≥–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è.

```sql
CREATE MATERIALIZED VIEW monthly_sales_summary AS
SELECT
    DATE_TRUNC('month', order_date) as month,
    COUNT(*) as total_orders,
    SUM(total_amount) as total_revenue
FROM orders
GROUP BY DATE_TRUNC('month', order_date);

-- –û–Ω–æ–≤–ª–µ–Ω–Ω—è –º–∞—Ç–µ—Ä—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è
REFRESH MATERIALIZED VIEW monthly_sales_summary;
```

### –¢—Ä–∏–≥–µ—Ä–∏

–¢—Ä–∏–≥–µ—Ä —Ü–µ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä–∞, —è–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –ø—Ä–∏ –Ω–∞—Å—Ç–∞–Ω–Ω—ñ –ø–µ–≤–Ω–æ—ó –ø–æ–¥—ñ—ó (INSERT, UPDATE, DELETE) –Ω–∞ —Ç–∞–±–ª–∏—Ü—ñ. –¢—Ä–∏–≥–µ—Ä–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –¥–ª—è:

- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –ª–æ–≥—É–≤–∞–Ω–Ω—è –∑–º—ñ–Ω —É –±–∞–∑—ñ –¥–∞–Ω–∏—Ö.
- –í–∞–ª—ñ–¥–∞—Ü—ñ—ó –¥–∞–Ω–∏—Ö –ø–µ—Ä–µ–¥ —ó—Ö –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è–º.
- –ü—ñ–¥—Ç—Ä–∏–º–∫–∏ —Å–∫–ª–∞–¥–Ω–æ—ó –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∏ —Ç–∞ –æ–±–º–µ–∂–µ–Ω—å —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ.
- –ö–∞—Å–∫–∞–¥–Ω–æ–≥–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∞–±–æ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö –∑–∞–ø–∏—Å—ñ–≤.
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –æ–±—á–∏—Å–ª—é–≤–∞–Ω–∏—Ö –ø–æ–ª—ñ–≤.

–¢—Ä–∏–≥–µ—Ä —Å–∫–ª–∞–¥–∞—î—Ç—å—Å—è –∑ –¥–≤–æ—Ö —á–∞—Å—Ç–∏–Ω: —Ñ—É–Ω–∫—Ü—ñ—ó —Ç—Ä–∏–≥–µ—Ä–∞ —Ç–∞ —Å–∞–º–æ–≥–æ —Ç—Ä–∏–≥–µ—Ä–∞.

```sql
-- –§—É–Ω–∫—Ü—ñ—è —Ç—Ä–∏–≥–µ—Ä–∞ –¥–ª—è –ª–æ–≥—É–≤–∞–Ω–Ω—è
CREATE OR REPLACE FUNCTION log_user_changes()
RETURNS TRIGGER AS $$
BEGIN
    IF TG_OP = 'INSERT' THEN
        INSERT INTO audit_log (table_name, operation, user_id, timestamp)
        VALUES ('users', 'INSERT', NEW.user_id, NOW());
    ELSIF TG_OP = 'UPDATE' THEN
        INSERT INTO audit_log (table_name, operation, user_id, old_values, new_values, timestamp)
        VALUES ('users', 'UPDATE', NEW.user_id, row_to_json(OLD), row_to_json(NEW), NOW());
    END IF;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç—Ä–∏–≥–µ—Ä–∞
CREATE TRIGGER trg_user_changes
AFTER INSERT OR UPDATE ON users
FOR EACH ROW
EXECUTE FUNCTION log_user_changes();
```

–¢–∏–ø–∏ —Ç—Ä–∏–≥–µ—Ä—ñ–≤ –∑–∞ —á–∞—Å–æ–º –≤–∏–∫–æ–Ω–∞–Ω–Ω—è:

- **BEFORE** ‚Äî –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –ø–µ—Ä–µ–¥ –æ–ø–µ—Ä–∞—Ü—ñ—î—é, –º–æ–∂–µ –∑–º—ñ–Ω–∏—Ç–∏ –∞–±–æ –≤—ñ–¥—Ö–∏–ª–∏—Ç–∏ –¥–∞–Ω—ñ.
- **AFTER** ‚Äî –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –ø—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –æ–ø–µ—Ä–∞—Ü—ñ—ó.
- **INSTEAD OF** ‚Äî –∑–∞–º—ñ–Ω—é—î —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É –æ–ø–µ—Ä–∞—Ü—ñ—é, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—å.

–†—ñ–≤–Ω—ñ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ç—Ä–∏–≥–µ—Ä—ñ–≤:

- **FOR EACH ROW** ‚Äî –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ —Ä—è–¥–∫–∞, —â–æ –∑–º—ñ–Ω—é—î—Ç—å—Å—è.
- **FOR EACH STATEMENT** ‚Äî –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –¥–ª—è –≤—Å—ñ—î—ó –æ–ø–µ—Ä–∞—Ü—ñ—ó.

### –ö–µ—Ä—É–≤–∞–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏ —Ç–∞ –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø—É

PostgreSQL –º–∞—î —Ä–æ–∑–≤–∏–Ω–µ–Ω—É —Å–∏—Å—Ç–µ–º—É –∫–µ—Ä—É–≤–∞–Ω–Ω—è –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø—É –Ω–∞ —Ä—ñ–≤–Ω—ñ –±–∞–∑ –¥–∞–Ω–∏—Ö, —Å—Ö–µ–º, —Ç–∞–±–ª–∏—Ü—å —Ç–∞ –Ω–∞–≤—ñ—Ç—å —Å—Ç–æ–≤–ø—Ü—ñ–≤.

–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞:

```sql
CREATE USER analyst WITH PASSWORD 'secure_password';
CREATE USER developer WITH PASSWORD 'dev_pass' CREATEDB;
```

–ù–∞–¥–∞–Ω–Ω—è –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø—É:

```sql
-- –ü—Ä–∞–≤–æ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
GRANT CONNECT ON DATABASE company_db TO analyst;

-- –ü—Ä–∞–≤–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Å—Ö–µ–º–∏
GRANT USAGE ON SCHEMA public TO analyst;

-- –ü—Ä–∞–≤–∞ –Ω–∞ —Ç–∞–±–ª–∏—Ü—ñ
GRANT SELECT ON ALL TABLES IN SCHEMA public TO analyst;
GRANT SELECT, INSERT, UPDATE ON users TO developer;
GRANT SELECT ON specific_column OF sensitive_table TO analyst;

-- –ü—Ä–∞–≤–∞ –Ω–∞ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ—Å—Ç—ñ (–¥–ª—è AUTO INCREMENT)
GRANT USAGE ON ALL SEQUENCES IN SCHEMA public TO developer;
```

–í—ñ–¥–∫–ª–∏–∫–∞–Ω–Ω—è –ø—Ä–∞–≤:

```sql
REVOKE INSERT, UPDATE ON users FROM analyst;
REVOKE ALL PRIVILEGES ON DATABASE company_db FROM developer;
```

–†–æ–ª—ñ –¥–æ–∑–≤–æ–ª—è—é—Ç—å –≥—Ä—É–ø—É–≤–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –∑ –æ–¥–Ω–∞–∫–æ–≤–∏–º–∏ –ø—Ä–∞–≤–∞–º–∏:

```sql
-- –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ä–æ–ª—ñ
CREATE ROLE readonly;
GRANT CONNECT ON DATABASE company_db TO readonly;
GRANT USAGE ON SCHEMA public TO readonly;
GRANT SELECT ON ALL TABLES IN SCHEMA public TO readonly;

-- –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ä–æ–ª—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É
GRANT readonly TO analyst;
```

### –†–µ–∑–µ—Ä–≤–Ω–µ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è —Ç–∞ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è

–†–µ–≥—É–ª—è—Ä–Ω–µ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ä–µ–∑–µ—Ä–≤–Ω–∏—Ö –∫–æ–ø—ñ–π –∫—Ä–∏—Ç–∏—á–Ω–æ –≤–∞–∂–ª–∏–≤–µ –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö. PostgreSQL –Ω–∞–¥–∞—î –∫—ñ–ª—å–∫–∞ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤ –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è.

**–õ–æ–≥—ñ—á–Ω–µ —Ä–µ–∑–µ—Ä–≤–Ω–µ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è –∑ pg_dump:**

```bash
# –ö–æ–ø—ñ—é–≤–∞–Ω–Ω—è –≤—Å—ñ—î—ó –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
pg_dump -U postgres -d company_db -F c -f backup_company.dump

# –ö–æ–ø—ñ—é–≤–∞–Ω–Ω—è –≤ SQL —Ñ–æ—Ä–º–∞—Ç
pg_dump -U postgres -d company_db -f backup_company.sql

# –ö–æ–ø—ñ—é–≤–∞–Ω–Ω—è –æ–∫—Ä–µ–º–æ—ó —Ç–∞–±–ª–∏—Ü—ñ
pg_dump -U postgres -d company_db -t users -f backup_users.sql

# –ö–æ–ø—ñ—é–≤–∞–Ω–Ω—è –∑ —Å—Ç–∏—Å–Ω–µ–Ω–Ω—è–º
pg_dump -U postgres -d company_db -F c -Z 9 -f backup_company.dump
```

–ü–∞—Ä–∞–º–µ—Ç—Ä–∏ pg_dump:

- `-F c` ‚Äî custom format, –¥–æ–∑–≤–æ–ª—è—î –≤–∏–±—ñ—Ä–∫–æ–≤–µ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è.
- `-F p` ‚Äî plain text SQL —Ñ–æ—Ä–º–∞—Ç.
- `-Z` ‚Äî —Ä—ñ–≤–µ–Ω—å —Å—Ç–∏—Å–Ω–µ–Ω–Ω—è (0-9).
- `-t` ‚Äî –≤–∫–∞–∑–∞—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É —Ç–∞–±–ª–∏—Ü—é.
- `--schema` ‚Äî –≤–∫–∞–∑–∞—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É —Å—Ö–µ–º—É.

**–í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ—ó –∫–æ–ø—ñ—ó:**

```bash
# –í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –∑ custom format
pg_restore -U postgres -d company_db -F c backup_company.dump

# –í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –∑ SQL —Ñ–∞–π–ª—É
psql -U postgres -d company_db -f backup_company.sql

# –í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ—ó —Ç–∞–±–ª–∏—Ü—ñ
pg_restore -U postgres -d company_db -t users backup_company.dump

# –í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –±–µ–∑ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤–ª–∞—Å–Ω–∏–∫—ñ–≤
pg_restore -U postgres -d company_db --no-owner backup_company.dump
```

–°—Ç—Ä–∞—Ç–µ–≥—ñ—ó —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è:

- **–ü–æ–≤–Ω–µ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è** ‚Äî —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–æ–≤–Ω–æ—ó –∫–æ–ø—ñ—ó –±–∞–∑–∏ –¥–∞–Ω–∏—Ö —Ä–µ–≥—É–ª—è—Ä–Ω–æ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —â–æ–¥–µ–Ω–Ω–æ).
- **–Ü–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–µ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è** ‚Äî –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ç—ñ–ª—å–∫–∏ –∑–º—ñ–Ω –∑ –º–æ–º–µ–Ω—Ç—É –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è.
- **Point-in-time recovery** ‚Äî –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –≤—ñ–¥–Ω–æ–≤–∏—Ç–∏ –±–∞–∑—É –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π –º–æ–º–µ–Ω—Ç —á–∞—Å—É, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ WAL –ª–æ–≥–∏.

## ‚ñ∂Ô∏è –•—ñ–¥ —Ä–æ–±–æ—Ç–∏

### –ö—Ä–æ–∫ 1. –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞

–ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ —É –≤–∞—Å –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ PostgreSQL —Ç–∞ —î –¥–æ—Å—Ç—É–ø –¥–æ —Å—Ç–≤–æ—Ä–µ–Ω–æ—ó —Ä–∞–Ω—ñ—à–µ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö. –ü—ñ–¥–∫–ª—é—á—ñ—Ç—å—Å—è –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥–Ω–∏–π —Ä—è–¥–æ–∫ –∞–±–æ –≥—Ä–∞—Ñ—ñ—á–Ω–∏–π —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å (pgAdmin, DBeaver).

```bash
psql -U postgres -d company_db
```

### –ö—Ä–æ–∫ 2. –ê–Ω–∞–ª—ñ–∑ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –∑–∞–ø–∏—Ç—ñ–≤

–í–∏–±–µ—Ä—ñ—Ç—å —Ç—Ä–∏ —Å–∫–ª–∞–¥–Ω–∏—Ö –∑–∞–ø–∏—Ç–∏ –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∏—Ö —Ä–æ–±—ñ—Ç –∞–±–æ —Å—Ç–≤–æ—Ä—ñ—Ç—å –Ω–æ–≤—ñ. –ü—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–π—Ç–µ —ó—Ö –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é EXPLAIN ANALYZE.

```sql
-- –ü—Ä–∏–∫–ª–∞–¥ –∞–Ω–∞–ª—ñ–∑—É –∑–∞–ø–∏—Ç—É
EXPLAIN ANALYZE
SELECT
    u.username,
    COUNT(o.order_id) as order_count,
    SUM(o.total_amount) as total_spent
FROM users u
LEFT JOIN orders o ON u.user_id = o.user_id
WHERE u.created_at > '2024-01-01'
GROUP BY u.user_id, u.username
HAVING COUNT(o.order_id) > 5
ORDER BY total_spent DESC;
```

–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É –Ω–∞:

- –¢–∏–ø–∏ —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—å (Sequential Scan, Index Scan).
- –ß–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–∂–Ω–æ–≥–æ –µ—Ç–∞–ø—É.
- –ö—ñ–ª—å–∫—ñ—Å—Ç—å –æ–±—Ä–æ–±–ª–µ–Ω–∏—Ö —Ä—è–¥–∫—ñ–≤.
- –ó–∞–≥–∞–ª—å–Ω–∏–π —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∑–∞–ø–∏—Ç—É.

–ó–±–µ—Ä–µ–∂—ñ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –∞–Ω–∞–ª—ñ–∑—É –¥–ª—è –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –ø—ñ—Å–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —ñ–Ω–¥–µ–∫—Å—ñ–≤.

### –ö—Ä–æ–∫ 3. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —ñ–Ω–¥–µ–∫—Å—ñ–≤ –¥–ª—è –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó

–ù–∞ –æ—Å–Ω–æ–≤—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ –∞–Ω–∞–ª—ñ–∑—É –≤–∏–∑–Ω–∞—á—Ç–µ, —è–∫—ñ —Å—Ç–æ–≤–ø—Ü—ñ –Ω–∞–π—á–∞—Å—Ç—ñ—à–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è —É WHERE, JOIN, ORDER BY —Ç–∞ GROUP BY. –°—Ç–≤–æ—Ä—ñ—Ç—å —ñ–Ω–¥–µ–∫—Å–∏ –¥–ª—è —Ü–∏—Ö —Å—Ç–æ–≤–ø—Ü—ñ–≤.

```sql
-- –Ü–Ω–¥–µ–∫—Å –¥–ª—è —Å—Ç–æ–≤–ø—Ü—è –∑ –¥–∞—Ç–æ—é —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è
CREATE INDEX idx_users_created_at ON users(created_at);

-- –°–∫–ª–∞–¥–µ–Ω–∏–π —ñ–Ω–¥–µ–∫—Å –¥–ª—è JOIN –æ–ø–µ—Ä–∞—Ü—ñ—ó
CREATE INDEX idx_orders_user_id ON orders(user_id);

-- –Ü–Ω–¥–µ–∫—Å –¥–ª—è —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è
CREATE INDEX idx_orders_amount ON orders(total_amount DESC);
```

–ü—ñ—Å–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —ñ–Ω–¥–µ–∫—Å—ñ–≤ –ø–æ–≤—Ç–æ—Ä–Ω–æ –≤–∏–∫–æ–Ω–∞–π—Ç–µ EXPLAIN ANALYZE –¥–ª—è —Ç–∏—Ö —Å–∞–º–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤ —Ç–∞ –ø–æ—Ä—ñ–≤–Ω—è–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏. –û–±—á–∏—Å–ª—ñ—Ç—å –≤—ñ–¥—Å–æ—Ç–æ–∫ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ.

### –ö—Ä–æ–∫ 4. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—å

–°—Ç–≤–æ—Ä—ñ—Ç—å –¥–≤–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è –¥–ª—è —Å–ø—Ä–æ—â–µ–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É –¥–æ —á–∞—Å—Ç–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–Ω–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤.

```sql
-- –ü—Ä–æ—Å—Ç–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è –¥–ª—è –∞–∫—Ç–∏–≤–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
CREATE VIEW active_users AS
SELECT user_id, username, email, created_at
FROM users
WHERE status = 'active';

-- –°–∫–ª–∞–¥–Ω–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è –∑ –∞–≥—Ä–µ–≥–∞—Ü—ñ—î—é
CREATE VIEW user_statistics AS
SELECT
    u.user_id,
    u.username,
    COUNT(DISTINCT o.order_id) as total_orders,
    COALESCE(SUM(o.total_amount), 0) as total_spent,
    MAX(o.order_date) as last_order_date
FROM users u
LEFT JOIN orders o ON u.user_id = o.user_id
GROUP BY u.user_id, u.username;
```

–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ä–æ–±–æ—Ç—É –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—å –ø—Ä–æ—Å—Ç–∏–º–∏ SELECT –∑–∞–ø–∏—Ç–∞–º–∏:

```sql
SELECT * FROM active_users LIMIT 10;
SELECT * FROM user_statistics ORDER BY total_spent DESC LIMIT 10;
```

### –ö—Ä–æ–∫ 5. –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è —Ç—Ä–∏–≥–µ—Ä—ñ–≤

–°—Ç–≤–æ—Ä—ñ—Ç—å —Ç–∞–±–ª–∏—Ü—é –¥–ª—è –ª–æ–≥—É–≤–∞–Ω–Ω—è –æ–ø–µ—Ä–∞—Ü—ñ–π, —è–∫—â–æ —ó—ó —â–µ –Ω–µ–º–∞—î:

```sql
CREATE TABLE audit_log (
    log_id SERIAL PRIMARY KEY,
    table_name VARCHAR(50) NOT NULL,
    operation VARCHAR(10) NOT NULL,
    record_id INTEGER,
    old_values JSONB,
    new_values JSONB,
    changed_by VARCHAR(100),
    changed_at TIMESTAMP DEFAULT NOW()
);
```

–°—Ç–≤–æ—Ä—ñ—Ç—å —Ñ—É–Ω–∫—Ü—ñ—é —Ç—Ä–∏–≥–µ—Ä–∞ —Ç–∞ —Å–∞–º —Ç—Ä–∏–≥–µ—Ä –¥–ª—è –ª–æ–≥—É–≤–∞–Ω–Ω—è –æ–ø–µ—Ä–∞—Ü—ñ–π INSERT –∞–±–æ UPDATE:

```sql
-- –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –ª–æ–≥—É–≤–∞–Ω–Ω—è –≤—Å—Ç–∞–≤–∫–∏
CREATE OR REPLACE FUNCTION log_user_insert()
RETURNS TRIGGER AS $$
BEGIN
    INSERT INTO audit_log (table_name, operation, record_id, new_values, changed_by)
    VALUES ('users', TG_OP, NEW.user_id, row_to_json(NEW)::jsonb, current_user);
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- –¢—Ä–∏–≥–µ—Ä –Ω–∞ –≤—Å—Ç–∞–≤–∫—É
CREATE TRIGGER trg_user_insert
AFTER INSERT ON users
FOR EACH ROW
EXECUTE FUNCTION log_user_insert();
```

–î–ª—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó –¥–∞–Ω–∏—Ö —Å—Ç–≤–æ—Ä—ñ—Ç—å BEFORE —Ç—Ä–∏–≥–µ—Ä:

```sql
-- –§—É–Ω–∫—Ü—ñ—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó email
CREATE OR REPLACE FUNCTION validate_user_email()
RETURNS TRIGGER AS $$
BEGIN
    IF NEW.email !~ '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}$' THEN
        RAISE EXCEPTION 'Invalid email format: %', NEW.email;
    END IF;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- –¢—Ä–∏–≥–µ—Ä –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó
CREATE TRIGGER trg_validate_email
BEFORE INSERT OR UPDATE ON users
FOR EACH ROW
EXECUTE FUNCTION validate_user_email();
```

–ü—Ä–æ—Ç–µ—Å—Ç—É–π—Ç–µ —Ä–æ–±–æ—Ç—É —Ç—Ä–∏–≥–µ—Ä—ñ–≤:

```sql
-- –í—Å—Ç–∞–≤–∫–∞ –∫–æ—Ä–µ–∫—Ç–Ω–æ–≥–æ –∑–∞–ø–∏—Å—É
INSERT INTO users (username, email, status)
VALUES ('test_user', 'test@example.com', 'active');

-- –°–ø—Ä–æ–±–∞ –≤—Å—Ç–∞–≤–∫–∏ –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω–æ–≥–æ email (–º–∞—î –±—É—Ç–∏ –≤—ñ–¥—Ö–∏–ª–µ–Ω–∞)
INSERT INTO users (username, email, status)
VALUES ('invalid_user', 'invalid-email', 'active');

-- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ª–æ–≥—ñ–≤
SELECT * FROM audit_log ORDER BY changed_at DESC LIMIT 5;
```

### –ö—Ä–æ–∫ 6. –ö–µ—Ä—É–≤–∞–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏ —Ç–∞ –ø—Ä–∞–≤–∞–º–∏

–°—Ç–≤–æ—Ä—ñ—Ç—å –Ω–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ –æ–±–º–µ–∂–µ–Ω–∏–º–∏ –ø—Ä–∞–≤–∞–º–∏:

```sql
-- –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
CREATE USER report_viewer WITH PASSWORD 'secure_password';

-- –ù–∞–¥–∞–Ω–Ω—è –±–∞–∑–æ–≤–∏—Ö –ø—Ä–∞–≤
GRANT CONNECT ON DATABASE company_db TO report_viewer;
GRANT USAGE ON SCHEMA public TO report_viewer;

-- –ù–∞–¥–∞–Ω–Ω—è –ø—Ä–∞–≤ —Ç—ñ–ª—å–∫–∏ –Ω–∞ —á–∏—Ç–∞–Ω–Ω—è –ø–µ–≤–Ω–∏—Ö —Ç–∞–±–ª–∏—Ü—å
GRANT SELECT ON users, orders TO report_viewer;

-- –ù–∞–¥–∞–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É –¥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—å
GRANT SELECT ON user_statistics, active_users TO report_viewer;
```

–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É, –ø—ñ–¥–∫–ª—é—á–∏–≤—à–∏—Å—å –ø—ñ–¥ –Ω–æ–≤–∏–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º:

```bash
psql -U report_viewer -d company_db
```

–°–ø—Ä–æ–±—É–π—Ç–µ –≤–∏–∫–æ–Ω–∞—Ç–∏ –æ–ø–µ—Ä–∞—Ü—ñ—ó —á–∏—Ç–∞–Ω–Ω—è —Ç–∞ –∑–∞–ø–∏—Å—É –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –æ–±–º–µ–∂–µ–Ω—å.

### –ö—Ä–æ–∫ 7. –†–µ–∑–µ—Ä–≤–Ω–µ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è

–°—Ç–≤–æ—Ä—ñ—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É –∫–æ–ø—ñ—é –±–∞–∑–∏ –¥–∞–Ω–∏—Ö:

```bash
# –ü–æ–≤–Ω–µ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
pg_dump -U postgres -d company_db -F c -f backup_$(date +%Y%m%d).dump

# –ö–æ–ø—ñ—é–≤–∞–Ω–Ω—è –≤ SQL —Ñ–æ—Ä–º–∞—Ç
pg_dump -U postgres -d company_db > backup_company.sql
```

–î–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–≤–æ—Ä—ñ—Ç—å —Ç–µ—Å—Ç–æ–≤—É –±–∞–∑—É –¥–∞–Ω–∏—Ö —Ç–∞ –≤—ñ–¥–Ω–æ–≤—ñ—Ç—å –≤ –Ω–µ—ó —Ä–µ–∑–µ—Ä–≤–Ω—É –∫–æ–ø—ñ—é:

```bash
# –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–µ—Å—Ç–æ–≤–æ—ó –±–∞–∑–∏
createdb -U postgres test_restore

# –í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ—ó –∫–æ–ø—ñ—ó
pg_restore -U postgres -d test_restore backup_*.dump

# –ê–±–æ –¥–ª—è SQL —Ñ–æ—Ä–º–∞—Ç—É
psql -U postgres -d test_restore -f backup_company.sql
```

### –ö—Ä–æ–∫ 8. –î–æ–¥–∞—Ç–∫–æ–≤—ñ –∑–∞–≤–¥–∞–Ω–Ω—è –¥–ª—è —Ä—ñ–≤–Ω—è 2

**–ú–∞—Ç–µ—Ä—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è:**

```sql
CREATE MATERIALIZED VIEW daily_sales_summary AS
SELECT
    DATE(order_date) as sale_date,
    COUNT(*) as order_count,
    SUM(total_amount) as daily_revenue,
    AVG(total_amount) as average_order
FROM orders
GROUP BY DATE(order_date);

-- –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —ñ–Ω–¥–µ–∫—Å—É –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –ø–æ—à—É–∫—É
CREATE INDEX idx_daily_sales_date ON daily_sales_summary(sale_date);
```

**–ß–∞—Å—Ç–∫–æ–≤—ñ —ñ–Ω–¥–µ–∫—Å–∏:**

```sql
-- –Ü–Ω–¥–µ–∫—Å —Ç—ñ–ª—å–∫–∏ –¥–ª—è –∞–∫—Ç–∏–≤–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
CREATE INDEX idx_active_users_username ON users(username)
WHERE status = 'active';

-- –Ü–Ω–¥–µ–∫—Å –¥–ª—è –Ω–µ–¥–∞–≤–Ω—ñ—Ö –∑–∞–º–æ–≤–ª–µ–Ω—å
CREATE INDEX idx_recent_orders ON orders(order_date, user_id)
WHERE order_date > CURRENT_DATE - INTERVAL '30 days';
```

**–†–æ–∑—à–∏—Ä–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –ª–æ–≥—É–≤–∞–Ω–Ω—è:**

```sql
CREATE OR REPLACE FUNCTION comprehensive_audit_log()
RETURNS TRIGGER AS $$
BEGIN
    IF TG_OP = 'DELETE' THEN
        INSERT INTO audit_log (table_name, operation, record_id, old_values, changed_by)
        VALUES (TG_TABLE_NAME, TG_OP, OLD.user_id, row_to_json(OLD)::jsonb, current_user);
        RETURN OLD;
    ELSIF TG_OP = 'UPDATE' THEN
        INSERT INTO audit_log (table_name, operation, record_id, old_values, new_values, changed_by)
        VALUES (TG_TABLE_NAME, TG_OP, NEW.user_id, row_to_json(OLD)::jsonb, row_to_json(NEW)::jsonb, current_user);
        RETURN NEW;
    ELSIF TG_OP = 'INSERT' THEN
        INSERT INTO audit_log (table_name, operation, record_id, new_values, changed_by)
        VALUES (TG_TABLE_NAME, TG_OP, NEW.user_id, row_to_json(NEW)::jsonb, current_user);
        RETURN NEW;
    END IF;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trg_comprehensive_audit
AFTER INSERT OR UPDATE OR DELETE ON users
FOR EACH ROW
EXECUTE FUNCTION comprehensive_audit_log();
```

### –ö—Ä–æ–∫ 9. –¢–≤–æ—Ä—á–µ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è –¥–ª—è —Ä—ñ–≤–Ω—è 3

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –º–∞—Ç–µ—Ä—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è:**

```sql
-- –§—É–Ω–∫—Ü—ñ—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –º–∞—Ç–µ—Ä—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è
CREATE OR REPLACE FUNCTION refresh_daily_sales()
RETURNS TRIGGER AS $$
BEGIN
    REFRESH MATERIALIZED VIEW CONCURRENTLY daily_sales_summary;
    RETURN NULL;
END;
$$ LANGUAGE plpgsql;

-- –¢—Ä–∏–≥–µ—Ä –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
CREATE TRIGGER trg_refresh_sales
AFTER INSERT OR UPDATE OR DELETE ON orders
FOR EACH STATEMENT
EXECUTE FUNCTION refresh_daily_sales();
```

**–Ü—î—Ä–∞—Ä—Ö—ñ—è —Ä–æ–ª–µ–π:**

```sql
-- –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –±–∞–∑–æ–≤–∏—Ö —Ä–æ–ª–µ–π
CREATE ROLE readonly NOLOGIN;
GRANT CONNECT ON DATABASE company_db TO readonly;
GRANT USAGE ON SCHEMA public TO readonly;
GRANT SELECT ON ALL TABLES IN SCHEMA public TO readonly;

CREATE ROLE readwrite NOLOGIN;
GRANT readonly TO readwrite;
GRANT INSERT, UPDATE, DELETE ON ALL TABLES IN SCHEMA public TO readwrite;

CREATE ROLE admin NOLOGIN;
GRANT readwrite TO admin;
GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO admin;

-- –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –∑ —Ä–æ–ª—è–º–∏
CREATE USER viewer WITH PASSWORD 'view_pass';
GRANT readonly TO viewer;

CREATE USER moderator WITH PASSWORD 'mod_pass';
GRANT readwrite TO moderator;

CREATE USER administrator WITH PASSWORD 'admin_pass';
GRANT admin TO administrator;
```

**–ó–±–µ—Ä–µ–∂–µ–Ω–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ –¥–ª—è –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è:**

```sql
CREATE OR REPLACE PROCEDURE maintain_database()
LANGUAGE plpgsql
AS $$
BEGIN
    -- –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    ANALYZE;

    -- –û—á–∏—â–µ–Ω–Ω—è –º–µ—Ä—Ç–≤–∏—Ö –∫–æ—Ä—Ç–µ–∂—ñ–≤
    VACUUM ANALYZE;

    -- –ü–µ—Ä–µ–±—É–¥–æ–≤–∞ —ñ–Ω–¥–µ–∫—Å—ñ–≤ –∑ –Ω–∏–∑—å–∫–æ—é –µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—é
    REINDEX DATABASE company_db;

    -- –õ–æ–≥—É–≤–∞–Ω–Ω—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è
    INSERT INTO maintenance_log (operation, executed_at)
    VALUES ('Full maintenance', NOW());

    RAISE NOTICE 'Database maintenance completed successfully';
END;
$$;

-- –í–∏–∫–æ–Ω–∞–Ω–Ω—è –ø—Ä–æ—Ü–µ–¥—É—Ä–∏
CALL maintain_database();
```

**–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ:**

```sql
-- –ó–∞–ø–∏—Ç –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —ñ–Ω–¥–µ–∫—Å—ñ–≤
SELECT
    schemaname,
    tablename,
    indexname,
    idx_scan as index_scans,
    idx_tup_read as tuples_read,
    idx_tup_fetch as tuples_fetched
FROM pg_stat_user_indexes
WHERE idx_scan = 0
    AND indexrelname NOT LIKE 'pg_%'
ORDER BY tablename, indexname;

-- –ó–∞–ø–∏—Ç –¥–ª—è –ø–æ—à—É–∫—É –Ω–∞–π–ø–æ–≤—ñ–ª—å–Ω—ñ—à–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤
SELECT
    query,
    calls,
    total_exec_time,
    mean_exec_time,
    max_exec_time
FROM pg_stat_statements
ORDER BY mean_exec_time DESC
LIMIT 10;
```

### –ö—Ä–æ–∫ 10. –î–æ–∫—É–º–µ–Ω—Ç—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤

–°—Ç–≤–æ—Ä—ñ—Ç—å –∑–≤—ñ—Ç —É —Ñ–æ—Ä–º–∞—Ç—ñ Markdown –∑ –Ω–∞—Å—Ç—É–ø–Ω–æ—é —Å—Ç—Ä—É–∫—Ç—É—Ä–æ—é:

1. –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –∞–Ω–∞–ª—ñ–∑—É –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –¥–æ —Ç–∞ –ø—ñ—Å–ª—è –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó.
2. –û–ø–∏—Å —Å—Ç–≤–æ—Ä–µ–Ω–∏—Ö —ñ–Ω–¥–µ–∫—Å—ñ–≤ –∑ –æ–±“ë—Ä—É–Ω—Ç—É–≤–∞–Ω–Ω—è–º —ó—Ö –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—Å—Ç—ñ.
3. SQL –∫–æ–¥ –≤—Å—ñ—Ö —Å—Ç–≤–æ—Ä–µ–Ω–∏—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—å —Ç–∞ —Ç—Ä–∏–≥–µ—Ä—ñ–≤.
4. –°–∫—Ä—ñ–Ω—à–æ—Ç–∏ –∞–±–æ —Ç–µ–∫—Å—Ç–æ–≤–∏–π –≤–∏–≤—ñ–¥ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ä–æ–±–æ—Ç–∏ —Ç—Ä–∏–≥–µ—Ä—ñ–≤.
5. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è —Å–∏—Å—Ç–µ–º–∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø—É –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö —Ä–æ–ª–µ–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤.
6. –í–∏—Å–Ω–æ–≤–∫–∏ —â–æ–¥–æ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ —Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó.

[üîº –ó–¥–∞—Ç–∏ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—É —Ä–æ–±–æ—Ç—É](http://194.187.154.85/moodle/course/view.php?id=32#section-2)


## ‚ùì –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ñ –∑–∞–ø–∏—Ç–∞–Ω–Ω—è

1. –ü–æ—è—Å–Ω—ñ—Ç—å —Ä—ñ–∑–Ω–∏—Ü—é –º—ñ–∂ EXPLAIN —Ç–∞ EXPLAIN ANALYZE. –ö–æ–ª–∏ –∫—Ä–∞—â–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∫–æ–∂–Ω—É –∑ —Ü–∏—Ö –∫–æ–º–∞–Ω–¥?
2. –Ø–∫—ñ —Ç–∏–ø–∏ —ñ–Ω–¥–µ–∫—Å—ñ–≤ –ø—ñ–¥—Ç—Ä–∏–º—É—î PostgreSQL? –û–ø–∏—à—ñ—Ç—å —Å–∏—Ç—É–∞—Ü—ñ—ó, –∫–æ–ª–∏ –¥–æ—Ü—ñ–ª—å–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∫–æ–∂–µ–Ω —Ç–∏–ø.
3. –©–æ —Ç–∞–∫–µ —á–∞—Å—Ç–∫–æ–≤—ñ —ñ–Ω–¥–µ–∫—Å–∏ —Ç–∞ –≤ —è–∫–∏—Ö –≤–∏–ø–∞–¥–∫–∞—Ö —ó—Ö –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –¥–∞—î –Ω–∞–π–±—ñ–ª—å—à–∏–π –≤–∏–≥—Ä–∞—à —É –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ?
4. –Ø–∫–∞ —Ä—ñ–∑–Ω–∏—Ü—è –º—ñ–∂ –∑–≤–∏—á–∞–π–Ω–∏–º –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è–º (VIEW) —Ç–∞ –º–∞—Ç–µ—Ä—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–º –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è–º (MATERIALIZED VIEW)? –ù–∞–≤–µ–¥—ñ—Ç—å –ø—Ä–∏–∫–ª–∞–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è.
5. –û–ø–∏—à—ñ—Ç—å –∂–∏—Ç—Ç—î–≤–∏–π —Ü–∏–∫–ª —Ç—Ä–∏–≥–µ—Ä–∞. –Ø–∫–∞ —Ä—ñ–∑–Ω–∏—Ü—è –º—ñ–∂ BEFORE, AFTER —Ç–∞ INSTEAD OF —Ç—Ä–∏–≥–µ—Ä–∞–º–∏?
6. –ß–æ–º—É –≤–∞–∂–ª–∏–≤–æ –æ–±–º–µ–∂—É–≤–∞—Ç–∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö? –Ø–∫—ñ —Ä—ñ–≤–Ω—ñ –≥—Ä–∞–Ω—É–ª—è—Ä–Ω–æ—Å—Ç—ñ –ø—ñ–¥—Ç—Ä–∏–º—É—î PostgreSQL?
7. –ü–æ—è—Å–Ω—ñ—Ç—å —Ä—ñ–∑–Ω–∏—Ü—é –º—ñ–∂ –ª–æ–≥—ñ—á–Ω–∏–º —Ç–∞ —Ñ—ñ–∑–∏—á–Ω–∏–º —Ä–µ–∑–µ—Ä–≤–Ω–∏–º –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è–º. –Ø–∫—ñ –ø–µ—Ä–µ–≤–∞–≥–∏ —Ç–∞ –Ω–µ–¥–æ–ª—ñ–∫–∏ –∫–æ–∂–Ω–æ–≥–æ –ø—ñ–¥—Ö–æ–¥—É?
8. –©–æ —Ç–∞–∫–µ –∫–∞—Å–∫–∞–¥–Ω—ñ —Ç—Ä–∏–≥–µ—Ä–∏? –ù–∞–≤–µ–¥—ñ—Ç—å –ø—Ä–∏–∫–ª–∞–¥ —Å–∏—Ç—É–∞—Ü—ñ—ó, –∫–æ–ª–∏ –≤–æ–Ω–∏ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ.
9. –Ø–∫ —ñ–Ω–¥–µ–∫—Å–∏ –≤–ø–ª–∏–≤–∞—é—Ç—å –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü—ñ–π INSERT, UPDATE —Ç–∞ DELETE? –ß–æ–º—É –Ω–∞–¥–º—ñ—Ä–Ω–∞ —ñ–Ω–¥–µ–∫—Å–∞—Ü—ñ—è –º–æ–∂–µ –±—É—Ç–∏ —à–∫—ñ–¥–ª–∏–≤–æ—é?
10. –û–ø–∏—à—ñ—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥—ñ—é point-in-time recovery. –Ø–∫—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ PostgreSQL –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ –¥–ª—è —ó—ó —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó?
